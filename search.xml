<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[ä¸€æ¬¡äº‹æ•…]]></title>
    <url>%2F2018%2F04%2F%E4%B8%80%E6%AC%A1%E4%BA%8B%E6%95%85%2F</url>
    <content type="text"><![CDATA[è¿™å‘¨äº”å‡Œæ™¨è¿›è¡Œçº¿ä¸Šæ•°æ®åº“çš„åˆ‡æ¢ï¼Œä¹‹å‰å·²ç»æ”¹æˆäº†è¯»æ–°åº“ï¼Œè¿™æ¬¡æ˜¯æŠŠå†™ä¹Ÿåˆ‡æ¢åˆ°æ–°åº“ï¼Œæ˜¯æŒç»­ä¸€ä¸ªæœˆå·¥ä½œçš„æœ€åä¸€æ¬¡é‡è¦å˜æ›´ã€‚ åˆ‡æ¢çš„æ“ä½œæ­¥éª¤å·²ç» review é€šè¿‡å¹¶å†™åœ¨æ–‡æ¡£ä¸­ï¼Œä½†å®é™…æƒ…å†µè¿œæ²¡æœ‰é¢„æ–™çš„é¡ºåˆ©ã€‚ ä¹‹å‰ç»™çš„åˆ‡æ¢æ—¶é—´æ˜¯ 20 ç§’ï¼Œä¹Ÿå°±æ˜¯æœ€å¤šä¼šæœ‰ 20 ç§’å†™å…¥å¤±è´¥ï¼Œä½†å®é™…ç”¨äº†ä¸¤åˆ†åŠã€‚ç„¶åå‘ç°æ–°åº“å‘æŸæ˜ å°„è¡¨çš„åŒæ­¥å»¶è¿Ÿæœ‰ 15 ç§’ï¼Œè¿™ä¸ªæ—¶é—´æ˜¯ä¸èƒ½æ¥å—çš„ï¼Œä½†å›æ»šæ“ä½œè¿˜ä¼šå¯¼è‡´å†™åº“å¤±è´¥å¹¶ä¸”æˆ‘ä»¬çº¿ä¸ŠéªŒè¯ä¸»è¦ä¸šåŠ¡æµç¨‹å¹¶æ²¡å‘ç°é—®é¢˜ã€‚è¿‡äº†ä¸€ä¼šæƒ³åˆ°å‰ä¸¤å¤©é‡åˆ°è¿‡ç±»ä¼¼é—®é¢˜ï¼Œæ˜¯å› ä¸ºæœºå™¨æ—¶é—´ä¸ä¸€è‡´ï¼Œç›‘æ§æ˜¾ç¤ºå»¶è¿Ÿè€Œå®é™…æ­£å¸¸ã€‚æŸ¥çœ‹ä¸¤å°æœºå™¨æ—¶é—´ï¼Œç¡®å®å·®äº† 15 ç§’ã€‚ åœ¨è°ƒç ”å»¶è¿Ÿé—®é¢˜çš„åŒæ—¶ï¼Œå‘ç°æœ‰ä¸šåŠ¡æŠ¥é”™ï¼Œå¦å¤–çš„ä¸€å¼ è¡¨æ’å…¥å¤±è´¥ï¼Œå”¯ä¸€ç´¢å¼•å†²çªï¼Œç»è¿‡ç›¸å…³åŒå­¦è°ƒæŸ¥ï¼ŒåŸå› æ˜¯éƒ¨åˆ†ä¸šåŠ¡é™¤äº†å†™è¿™æ¬¡åˆ‡æ¢çš„è¡¨è¿˜ä¼šå†™å…¶ä»–è¡¨ï¼Œè€Œåˆ‡æ¢è¿‡ç¨‹ä¸­å†™å…¥ä¸¤ä¸ªè¡¨ä¸€ä¸ªæˆåŠŸä¸€ä¸ªå¤±è´¥å°±å¯¼è‡´äº†è¿™ç§å¼‚å¸¸æƒ…å†µã€‚ä»æ—¥å¿—ä¸­å–å‡ºæ’å…¥å¤±è´¥çš„ SQLï¼Œæ‰‹åŠ¨ä¿®è¡¥æ•°æ®åæ¢å¤æ­£å¸¸ã€‚ ç»§ç»­è§‚å¯Ÿä¸šåŠ¡ï¼Œæ—¥å¿—æ­£å¸¸ï¼Œæµ‹è¯•ä¸»è¦ä¸šåŠ¡æµç¨‹ä¹Ÿæ²¡é—®é¢˜ã€‚1 ç‚¹åŠï¼Œæ‰“è½¦å›å®¶ã€‚ 4 ç‚¹åŠè¿˜æ˜¯æ²¡æœ‰ç¡ç€ã€‚ 7 ç‚¹é†’äº†ï¼Œç¬¬ä¸€ä»¶äº‹æƒ…æ˜¯çœ‹æ‰‹æœºï¼Œå‘ç°æœ‰æŠ¥è­¦ï¼Œè¿˜å¥½æ˜¯åˆšå¼€å§‹æŠ¥è­¦ã€‚çœ‹é”™è¯¯æ—¥å¿—ï¼Œè®¤å®šæ˜¯æ•°æ®åº“ä¸­é—´ä»¶æœ‰é—®é¢˜ï¼Œåªå¥½å…ˆä¿®æ”¹ä¸šåŠ¡æ–¹ä»£ç å¹¶ç´§æ€¥ä¸Šçº¿ä¸ä½¿ç”¨ä¸­é—´ä»¶æœ‰é—®é¢˜çš„åŠŸèƒ½ï¼Œä»æŠ¥è­¦åˆ°ä¸Šå®Œçº¿ç”¨äº†ä¸‰åå¤šåˆ†é’Ÿï¼Œä¸Šçº¿åæŠ¥è­¦ç«‹å³æ¶ˆå¤±äº†ã€‚ ç»™åŒäº‹æ‰“äº†å‡ ä¸ªç”µè¯ï¼Œç»§ç»­èººå›åºŠä¸Šï¼Œæ²¡ç¡ç€ã€‚å»å…¬å¸åè¿›è¡Œä¸€äº›å–„åå·¥ä½œï¼Œå¼€æ€»ç»“ä¼šã€‚ åƒä¸€å ‘é•¿ä¸€æ™ºå§ï¼š è¦ä¸€ç›´ä¿æŒè­¦æƒ•ï¼Œå°¤å…¶æ˜¯è¿™ç§æŒç»­æ—¶é—´é•¿çš„ä»»åŠ¡ï¼Œè¦çŸ¥é“çº¿ä¸Šçš„å˜æ›´ä¼šæœ‰å“ªäº›å½±å“ï¼Œè¦æ‰¾æ›´ç†Ÿæ‚‰ä¸šåŠ¡çš„åŒäº‹å»èŠ è™½ç„¶åœ¨æµ‹è¯•ç¯å¢ƒä¹Ÿæ¼”ç»ƒäº†åˆ‡æ¢æ“ä½œï¼Œä½†è¦æ•…æ„æ‹‰é•¿åˆ‡æ¢æ—¶é—´ï¼Œå»å‘ç°åˆ‡æ¢ä¸­ä¼šæœ‰ä»€ä¹ˆé—®é¢˜å‡ºç° åªèƒŒè‡ªå·±çš„é”… æœ€åå†è®°å½•ä¸‹ä»¥å‰é‡åˆ°çš„ä¸€ä¸ªé—®é¢˜ã€‚åœ¨ä¸€æ¬¡é‡æ„æ—¶å‘ç°ä¸€ä¸ªå¾ˆç®€å•å¾ˆå°çš„åˆ«äººå†™çš„ BUGï¼Œæˆ‘é¡ºæ‰‹ä¿®æ”¹åæ²¡æœ‰æµ‹è¯•æ­¤ BUGï¼Œä¸Šçº¿åè¿‡äº†å‡ å¤©å‘ç°å‡ºäº†é—®é¢˜ã€‚æ­¤ BUG å­˜åœ¨æ—¶æ²¡æœ‰é—®é¢˜æ˜¯å› ä¸ºæœ‰å¦å¤–ä¸€ä¸ª BUGï¼Œä¸¤ä¸ª BUG ä¸€èµ·åè€Œæ¥å£æ˜¯æ­£å¸¸çš„ã€‚]]></content>
      <tags>
        <tag>æ‚è°ˆ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[grpc-go client æ‰“å°è¯·æ±‚çš„è€—æ—¶]]></title>
    <url>%2F2018%2F02%2Fgrpc-go%20client%20%E6%89%93%E5%8D%B0%E8%AF%B7%E6%B1%82%E7%9A%84%E8%80%97%E6%97%B6%2F</url>
    <content type="text"><![CDATA[æˆ‘ä»¬åœ¨è°ƒç”¨ http server æˆ–æ‰§è¡Œ SQL/redis å‘½ä»¤æ—¶ä¼šæ‰“å°å‡ºè¿™äº›å¤–éƒ¨ç³»ç»Ÿè°ƒç”¨çš„è€—æ—¶ï¼Œä»¥å¿«é€Ÿå®šä½é—®é¢˜ã€‚éšç€å¯¹ grpc ä½¿ç”¨çš„å¢å¤šï¼Œä¸º grpc client å¢åŠ æ­¤åŠŸèƒ½ä¹Ÿæ˜¯å¾ˆæœ‰å¿…è¦çš„ï¼Œæœ¬æ–‡ç« å°±ç®€å•ä»‹ç»ä¸‹å¤„ç†æ–¹æ³•ã€‚ è¿™é‡Œä»¥å®˜æ–¹çš„ä¾‹å­è¿›è¡Œè¯´æ˜ åœ¨ grpc.Dial() ä¸­æ·»åŠ ä¸­é—´ä»¶ logReqTime 1234567func main() &#123; // Set up a connection to the server. // æ·»åŠ  grpc.WithUnaryInterceptor(logReqTime()) conn, err := grpc.Dial(address, grpc.WithInsecure(), grpc.WithUnaryInterceptor(logReqTime())) // conn, err := grpc.Dial(address, grpc.WithInsecure()) // ......&#125; logReqTime() å®ç°å¦‚ä¸‹ 123456789func logReqTime() grpc.UnaryClientInterceptor &#123; return func(ctx context.Context, method string, req, reply interface&#123;&#125;, cc *grpc.ClientConn, invoker grpc.UnaryInvoker, opts ...grpc.CallOption) error &#123; start := time.Now() // å–å¾—è°ƒç”¨å‰çš„æ—¶é—´ err := invoker(ctx, method, req, reply, cc, opts...) // è°ƒç”¨ rpc å‡½æ•° cost := time.Since(start) // å–å¾—è°ƒç”¨å‡½æ•°çš„è€—æ—¶ fmt.Printf(&quot;method[%s] cost[%v]\n&quot;, method, cost) // æ‰“å°è€—æ—¶ return err &#125;&#125; è¿›è¡Œä¸Šè¿°ä¸¤æ­¥çš„ä¿®æ”¹åï¼Œæ¯æ¬¡å‘é€è¯·æ±‚éƒ½ä¼šæ‰§è¡Œä¸­é—´ä»¶ logReqTimeï¼Œå³å¯æ‰“å°å‡ºè°ƒç”¨è€—æ—¶ å¦‚æœéœ€è¦æ‰“å°å‡ºè°ƒç”¨çš„ rpc server åœ°å€ï¼Œå¯ä½¿ç”¨ grpc.Peer() 12345678910111213141516func logReqTime() grpc.UnaryClientInterceptor &#123; return func(ctx context.Context, method string, req, reply interface&#123;&#125;, cc *grpc.ClientConn, invoker grpc.UnaryInvoker, opts ...grpc.CallOption) error &#123; start := time.Now() // ä½¿ç”¨ grpc.Peer() å–å¾—è°ƒç”¨ rpc æœåŠ¡çš„åœ°å€ p := peer.Peer&#123;&#125; if opts == nil &#123; opts = []grpc.CallOption&#123;grpc.Peer(&amp;p)&#125; &#125; else &#123; opts = append(opts, grpc.Peer(&amp;p)) &#125; err := invoker(ctx, method, req, reply, cc, opts...) cost := time.Since(start) fmt.Printf(&quot;method[%s] call[%s] cost[%v]\n&quot;, method, p.Addr, cost) return err &#125;&#125; æ‰§è¡Œç»“æœï¼š 1method[/helloworld.Greeter/SayHello] call[[::1]:50051] cost[3.072303ms]]]></content>
      <tags>
        <tag>go</tag>
        <tag>grpc</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[json.Marshal å¿½ç•¥ omitempty çš„æ–¹æ³•]]></title>
    <url>%2F2018%2F02%2Fjson.Marshal%20%E5%BF%BD%E7%95%A5%20omitempty%20%E7%9A%84%E6%96%B9%E6%B3%95%2F</url>
    <content type="text"><![CDATA[grpc-go æ—¶ç”Ÿæˆçš„ pb.go æ–‡ä»¶ä¸­ç»“æ„çš„å­—æ®µéƒ½æœ‰ json:&quot;,omitempy&quot; çš„ tagï¼Œä¾‹å¦‚ï¼š 123type HelloReply struct &#123; Message string `protobuf:&quot;bytes,1,opt,name=message&quot; json:&quot;message,omitempty&quot;`&#125; åœ¨æŸäº›æƒ…å†µå¯èƒ½éœ€è¦å°†æ­¤ç»“æ„è½¬æˆ json è¾“å‡ºï¼Œå¹¶ä¸”éœ€è¦å½“æ˜¯é›¶å€¼æ—¶ä¸è¦åœ¨ json ä¸²ä¸­å¿½ç•¥æ­¤å­—æ®µã€‚ ä»¥ä¸Šé¢ç»“æ„ä¸ºä¾‹ï¼Œé»˜è®¤ç¼–ç æˆçš„ json ä¸²æ˜¯ {}ï¼Œä½†éœ€è¦çš„æ˜¯ {&quot;message&quot;:&quot;&quot;}ã€‚ å¼€å§‹æƒ³åˆ°çš„æ–¹æ³•æ˜¯ç”¨ shell è„šæœ¬åˆ é™¤ omitemptyï¼Œä½†æ­¤æ–¹æ³•æœ‰å¯èƒ½å¤šåˆ é™¤ä¸œè¥¿ï¼Œå¹¶ä¸”ä¸æ˜“ç®¡ç†ã€‚æœ€åä½¿ç”¨çš„æ–¹æ³•æ˜¯å¤åˆ¶äº† encoding/json åº“çš„æºç åˆ°æ–°çš„åº“ my_jsonï¼Œä¿®æ”¹è¿™ä¸€è¡Œä¸­çš„ omitEmpty ä¸º falseã€‚å½“éœ€è¦å¿½ç•¥ omitempty æ—¶ï¼Œä½¿ç”¨ my_json åº“å³å¯ã€‚ 12345678fields = append(fields, fillField(field&#123; name: name, tag: tagged, index: index, typ: ft, omitEmpty: opts.Contains(&quot;omitempty&quot;), // æ”¹ä¸º false quoted: quoted,&#125;))]]></content>
      <tags>
        <tag>go</tag>
        <tag>grpc</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®°å½•ä¸€æ¬¡æ€§èƒ½ä¼˜åŒ–]]></title>
    <url>%2F2017%2F10%2F%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%2F</url>
    <content type="text"><![CDATA[å‰ä¸¤å¤©åœ¨å¸®å¥³æœ‹å‹å†™ä»£ç è¿›è¡Œä¸€äº›æ•°å­¦è®¡ç®—ï¼Œå¼€å§‹é‡å¾ˆå°ï¼Œä½†åæ¥éœ€è¦å¯¹æ‰€æœ‰çš„ 32 ä½æ•°å­—è¿›è¡Œè®¡ç®—ã€‚ä¹‹å‰çš„ä»£ç æ— æ³•å®Œæˆè¿™ä¹ˆå¤§çš„è¿ç®—é‡ï¼Œæ‰€ä»¥è¿›è¡Œäº†ä¼˜åŒ–ï¼Œè¿™ç¯‡åšå®¢è®°å½•ä»£ç çš„ä¼˜åŒ–ç‚¹ã€‚ å…ˆé€šè¿‡ä¾‹å­è§£é‡Šä¸€ä¸ªåè¯ï¼šç§»ä½ç­‰ä»· äºŒè¿›åˆ¶æ•° 0001 çš„ç§»ä½ç­‰ä»·çš„æ•°æœ‰ä¸”åªæœ‰ 0010/0100/1000 0000/0001/0011/0101/0111/1111 è¿™äº›æ•°ç§»ä½ä¸ç­‰ä»· ä¸‹é¢æŒ‰ç…§æˆ‘ä¼˜åŒ–çš„é¡ºåºè®°å½•ï¼Œå…¶ä¸­çš„æˆªå›¾æ˜¯ä½¿ç”¨ pprof ç”Ÿæˆçš„ï¼Œç”¨æ¥æ‰¾å‡ºå ç”¨ cpu æ—¶é—´è¾ƒå¤šçš„æ“ä½œã€‚ ä¼˜åŒ–ç®—æ³• ç¨‹åºä¸­é¦–å…ˆè¦åšçš„æ˜¯è¦æ‰¾å‡º 32 ä½æ•°ä¸­æ‰€æœ‰ç§»ä½ä¸ç­‰ä»·çš„æ•°ï¼Œæˆ‘å¼€å§‹çš„æ–¹æ³•æ˜¯è¿™æ ·çš„ï¼š ä½¿ç”¨æ•°ç»„ä¿å­˜æ‰€æœ‰ç§»ä½ä¸ç­‰ä»·çš„æ•° ä½¿ç”¨ä¸¤ä¸ªåµŒå¥—çš„å¾ªç¯åˆ†åˆ«éå†æ‰€æœ‰ 32 ä½æ•°å’Œæ‰€æœ‰å·²ç»åŠ å…¥åˆ°æ•°ç»„ä¸­çš„æ•°ï¼Œæ‰¾å‡ºæ‰€æœ‰ç§»ä½ä¸ç­‰ä»·çš„æ•° è¿™ä¸ªæ–¹æ³•çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(n^2)ã€‚è€Œ 32 ä½æ•°ä¸€å…±æœ‰ 42 äº¿ä¸ªï¼Œè¿™ä¹ˆå¤§çš„é‡çº§ä½¿ç”¨ O(n^2ï¼‰çš„ç®—æ³•æ˜¯è‡ªå¯»æ­»è·¯ã€‚ ä¼˜åŒ–æ–¹æ³•å¾ˆç®€å•ï¼šå°†æ•°ç»„æ¢æˆ mapï¼Œå¦‚æœä¸€ä¸ªæ•°çš„æ‰€æœ‰ç§»ä½ç­‰ä»·çš„æ•°éƒ½ä¸åœ¨ map ä¸­ï¼Œé‚£ä¹ˆå°†è¿™ä¸ªæ•°æ”¾å…¥ mapã€‚è¿™æ ·æ—¶é—´å¤æ‚åº¦å°±ä» O(n^2) é™åˆ° O(n)ã€‚ æˆ‘åˆåšäº†è¿›ä¸€æ­¥ä¼˜åŒ–ï¼Œå…ˆç®—å‡ºæ•° a æœ€å°çš„ç§»ä½ç­‰ä»·çš„å€¼ minï¼Œå†åˆ¤æ–­ä¸€æ¬¡ min æ˜¯å¦åœ¨ mapä¸­ï¼ˆå‡å°‘è¯» map çš„æ¬¡æ•°ï¼‰ã€‚ ç§»é™¤ä¸å¿…è¦çš„é‡å¤è®¡ç®— ç¬¬ä¸€æ¬¡ pprof æ˜¾ç¤ºè€—æ—¶æœ€å¤šçš„æ˜¯ math.Pow()ï¼ŒæŸ¥çœ‹ä»£ç å‘ç°æ•°å€¼çš„ç§»ä½å‡½æ•°ä¸­ä¼šä½¿ç”¨ math.Pow() è®¡ç®— 2^nï¼ˆn çš„èŒƒå›´æ˜¯ [0, 32]ï¼‰ï¼Œå¹¶ä¸”ç§»ä½å‡½æ•°è°ƒç”¨çš„æ¬¡æ•°éå¸¸å¤šã€‚è¿™ç§æƒ…å†µæ²¡å¿…è¦æ¯æ¬¡éƒ½è®¡ç®—ä¸€é 2^nï¼Œä¿®æ”¹æˆå½“ç¨‹åºå¯åŠ¨æ—¶è®¡ç®—å‡ºéœ€è¦çš„å¹³æ–¹å€¼ç„¶åä¿å­˜åˆ° map ä¸­ï¼Œéœ€è¦æ—¶ç›´æ¥ä» map å–ç»“æœå³å¯ã€‚ ä»¥æ•°ç»„æ›¿æ¢ map pprof æ˜¾ç¤ºè®¿é—® map è€—æ—¶è¾ƒé•¿ï¼Œæ˜¯å› ä¸ºä¸Šé¢æŠŠ 2^n ç»“æœä¿å­˜åœ¨äº† map ä¸­ï¼Œå› ä¸ºæ­¤ map çš„ key æ˜¯ [0, 32]ï¼Œæ‰€ä»¥å¯ä»¥ç”¨æ•°ç»„æ›¿æ¢ mapï¼Œä»¥ [0, 32] åšä¸ºæ•°ç»„ç´¢å¼•æ¥å–å¾—å¯¹åº”çš„å¹³æ–¹å€¼ã€‚ å®šä¹‰ slice æ—¶æŒ‡å®šå®¹é‡ growslice è¡¨ç¤º slice è¿›è¡Œäº†æ‰©å®¹ï¼Œæ‰©å®¹éœ€è¦åœ¨å †ä¸­æŸ¥æ‰¾è¶³å¤Ÿå¤§çš„ç©ºé—´å¹¶å¤åˆ¶åŸæ•°æ®ã€‚é€šè¿‡æ’æŸ¥æ‰¾åˆ°äº†æœ‰é—®é¢˜çš„ä»£ç ï¼Œå¹¸è¿çš„æ˜¯è¿™ä¸ª slice çš„æœ€å¤§é•¿åº¦ä¸ä¼šè¶…è¿‡32ï¼Œæ‰€ä»¥ä¿®æ”¹ä¸º s := make([]T, 0, 32)ã€‚ ä¸²è¡Œæ”¹ä¸ºå¹¶è¡Œ æ•´ä¸ªç¨‹åºå¯ç®€å•çš„åˆ’ä¸ºä¸¤æ­¥ï¼š1.æ‰¾å‡ºæ‰€æœ‰ç§»ä½ä¸ç­‰ä»·çš„æ•° 2.å°†è¿™äº›æ•°è¿›è¡Œåç»­è®¡ç®—ã€‚ 32 ä½æ•°ä¸€å…±æœ‰ 42 äº¿ä¸ªæ•°å­—ï¼Œè¦ç­‰ç¬¬ä¸€æ­¥å…¨éƒ¨æ‰§è¡Œå®Œåå†æ‰§è¡Œç¬¬äºŒæ­¥çš„è¯è‚¯å®šä¼šæ‹‰é•¿æ•´ä¸ªç¨‹åºçš„å¤„ç†æ—¶é—´ã€‚ å¯ä»¥å°†ç¬¬ä¸€æ­¥çœ‹åšç”Ÿäº§è€…ï¼Œç¬¬äºŒæ­¥çœ‹æˆæ¶ˆè´¹è€…ï¼Œç”Ÿäº§è€…è®¡ç®—å‡ºä¸€ä¸ªæœ‰æ•ˆçš„æ•°å€¼åå°†å…¶å†™å…¥ channelï¼Œæ¶ˆè´¹è€…å†ä» channel ä¸­å–å¾—è¿™äº›å€¼è¿›è¡Œåç»­è®¡ç®—ï¼Œè¿™æ ·ä¸¤æ­¥è¿ç®—èƒ½å¤Ÿå¹¶è¡Œæ‰§è¡Œï¼Œæé«˜æ•ˆç‡ã€‚ é¿å…åŠ é” é™¤äº†ä½¿ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å¹¶è¡Œæ‰§è¡Œå¤–ï¼Œè¿˜å¯ä»¥åˆ›å»ºå¤šä¸ªç”Ÿäº§è€…å’Œå¤šä¸ªæ¶ˆè´¹è€…ï¼Œå……åˆ†åˆ©ç”¨å¤šæ ¸ã€‚ä½†ç”Ÿäº§è€…åœ¨è®¡ç®—ç§»ä½ä¸ç­‰ä»·çš„æ•°å€¼æ—¶éœ€è¦è¯»å†™å…¨å±€çš„ mapï¼Œå¹¶å‘æƒ…å†µä¸‹è‚¯å®šéœ€è¦åŠ é”ï¼Œå¯¹äºå•ä¸ªè®¡ç®—è€—æ—¶å¾ˆçŸ­ä½†é‡ç‰¹åˆ«å¤§çš„æƒ…å†µä¸‹å¹¶è¡Œå¹¶åŠ é”å¯èƒ½ä¼šæœ‰åä½œç”¨ã€‚ ä½†æ˜¯å…·ä½“åˆ°è¿™ä¸ª caseï¼Œå› ä¸ºé‡é‡ï¼ˆ1 çš„ä¸ªæ•°ï¼Œä¾‹å¦‚ 0101 çš„é‡é‡æ˜¯ 2ï¼‰ä¸åŒçš„æ•°è‚¯å®šæ˜¯ç§»ä½ä¸ç­‰ä»·çš„ï¼Œè¿™æ ·å°±å¯ä»¥å°†ä¸€ä¸ªå…¨å±€çš„ map æŒ‰é‡é‡æ‹†åˆ†æˆå¤šä¸ª mapï¼ˆä¸€ä¸ªé‡é‡ç”¨ä¸€ä¸ª mapï¼Œ32 ä½çš„æ•°ä½¿ç”¨ 33 ä¸ª mapï¼‰ï¼Œç›¸åŒé‡é‡çš„æ•°åªåœ¨åŒä¸€ä¸ª goroutine ä¸­è®¡ç®—ï¼Œè¿™æ ·ä¸€ä¸ª map åªä¼šè¢«ä¸€ä¸ª goroutine è¯»å†™ï¼Œå°±æ²¡æœ‰åŠ é”çš„å¿…è¦äº†ã€‚ å‡å°‘ channel çš„è¯»å†™æ¬¡æ•° ä¼˜åŒ–ä¸ºå¹¶è¡Œåå†æ¬¡ä½¿ç”¨ pprof æµ‹è¯•ï¼Œå¾—åˆ°äº†ä¸Šå›¾ç»“æœã€‚å¯ä»¥çœ‹å‡ºä» channel ä¸­è¯»æ•°æ®æˆäº†è€—æ—¶æœ€å¤šçš„æ“ä½œã€‚ go æœ‰ä¸€å¥åè¨€: Do not communicate by sharing memory; instead, share memory by communicating. è™½ç„¶æ¨èç”¨ channel æ¥å…±äº«æ•°æ®ï¼Œä½† channel å¹¶ä¸æ˜¯å¯¹æ€§èƒ½æ²¡æœ‰å½±å“çš„ã€‚æˆ‘çš„ä»£ç ä¼šé€šè¿‡ channel å…±äº«å¤§é‡æ•°æ®ï¼ˆ10 äº¿çš„æ•°é‡çº§ï¼‰ï¼Œè€Œä¸”æ•°æ®çš„ç”Ÿäº§å’Œæ¶ˆè´¹è€—æ—¶å¾ˆçŸ­ï¼Œè¿™æ—¶å¯¹ channel çš„æ“ä½œå°±æˆäº†ç“¶é¢ˆã€‚æ‰€ä»¥è¦å°†æ“ä½œ channel çš„æ¬¡æ•°é™ä½ã€‚ ä¼˜åŒ–æ–¹æ³•å¾ˆç®€å•ï¼Œä¹‹å‰ channel çš„ç±»å‹æ˜¯ chan Tï¼Œå°†å…¶æ”¹ä¸º chan []Tï¼Œç”Ÿäº§è€…è®¡ç®—å‡ºä¸€ä¸ªå€¼åå…ˆä¿å­˜åˆ° slice ï¼Œå¾… slice é•¿åº¦è¾¾åˆ°æŒ‡å®šå€¼æ—¶å†å°† slice å†™å…¥ channelï¼Œç›¸å½“äºå°†å¤§é‡å°æ•°æ®æ‰“åŒ…åå†é€šè¿‡ channel ä¼ é€’ã€‚è¿™æ ·æ˜æ˜¾é™ä½äº† channel çš„è¯»å†™æ¬¡æ•°ï¼Œä¼˜åŒ–åè¯» channel çš„ cpu å ç”¨ä» 54% é™åˆ°äº† 1.6%ã€‚ ä½¿ç”¨é«˜æ€§èƒ½æœºå™¨ å…¬å¸ 32 æ ¸æµ‹è¯•æœºæ¯”æˆ‘çš„ 4 æ ¸ mac è®¡ç®—å¿«å¤šäº†ğŸ˜‚ å°±å†™åˆ°è¿™å§ï¼Œæˆ‘è¦å»ç»™å¥³æœ‹å‹ä¹°ç‚¸é¸¡è…¿äº†ğŸ”]]></content>
      <tags>
        <tag>go</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Go ä¸­çš„ä¸€äº›å‘]]></title>
    <url>%2F2017%2F07%2FGo%20%E4%B8%AD%E7%9A%84%E4%B8%80%E4%BA%9B%E5%9D%91%2F</url>
    <content type="text"><![CDATA[æ¯ç§è¯­è¨€éƒ½æœ‰â€œå‘â€ï¼Œæœ‰äº›æ˜¯è¯­è¨€è®¾è®¡é—®é¢˜ï¼Œæœ‰äº›æ˜¯ä½¿ç”¨è€…çš„é—®é¢˜ã€‚ä¸ç®¡å¦‚ä½•ï¼Œäº†è§£è¿™äº›ä¸œè¥¿åèƒ½è®©æˆ‘ä»¬çš„ä»£ç æ›´å¥å£®ï¼ŒBUGæ›´å°‘ã€‚ èµ„æºæ³„æ¼ time.Tick() func Tick(d Duration) &lt;-chan Timeå¯ç”¨æ¥åšå®šæ—¶å™¨ï¼Œå®˜ç½‘ä¸Šçš„ç¤ºä¾‹å¦‚ä¸‹ï¼š 1234c := time.Tick(1 * time.Minute)for now := range c &#123; fmt.Printf("%v %s\n", now, statusUpdate())&#125; ä½†ä½¿ç”¨æ­¤å‡½æ•°çš„è¯ï¼Œæ²¡æœ‰åŠæ³•é‡Šæ”¾åº•å±‚çš„èµ„æºï¼Œçœ‹ä¸‹æ­¤å‡½æ•°çš„è¯´æ˜ï¼š Tick is a convenience wrapper for NewTicker providing access to the ticking channel only. While Tick is useful for clients that have no need to shut down the Ticker, be aware that without a way to shut it down the underlying Ticker cannot be recovered by the garbage collector; it â€œleaksâ€. Unlike NewTicker, Tick will return nil if d &lt;= 0. ä¸‹é¢æ˜¯éªŒè¯çš„ä¾‹å­ï¼Œä¼šå‘ç° tickLeak() æ‰§è¡Œå®Œå CPU ä¾ç„¶å ç”¨å¾ˆé«˜ï¼š 12345678910func tickLeak() &#123; for i := 0; i &lt; 1000; i++ &#123; time.Tick(time.Nanosecond) &#125;&#125;func main() &#123; tickLeak() fmt.Println("tickLeak finished") time.Sleep(15 * time.Second)&#125; æ‰€ä»¥åº”è¯¥åƒä¸Šé¢æ³¨é‡Šä¸­è¯´çš„é‚£æ ·ï¼Œåªåœ¨ä¸éœ€è¦å…³é—­ Ticker æ—¶ä½¿ç”¨ time.Tick()ã€‚å¦åˆ™ä½¿ç”¨ time.NewTicker()ï¼Œå¹¶åœ¨ä¸éœ€è¦æ—¶ä¸»åŠ¨è°ƒç”¨ func (*Ticker) Stopã€‚ æ›´æ–° map ä¸­çš„å€¼ map ä¸­çš„å€¼æ˜¯ç»“æ„ä½“æ—¶ï¼Œæƒ³è¦æ›´æ–°ç»“æ„ä½“çš„æŸä¸€ä¸ªå­—æ®µï¼š 123456789101112package maintype T struct &#123; A int B string&#125;func main() &#123; m := make(map[string]T) m["first"] = T&#123;A: 10, B: "ok"&#125; m["first"].A = 1&#125; è¿™æ®µä»£ç ç¼–è¯‘ä¼šæŠ¥é”™ï¼š 1.\main.go:10: cannot assign to struct field m[&quot;first&quot;].A in map è¦è¿™æ ·å†™ï¼š 1234m[&quot;first&quot;] = T&#123; A: 1, B: m[&quot;first&quot;].B,&#125; æˆ–æŠŠ map çš„å€¼æ”¹æˆæŒ‡é’ˆç±»å‹ï¼š 123m := make(map[string]*T)m[&quot;first&quot;] = &amp;T&#123;A: 10, B: &quot;ok&quot;&#125;m[&quot;first&quot;].A = 1 ä½†è¦æ³¨æ„ä½¿ç”¨æŒ‡é’ˆæ—¶ï¼Œå¦‚æœ map ä¸­æ²¡æœ‰è¿™ä¸ª key çš„è¯ä¼š panic: 1panic: runtime error: invalid memory address or nil pointer dereference make slice æ—¶çš„å‚æ•° ä½¿ç”¨ make åˆ›å»º slice æ—¶ï¼Œå¯ä»¥æŒ‡å®š slice çš„å®¹é‡ï¼Œå‡å°‘ append æ—¶é‡æ–°åˆ†é…å†…å­˜çš„æ¬¡æ•°ã€‚ä½†å¦‚æœä»£ç æ˜¯è¿™æ ·å†™çš„ï¼Œé‚£å°±ä¼šå¼•å…¥BUGï¼š 123456789package mainimport "fmt"func main() &#123; s := make([]int, 3) s = append(s, 1, 2, 3) fmt.Println(s)&#125; ä¸Šé¢ä»£ç ä¼šæ‰“å°å‡ºï¼š[0 0 0 1 2 3]ï¼Œå› ä¸º make åªæŒ‡å®šäº†ä¸¤ä¸ªå‚æ•°ï¼Œè¿™æ · slice çš„é•¿åº¦å’Œå®¹é‡éƒ½æ˜¯ 3ï¼Œå³ s ä¸­å·²ç»æœ‰äº†ä¸‰ä¸ªå€¼ä¸º 0 çš„å…ƒç´ ã€‚]]></content>
      <tags>
        <tag>go</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Go ä¸­ä¸€äº›æ“ä½œçš„æ€§èƒ½å¯¹æ¯”]]></title>
    <url>%2F2017%2F05%2Fgo-compare-op%2F</url>
    <content type="text"><![CDATA[è¿™ç¯‡åšå®¢å¯¹æ¯”ä¸€äº›æ“ä½œçš„æ€§èƒ½æƒ…å†µã€‚ å¾ªç¯éå† slice å„å…ƒç´  å­—ç¬¦ä¸²æ‹¼æ¥ å¾ªç¯éå† slice å„å…ƒç´  ä»¥ RoundRobin çš„å®ä¾‹è¿›è¡Œè¯´æ˜ã€‚åœ¨ RoundRobin ä¸­æœ‰ä¸¤ç§æ–¹æ³•è¿”å›å¯ç”¨çš„æœåŠ¡åœ°å€ 1234type roundrobin struct &#123; i int // æœåŠ¡åœ°å€ç´¢å¼• servers []string // å¯ç”¨çš„æœåŠ¡åœ°å€&#125; ç¬¬ä¸€ç§ï¼Œæ¯æ¬¡ç´¢å¼•åŠ ä¸€åå–ä½™æ•°ï¼š 123456func (r *roundrobin) module() string &#123; s := r.servers[r.i] r.i++ r.i %= len(r.servers) return s&#125; ç¬¬äºŒç§ï¼Œæ¯æ¬¡ç´¢å¼•åŠ ä¸€åï¼Œåˆ¤æ–­å¦‚æœåŠ åˆ°æœ€å¤§å°†ç´¢å¼•å†ç½®ä¸º 0ï¼š 12345678func (r *roundrobin) check() string &#123; s := r.servers[r.i] r.i++ if r.i == len(r.servers) &#123; r.i = 0 &#125; return s&#125; è¿™ä¸¤ç§æ–¹æ³•ç»“æœç›¸åŒï¼Œä½†æ€§èƒ½æœ‰ä¸€ä¸ªæ•°é‡çº§çš„å·®è·ï¼ˆæŸ¥çœ‹å®Œæ•´ä»£ç ï¼‰ï¼š 12BenchmarkModule-4 100000000 13.9 ns/opBenchmarkCheck-4 2000000000 1.49 ns/op å­—ç¬¦ä¸²æ‹¼æ¥ æµ‹è¯•å››ç§æ‹¼æ¥æ–¹æ³•ï¼Œä¸¤ç§å­—ç¬¦é•¿åº¦ï¼ˆ5ä¸ªå­—èŠ‚å’Œ500ä¸ªå­—èŠ‚ï¼‰ï¼Œä¸¤ç§å­—ç¬¦ä¸ªæ•°(4ä¸ªå­—ç¬¦ä¸²å’Œ100ä¸ªå­—ç¬¦ä¸²ï¼‰ã€‚ä¸€å…± 4Ã—2Ã—2=16ä¸ªç»“æœã€‚ å››ç§æ‹¼æ¥æ–¹æ³•å¦‚ä¸‹ï¼ˆæŸ¥çœ‹å®Œæ•´ä»£ç ï¼‰ fmt.Sprintf()ï¼š 123func byFmt(s []string) string &#123; return fmt.Sprintf("%s%s%s%s", s[0], s[1], s[2], s[3])&#125; ä½¿ç”¨åŠ å·ä¸€æ¬¡æ‹¼æ¥ï¼š 123func byPlusOnce(s []string) string &#123; return s[0] + s[1] + s[2] + s[3]&#125; ä½¿ç”¨åŠ å·å¤šæ¬¡æ‹¼æ¥ï¼š 12345678func byPlusSplit(s []string) string &#123; ret := "" ret += s[0] ret += s[1] ret += s[2] ret += s[3] return ret&#125; ä½¿ç”¨ bufferï¼š 12345678func byBuffer(s []string) string &#123; buf := bytes.Buffer&#123;&#125; buf.WriteString(s[0]) buf.WriteString(s[1]) buf.WriteString(s[2]) buf.WriteString(s[3]) return buf.String()&#125; æµ‹è¯•ç»“æœï¼š 1234567891011121314151617181920$ go test -bench BenchmarkConcat*BenchmarkConcatShortString/fmt-4 2000000 507 ns/opBenchmarkConcatShortString/plusOnce-4 20000000 74.6 ns/opBenchmarkConcatShortString/plusSplit-4 10000000 182 ns/opBenchmarkConcatShortString/buffer-4 10000000 164 ns/opBenchmarkConcatLongString/fmt-4 2000000 912 ns/opBenchmarkConcatLongString/plusOnce-4 3000000 448 ns/opBenchmarkConcatLongString/plusSplit-4 1000000 1058 ns/opBenchmarkConcatLongString/buffer-4 1000000 2046 ns/opBenchmarkConcatManyShortString/fmt-4 200000 8125 ns/opBenchmarkConcatManyShortString/plusOnce-4 2000000 947 ns/opBenchmarkConcatManyShortString/plusSplit-4 200000 11207 ns/opBenchmarkConcatManyShortString/buffer-4 1000000 2214 ns/opBenchmarkConcatManyLongString/fmt-4 100000 15411 ns/opBenchmarkConcatManyLongString/plusOnce-4 200000 7006 ns/opBenchmarkConcatManyLongString/plusSplit-4 3000 438927 ns/opBenchmarkConcatManyLongString/buffer-4 50000 31283 ns/op æ ¹æ®æµ‹è¯•ç»“æœé€Ÿåº¦æœ€å¿«çš„æ˜¯byPlusOnce()ï¼Œè€Œä¸æ˜¯ç½‘ä¸Šè¯´çš„byBuffer()ã€‚]]></content>
      <tags>
        <tag>go</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åœ¨ go ä¸­å®ç°éé˜»å¡çš„ channel]]></title>
    <url>%2F2017%2F05%2Funblocked_chan%2F</url>
    <content type="text"><![CDATA[ä»Šå¤©åœ¨å†™ç”¨äºé™æµçš„æ¼æ¡¶ç®—æ³•ï¼Œä½¿ç”¨äº† channel æ¥æ¨¡æ‹Ÿâ€œæ¡¶â€ã€‚å¤§è‡´æ–¹æ³•æ˜¯è¿™æ ·ï¼š å®šæ—¶ä» channel ä¸­è¯»å‡ºæ•°æ®ï¼ˆæ¨¡æ‹Ÿæ¡¶æ¼æ°´ï¼‰ æ”¶åˆ°è¯·æ±‚æ—¶å¦‚æœ channel æ²¡æœ‰æ»¡ï¼Œå°±å†™å…¥ æ”¶åˆ°è¯·æ±‚æ—¶å¦‚æœ channel æ»¡äº†ï¼Œå°±æŠ›å¼ƒè¯·æ±‚å¹¶è¿”å›â€œè¶…å‡º QPS é™åˆ¶â€ï¼ˆä¸è¦é˜»å¡ï¼‰ ä¼—æ‰€å‘¨çŸ¥ï¼Œchannel æ˜¯é˜»å¡çš„ï¼Œä½†æœ‰åŠæ³•æ¨¡æ‹Ÿå‡ºç¬¬ 3 ç‚¹çš„è¦æ±‚ï¼Œä»£ç å¦‚ä¸‹: 123456789101112131415161718192021var bucket = make(chan struct&#123;&#125;)func main() &#123; go leak() for i := 0; i &lt; 10; i++ &#123; time.Sleep(500 * time.Millisecond) select &#123; case bucket &lt;- struct&#123;&#125;&#123;&#125;: fmt.Println(&quot;add data to bucket&quot;) default: // æ³¨æ„è¿™é‡Œ fmt.Println(&quot;bucket is full&quot;) &#125; &#125;&#125;func leak() &#123; tick := time.Tick(time.Second) for range tick &#123; &lt;-bucket &#125;&#125; è¿è¡Œç»“æœå¦‚ä¸‹ï¼ˆæˆ–ç‚¹å‡»è¿™é‡Œä¿®æ”¹è¿è¡Œç¨‹åºï¼‰ 12345678910bucket is fullbucket is fulladd data to bucketbucket is fulladd data to bucketbucket is fulladd data to bucketbucket is fulladd data to bucketbucket is full å…³é”®åœ¨äº select ä¸­çš„ defaultï¼Œå½“å…¶ä»–åˆ†æ”¯é˜»å¡æ—¶ä¼šæ‰§è¡Œ default åˆ†æ”¯ï¼Œè¿™æ ·å°±å®ç°äº†â€œéé˜»å¡ channelâ€çš„éœ€æ±‚ã€‚]]></content>
      <tags>
        <tag>go</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Google API è®¾è®¡æŒ‡å—ï¼è¯æ±‡è¡¨]]></title>
    <url>%2F2017%2F04%2Fgoogle-api-design-guide%2Fglossary%2F</url>
    <content type="text"><![CDATA[ç¿»è¯‘è‡ª API Design Guide - Glossary ç½‘ç»œ APIï¼ˆNetworked APIsï¼‰ é€šè¿‡è®¡ç®—æœºç½‘ç»œä¸­è¿è¡Œçš„åº”ç”¨ç¨‹åºæ¥å£ã€‚å®ƒä»¬ä½¿ç”¨åŒ…æ‹¬ HTTP åœ¨å†…çš„ç½‘ç»œåè®®è¿›è¡Œé€šä¿¡ï¼Œå¹¶ä¸”ç”Ÿäº§å’Œæ¶ˆè´¹ API çš„å¾€å¾€æ˜¯ä¸åŒçš„ç»„ç»‡ã€‚ Google API Google æœåŠ¡çš„ç½‘ç»œ APIã€‚å¤§éƒ¨åˆ†åœ¨ googleapis.com åŸŸåä¸Šã€‚ä¸åŒ…æ‹¬å®¢æˆ·ç«¯åº“å’Œ SDK ç­‰å…¶ä»–ç±»å‹çš„ APIã€‚ API æ¥å£ï¼ˆAPI Interfaceï¼‰ ä¸€ä¸ª Protocol Buffer æœåŠ¡çš„å®šä¹‰ã€‚åœ¨å¤§å¤šæ•°ç¼–ç¨‹è¯­è¨€ä¸­å®ƒè¢«æ˜ å°„åˆ°ä¸€ä¸ªæ¥å£ã€‚ä¸€ä¸ª API æ¥å£å¯ä»¥è¢«å¤šä¸ª API æœåŠ¡å®ç°ã€‚ API ç‰ˆæœ¬ï¼ˆAPI Versionï¼‰ ä¸€ä¸ª API æ¥å£æˆ–å¤šä¸ªå®šä¹‰åœ¨ä¸€èµ·çš„ API æ¥å£çš„ç‰ˆæœ¬ã€‚API ç‰ˆæœ¬é€šå¸¸ä»¥å­—ç¬¦ä¸²è¡¨ç¤ºï¼ˆä¾‹å¦‚ â€œv1â€ï¼‰å¹¶ä¸”ä»¥ API è¯·æ±‚å’Œ Protocol Buffer çš„åŒ…åè¡¨ç¤ºã€‚ API æ–¹æ³•ï¼ˆAPI Methodï¼‰ API æ¥å£ä¸­çš„ä¸€ä¸ªå•ç‹¬æ“ä½œã€‚åœ¨ Protocol Buffer ä¸­ä»¥ rpc å®šä¹‰ï¼Œå¹¶ä¸”åœ¨å¤§å¤šæ•°ç¼–ç¨‹è¯­è¨€ä¸­æ˜ å°„åˆ° API æ¥å£ä¸­çš„ä¸€ä¸ªå‡½æ•°ã€‚ API è¯·æ±‚ï¼ˆAPI Requestï¼‰ ä¸€ä¸ªå•ç‹¬çš„ API æ–¹æ³•è°ƒç”¨ã€‚å®ƒç»å¸¸ç”¨ä½œè®¡è´¹ã€è®°å½•ã€ç›‘æ§å’Œé€Ÿç‡é™åˆ¶çš„å•ä½ã€‚ API æœåŠ¡ï¼ˆAPI Serviceï¼‰ ä¸€äººéƒ¨ç½²äº†æš´éœ²å‡ºç½‘ç»œç«¯ç‚¹çš„ API æ¥å£çš„å®ç°ã€‚API æœåŠ¡ä»¥ RFC 1035 DNS æ ¼å¼çš„æœåŠ¡åï¼ˆä¾‹å¦‚ calendar.googleapis.comï¼‰è¿›è¡Œæ ‡è¯†ã€‚ API ç«¯ç‚¹ï¼ˆAPI Endpointï¼‰ æŒ‡å‘ç”¨äº API æœåŠ¡å¤„ç†å®é™… API è¯·æ±‚çš„ç½‘ç»œåœ°å€ã€‚ä¾‹å¦‚ pubsub.googleapis.com å’Œ content-pubsub.googleapis.comã€‚ API äº§å“ï¼ˆAPI Productï¼‰ ä¸€ä¸ª API æœåŠ¡åŠ ä¸Šç›¸å…³çš„ç»„ä»¶ï¼ˆæœåŠ¡å£°æ˜ã€æ–‡æ¡£ã€å®¢æˆ·ç«¯åº“å’ŒæœåŠ¡æ”¯æŒï¼‰ï¼Œç»„åˆèµ·æ¥ä»¥äº§å“çš„å½¢å¼æä¾›ç»™ç”¨æˆ·ã€‚ä¾‹å¦‚ Google Calendar APIã€‚æ³¨æ„ï¼šäººä»¬æœ‰æ—¶ä¼šç®€å•åœ°ä½¿ç”¨ API è¡¨ç¤º API äº§å“ã€‚ API æœåŠ¡å®šä¹‰ï¼ˆAPI Service Definitionï¼‰ API æ¥å£çš„å®šä¹‰ï¼ˆ.proto æ–‡ä»¶ï¼‰å’Œ API æœåŠ¡é…ç½®ï¼ˆ.yaml æ–‡ä»¶ï¼‰ä¸€èµ·å®šä¹‰äº†API æœåŠ¡ API æ¶ˆè´¹è€…ï¼ˆAPI Consumerï¼‰ æ¶ˆè´¹ API æœåŠ¡çš„å®ä½“ã€‚å¯¹äº Google APIï¼ŒAPI æ¶ˆè´¹è€…ä¸€èˆ¬æ˜¯æ‹¥æœ‰å®¢æˆ·ç«¯ç¨‹åºæˆ–æœåŠ¡ç«¯èµ„æºçš„ Google é¡¹ç›®ã€‚ API ç”Ÿäº§è€…ï¼ˆAPI Producerï¼‰ äº§ç”Ÿ API æœåŠ¡çš„å®ä½“ã€‚å¯¹äº Google APIï¼ŒAPI ç”Ÿäº§è€…ä¸€èˆ¬æ˜¯æ‹¥æœ‰ API æœåŠ¡çš„ Google é¡¹ç›®ã€‚ API åç«¯ï¼ˆAPI Backendï¼‰ ä¸º API æœåŠ¡å®ç°äº†ä¸šåŠ¡é€»è¾‘çš„ä¸€ç»„æœåŠ¡å’Œç›¸å…³çš„åŸºç¡€è®¾æ–½ã€‚ API å‰ç«¯ï¼ˆAPI Frontendï¼‰ é€šè¿‡ API æœåŠ¡æä¾›é€šç”¨åŠŸèƒ½çš„ä¸€ç»„æœåŠ¡å’Œç›¸å…³çš„åŸºç¡€è®¾æ–½ï¼Œä¾‹å¦‚è´Ÿè½½å‡è¡¡å™¨å’Œè®¤è¯æœåŠ¡å™¨ã€‚æ³¨æ„ï¼šAPI å‰ç«¯å’Œåç«¯å¯èƒ½è·ç¦»å¾ˆè¿‘ä¹Ÿå¯èƒ½å¾ˆè¿œã€‚æœ‰æ—¶å®ƒä»¬å¯èƒ½ä¼šç¼–è¯‘æˆä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶å¹¶è¿è¡Œåœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­ã€‚ æŸ¥çœ‹å…¶ä»–ç« èŠ‚]]></content>
      <tags>
        <tag>æ¶æ„</tag>
        <tag>ç¿»è¯‘</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Google API è®¾è®¡æŒ‡å—ï¼æ–‡ä»¶ç»“æ„]]></title>
    <url>%2F2017%2F04%2Fgoogle-api-design-guide%2Ffile-structure%2F</url>
    <content type="text"><![CDATA[ç¿»è¯‘è‡ª API Design Guide - File Structure gRPC API åº”è¯¥ï¼ˆshouldï¼‰ ä½¿ç”¨ proto3 åœ¨ .proto æ–‡ä»¶ä¸­å®šä¹‰ã€‚ æ–‡ä»¶ä¸­ å¿…é¡»ï¼ˆmustï¼‰ å°†é«˜å±‚çº§å’Œæ›´é‡è¦çš„å®šä¹‰æ”¾åœ¨å…¶ä»–é¡¹ç›®ä¹‹å‰ã€‚åŸå‹æ–‡ä»¶ åº”è¯¥ï¼ˆshouldï¼‰ å‚ç…§ä¸‹é¢çš„é¡ºåºï¼š ç‰ˆæƒå’Œè®¸å¯åè®®ï¼ˆå¦‚æœéœ€è¦ï¼‰ æŒ‰ç…§ syntax, package, option å’Œ import çš„é¡ºåºå†™çš„åŸå‹ API æ¦‚è¿°æ–‡æ¡£ ä»¥å¼•å…¥é¡ºåºé™åºæ’åˆ—çš„ service å®šä¹‰ èµ„æº message å®šä¹‰ï¼Œçˆ¶èµ„æº å¿…é¡»ï¼ˆmustï¼‰ åœ¨å­èµ„æºä¹‹å‰å®šä¹‰ RPC è¯·æ±‚å’Œå“åº”çš„ message å®šä¹‰ï¼Œä¸å¯¹åº”æ–¹æ³•çš„é¡ºåºç›¸åŒã€‚æ¯ä¸ªè¯·æ±‚ä¿¡æ¯ å¿…é¡»ï¼ˆmustï¼‰ åœ¨å¯¹åº”å“åº”ä¿¡æ¯ä¹‹å‰ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ å¦‚æœä¸€ä¸ªåŸå‹æ–‡ä»¶åŒ…å«äº†æ‰€æœ‰çš„ APIï¼Œé‚£ä¹ˆå®ƒåº”è¯¥ä»¥ API åå­—å‘½åï¼š API Proto Library library.proto Calendar calendar.proto å¦‚æœéœ€è¦çš„è¯ï¼Œå¯ä»¥å°†ä¸€ä¸ªå¤§ .proto æ–‡ä»¶ä¸­çš„æœåŠ¡ã€èµ„æºæ¶ˆæ¯ã€è¯·æ±‚/å“åº”æ¶ˆæ¯ç§»åŠ¨åˆ°å•ç‹¬çš„æ–‡ä»¶ä¸­ã€‚ æ¨èåœ¨å•ç‹¬çš„æ–‡ä»¶ä¸­ä¿å­˜å•ç‹¬çš„æœåŠ¡å’Œå¯¹åº”çš„è¯·æ±‚å“åº”æ¶ˆæ¯ï¼Œå°†æ–‡ä»¶å‘½åä¸º &lt;enclosed service name&gt;.protoã€‚å¯¹äºåªæœ‰èµ„æºçš„åŸå‹æ–‡ä»¶ï¼Œå¯å°†å®ƒå‘½åä¸º resources.protoã€‚ proto æ–‡ä»¶å proto æ–‡ä»¶ åº”è¯¥ï¼ˆshouldï¼‰ ä»¥å°å†™å­—æ¯ä¸‹åˆ’çº¿åˆ†éš”çš„åå­—å‘½åï¼Œå¹¶ä¸” ä¸€å®šï¼ˆmustï¼‰ è¦ä½¿ç”¨ .proto åšä¸ºåç¼€ã€‚ä¾‹å¦‚ï¼šservice_controller.protoã€‚ proto option ä¸ºäº†åœ¨ä¸åŒ API ä¸­ç”Ÿæˆä¸€è‡´çš„å®¢æˆ·ç«¯åº“ï¼ŒAPI å¼€å‘è€… å¿…é¡»ï¼ˆmustï¼‰ åœ¨ .proto æ–‡ä»¶ä¸­ä½¿ç”¨ä¸€è‡´çš„ proto optionã€‚å‚ç…§æœ¬æŒ‡å—çš„ API å®šä¹‰ å¿…é¡»ï¼ˆmustï¼‰ ä½¿ç”¨å¦‚ä¸‹çš„ optionï¼š 1234567891011121314151617181920212223242526272829303132syntax = &quot;proto3&quot;;// åŒ…åè¦ä»¥å…¬å¸åå¼€å§‹ï¼Œä»¥ä¸»ç‰ˆæœ¬å·ç»“æŸpackage google.abc.xyz.v1;// è¿™ä¸ª option è¡¨ç¤º namespace åœ¨ C# ä¸­ä½¿ç”¨ã€‚é»˜è®¤ä½¿ç”¨åŒ…åçš„å¸•æ–¯å¡å‘½åæ³•ï¼Œå½“åŒ…åç”±ä¸€ä¸ª// å•è¯çš„å½“åŒ…åç”±ä¸€ä¸ªå•è¯çš„å­—æ®µç»„æˆæ—¶è¿™æ ·æ˜¯æ²¡é—®é¢˜çš„ã€‚// ä¾‹å¦‚ï¼ŒåŒ…å &quot;google.shopping.pets.v1&quot; åº”è¯¥ä½¿ç”¨ &quot;Google.Shopping.Pets.V1&quot; æ ¼å¼çš„// C# namespaceã€‚// ä½†æ˜¯å¦‚æœæœ‰å¤šä¸ªå•è¯ç»„æˆçš„å­—æ®µæ—¶ï¼Œè¿™ä¸ª option å°±éœ€è¦é¿å…åªæœ‰é¦–ä¸ªå•è¯å¤§å†™ã€‚// ä¾‹å¦‚ï¼ŒGoogle Pet Store API çš„åŒ…åå¯ä»¥æ˜¯ &quot;google.shopping.petstore.v1&quot;ï¼Œæ„å‘³ç€å®ƒ// å¯¹åº”çš„ C# namespace æ˜¯ &quot;Google.Shopping.Petstore.V1&quot;ã€‚å› ä¸º option åº”è¯¥å°†å®ƒæ”¹ä¸º// &quot;Google.Shopping.PetStore.V1&quot;ã€‚// å¯¹äº C#/.NET å‘½åæ ¼å¼çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹[Framework Design Guidelines](https://msdn// .microsoft.com/en-us/library/ms229043)option csharp_namespace = &quot;Google.Abc.Xyz.V1&quot;;// è¿™ä¸ª option å…è®¸ proto ç¼–è¯‘å™¨åœ¨åŒ…åè€Œä¸æ˜¯å¤–éƒ¨ç±»ä¸­ç”Ÿæˆ Java ä»£ç ã€‚é€šè¿‡å‡å°‘ä¸€å±‚åå­—å’Œ// ä¿æŒä¸å…¶ä»–å¤§éƒ¨åˆ†ä¸æ”¯æŒå¤–éƒ¨ç±»ç›¸åŒæé«˜äº†å¼€å‘è€…çš„ä½¿ç”¨ä½“éªŒã€‚option java_multiple_files = true;// Java å¤–éƒ¨ç±»åº”è¯¥ä»¥æ–‡ä»¶åçš„é¦–å­—æ¯å¤§å†™çš„é©¼å³°å‘½åæ³•å‘½åã€‚è¿™ä¸ªç±»åªç”¨äºä¿å­˜ proto çš„æè¿°ç¬¦ï¼Œ// æ‰€ä»¥å¼€å‘è€…ä¸éœ€è¦ç›´æ¥ä½¿ç”¨å®ƒã€‚option java_outer_classname = &quot;XyzProto&quot;;// Java åŒ…åå¿…é¡»æ˜¯æ·»åŠ äº†åˆé€‚å‰ç¼€çš„ proto åŒ…åoption java_package = &quot;com.google.abc.xyz.v1&quot;;// ä»åŒ…ä¸­ç”Ÿæˆ Objective-C ç¬¦å·çš„å‰ç¼€ã€‚æœ€çŸ­ 3 ä¸ªå­—ç¬¦ã€å…¨å¤§å†™å¹¶ä¸”æƒ¯ä¾‹æ˜¯ä½¿ç”¨åŒ…åçš„ç¼©å†™ã€‚// ä¸€äº›è¾ƒçŸ­ä½†è¶³å¤Ÿå”¯ä¸€ä¸ä¼šä¸å…¶ä»–å†²çªçš„åå­—ä¹‹åå¯èƒ½ä¼šè¢«ä½¿ç”¨ã€‚&apos;GPB&apos; è¢« protocol buffer// ä¿ç•™ä½¿ç”¨ã€‚option objc_class_prefix = &quot;GABCX&quot;; æŸ¥çœ‹å…¶ä»–ç« èŠ‚]]></content>
      <tags>
        <tag>æ¶æ„</tag>
        <tag>ç¿»è¯‘</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Google API è®¾è®¡æŒ‡å—ï¼ç›®å½•ç»“æ„]]></title>
    <url>%2F2017%2F04%2Fgoogle-api-design-guide%2Fdirectory-structure%2F</url>
    <content type="text"><![CDATA[ç¿»è¯‘è‡ª API Design Guide - Directory Structure é€šå¸¸ä½¿ç”¨ .proto æ–‡ä»¶å®šä¹‰ APIï¼Œä½¿ç”¨ .yaml æ–‡ä»¶åšä¸ºé…ç½®ã€‚ æ¯ä¸ª API æœåŠ¡ å¿…é¡»ï¼ˆmustï¼‰ æœ‰ä¸€ä¸ª API ç›®å½•æ¥å­˜æ”¾å®šä¹‰æ–‡ä»¶å’Œæ„å»ºè„šæœ¬ã€‚ API ç›®å½• åº”è¯¥ï¼ˆshouldï¼‰ éµå¾ªå¦‚ä¸‹çš„æ ‡å‡†ç»“æ„ï¼š API ç›®å½• é…ç½®æ–‡ä»¶ {service}.yamlï¼šä¸»æœåŠ¡çš„é…ç½®æ–‡ä»¶ï¼Œgoogle.api.Service çš„ YAML æ ¼å¼ prod.yamlï¼šäº§å“ç¯å¢ƒé…ç½®æ–‡ä»¶ staging.yamlï¼šStaging ç¯å¢ƒé…ç½®æ–‡ä»¶ test.yamlï¼šæµ‹è¯•ç¯å¢ƒé…ç½®æ–‡ä»¶ local.yamlï¼šæœ¬åœ°ç¯å¢ƒé…ç½®æ–‡ä»¶ æ¥å£å®šä¹‰ v[0-9]*/*ï¼šæ¯ä¸€ä¸ªå­ç›®å½•åŒ…å« API çš„ä¸€ä¸ªä¸»ç‰ˆæœ¬ï¼Œä¸»è¦å­˜æ”¾åŸå‹æ–‡ä»¶å’Œæ„å»ºè„šæœ¬ {subapi}/v[0-9]*/*ï¼šæ¯ä¸€ä¸ª {subapi} ç›®å½•åŒ…å«å­ API çš„æ¥å£å®šä¹‰ã€‚æ¯ä¸ªå­ API å¯ä»¥æœ‰å®ƒç‹¬ç«‹çš„ä¸»ç‰ˆæœ¬å· type/*ï¼š åŒ…å«ç±»å‹å®šä¹‰çš„åŸå‹æ–‡ä»¶ï¼ŒåŒ…æ‹¬è¿™äº›ï¼šåœ¨ä¸åŒ API é—´å…±äº«çš„ç±»å‹ã€ä¸åŒ API ç‰ˆæœ¬é—´å…±äº«çš„ç±»å‹æˆ– API ä¸æœåŠ¡å®ç°é—´å…±äº«çš„ç±»å‹ã€‚ä¸€æ—¦å‘å¸ƒï¼Œtype/* ä¸­å®šä¹‰çš„ç±»å‹ ä¸åº”è¯¥ï¼ˆshould notï¼‰ æœ‰ç ´åå…¼å®¹æ€§çš„ä¿®æ”¹ã€‚ æŸ¥çœ‹å…¶ä»–ç« èŠ‚]]></content>
      <tags>
        <tag>æ¶æ„</tag>
        <tag>ç¿»è¯‘</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Google API è®¾è®¡æŒ‡å—ï¼å…¼å®¹æ€§]]></title>
    <url>%2F2017%2F04%2Fgoogle-api-design-guide%2Fcompatibility%2F</url>
    <content type="text"><![CDATA[ç¿»è¯‘è‡ª API Design Guide - Compatibility æœ¬ç« æä¾›äº†æœ‰å…³ç‰ˆæœ¬æ§åˆ¶éƒ¨åˆ†ä¸­ç»™å‡ºçš„ç ´åå’Œä¿æŒå…¼å®¹æ€§ä¿®æ”¹çš„è¯¦ç»†è¯´æ˜ã€‚ å¹¶ä¸æ€»æ˜¯ç»å¯¹æ¸…æ¥šä»€ä¹ˆæ˜¯ä¸å…¼å®¹çš„ä¿®æ”¹ï¼Œè¿™ç¯‡æŒ‡å— åº”è¯¥ï¼ˆshouldï¼‰ è¢«å½“æˆå‚è€ƒæ€§çš„ï¼Œè€Œä¸æ˜¯è¦†ç›–åˆ°æ‰€æœ‰æƒ…å†µã€‚ ä¸‹é¢åˆ—å‡ºçš„è¿™äº›è§„åˆ™åªæ¶‰åŠå®¢æˆ·ç«¯å…¼å®¹æ€§ï¼Œé»˜è®¤ API ä½œè€…äº†è§£éƒ¨ç½²ï¼ˆåŒ…æ‹¬å®ç°ç»†èŠ‚çš„å˜åŒ–ï¼‰çš„éœ€æ±‚ã€‚ ä¸€èˆ¬çš„ç›®æ ‡æ˜¯æœåŠ¡ç«¯å‡çº§ minor æˆ– patch ä¸èƒ½å½±å“å®¢æˆ·ç«¯çš„å…¼å®¹æ€§ï¼š ä»£ç å…¼å®¹ï¼šé’ˆå¯¹ 1.0 ç¼–å†™çš„ä»£ç åœ¨ 1.1 ä¸Šç¼–è¯‘å¤±è´¥ äºŒè¿›åˆ¶å…¼å®¹ï¼šé’ˆå¯¹ 1.0 ç¼–è¯‘çš„ä»£ç ä¸ 1.1 å®¢æˆ·ç«¯çš„åº“é“¾æ¥/è¿è¡Œå¤±è´¥ï¼ˆå…·ä½“çš„ç»†èŠ‚ä¾èµ–å®¢æˆ·ç«¯ï¼Œä¸åŒæƒ…å†µæœ‰ä¸åŒå˜åŒ–ï¼‰ åè®®å…¼å®¹ï¼šé’ˆå¯¹ 1.0 æ„å»ºçš„ç¨‹åºä¸ 1.1 æœåŠ¡ç«¯é€šä¿¡å¤±è´¥ è¯­ä¹‰å…¼å®¹ï¼šæ‰€æœ‰ç»„ä»¶éƒ½èƒ½è¿è¡Œä½†äº§ç”Ÿæ„æƒ³ä¸åˆ°çš„ç»“æœ ç®€è€Œè¨€ä¹‹ï¼šæ—§çš„å®¢æˆ·ç«¯åº”è¯¥ä¸ç›¸åŒ major ç‰ˆæœ¬çš„æ–°æœåŠ¡ç«¯æ­£å¸¸å·¥ä½œï¼Œå¹¶ä¸”èƒ½å¤Ÿè½»æ¾åœ°å‡çº§åˆ°æ–°çš„ minor ç‰ˆæœ¬ã€‚ ç”±äºå®¢æˆ·ç«¯ä½¿ç”¨äº†è‡ªåŠ¨ç”Ÿæˆå’Œæ‰‹å†™çš„ä»£ç ï¼Œé™¤äº†ç†è®ºä¸Šçš„åŸºäºåè®®çš„è€ƒè™‘ï¼Œè¿˜æœ‰ä¸€äº›å®é™…çš„é—®é¢˜ã€‚é€šè¿‡ç”Ÿæˆæ–°ç‰ˆæœ¬çš„å®¢æˆ·ç«¯åº“æ¥æµ‹è¯•ä½ çš„ä¿®æ”¹ï¼Œå¹¶ä¿è¯æµ‹è¯•é€šè¿‡ã€‚ ä¸‹é¢çš„è®¨è®ºå°† proto ä¿¡æ¯åˆ†ä¸ºä¸‰ç±»ï¼š è¯·æ±‚ä¿¡æ¯ï¼ˆä¾‹å¦‚ GetBookRequestï¼‰ å“åº”ä¿¡æ¯ï¼ˆä¾‹å¦‚ ListBooksResponseï¼‰ èµ„æºä¿¡æ¯ï¼ˆä¾‹å¦‚ Bookï¼ŒåŒ…æ‹¬åœ¨å…¶ä»–èµ„æºæ¶ˆæ¯ä¸­ä½¿ç”¨çš„ä»»ä½•æ¶ˆæ¯ï¼‰ è¿™ä¸‰ç±»æœ‰ä¸åŒçš„è§„åˆ™ï¼Œä¾‹å¦‚è¯·æ±‚ä¿¡æ¯åªä¼šä»å®¢æˆ·ç«¯å‘é€åˆ°æœåŠ¡ç«¯ï¼Œå“åº”ä¿¡æ¯åªä¼šä»æœåŠ¡ç«¯å‘é€åˆ°å®¢æˆ·ç«¯ï¼Œä½†èµ„æºä¿¡æ¯ä¸€èˆ¬ä¼šåœ¨ä¸¤è€…ä¹‹é—´äº’ç›¸å‘é€ã€‚å°¤å…¶æ˜¯å¯è¢«ä¿®æ”¹çš„èµ„æºéœ€è¦æ ¹æ®è¯»å–/ä¿®æ”¹/å†™å…¥çš„å¾ªç¯æ¥è€ƒè™‘ã€‚ ä¿æŒå‘åå…¼å®¹çš„ä¿®æ”¹ å‘ API æœåŠ¡ä¸­æ·»åŠ  API æ¥å£ ä»åè®®çš„è§’åº¦çœ‹ï¼Œè¿™ç§ä¿®æ”¹æ€»æ˜¯å®‰å…¨çš„ã€‚å”¯ä¸€éœ€è¦è€ƒè™‘çš„æ˜¯å®¢æˆ·ç«¯åº“å¯èƒ½å·²ç»é€šè¿‡æ‰‹å†™çš„ä»£ç ä½¿ç”¨äº†æ–° API æ¥å£çš„åå­—ã€‚å¦‚æœæ–°æ¥å£ä¸å…¶å®ƒå®Œå…¨æ­£äº¤ï¼Œè¿™ç§æƒ…å†µä¸å¤ªå¯èƒ½å‘ç”Ÿã€‚å¦‚æœæ˜¯å·²å­˜æ¥å£çš„ç®€åŒ–ç‰ˆæœ¬ï¼Œåˆ™å¾ˆå¯èƒ½å¼•èµ·å†²çªã€‚ å‘ API æ¥å£ä¸­æ·»åŠ æ–¹æ³• é™¤éæ·»åŠ äº†ä¸€ä¸ªä¸ç°æœ‰å®¢æˆ·ç«¯åº“ä¸­æ–¹æ³•å†²çªçš„æ–¹æ³•ï¼Œè¿™ç§ä¿®æ”¹æ²¡æœ‰é—®é¢˜ã€‚ ä¸€ä¸ªä¼šç ´åå…¼å®¹æ€§çš„ä¾‹å­ï¼šå¦‚æœæœ‰ GetFoo æ–¹æ³•ï¼ŒC# ä»£ç ç”Ÿæˆå™¨å·²ç»åˆ›å»ºäº† GetFoo å’Œ GetFooAsync æ–¹æ³•ã€‚å› æ­¤ä»å®¢æˆ·ç«¯è§’åº¦æ¥çœ‹ï¼Œåœ¨ API æ¥å£ä¸­æ·»åŠ  GetFooAsync æ–¹æ³•å°†ä¼šç ´åå…¼å®¹æ€§ã€‚ å‘æ–¹æ³•æ·»åŠ  HTTP ç»‘å®š å‡è®¾ç»‘å®šæ²¡æœ‰å¼•å…¥ä»»ä½•æ­§ä¹‰ï¼Œä½¿æœåŠ¡ç«¯å“åº”ä»¥å‰è¢«æ‹’ç»çš„ URL æ˜¯å®‰å…¨çš„ã€‚å½“å°†ç°æœ‰æ“ä½œåº”ç”¨äºæ–°çš„èµ„æºåç§°æ—¶ï¼Œå¯èƒ½ï¼ˆmayï¼‰ ä¼šè¿™æ ·åšã€‚ å‘è¯·æ±‚ä¿¡æ¯æ·»åŠ å­—æ®µ æ·»åŠ è¯·æ±‚å­—æ®µå¯ä»¥æ˜¯å…¼å®¹çš„ï¼Œåªè¦ä¸æŒ‡å®šè¯¥å­—æ®µçš„å®¢æˆ·ç«¯åœ¨æ–°ç‰ˆæœ¬ä¸­ä¸æ—§ç‰ˆæœ¬è¡¨ç°ç›¸åŒã€‚ ä¼šå¯¼è‡´é”™è¯¯çš„æœ€æ˜æ˜¾ä¾‹å­æ˜¯åˆ†é¡µï¼šå¦‚æœ API çš„ v1.0 ç‰ˆæœ¬ä¸æ”¯æŒï¼Œé™¤é page_size é»˜è®¤å€¼æ˜¯æ— ç©·å¤§ï¼ˆè¿™æ ·æ˜¯ä¸å¥½çš„ï¼‰æ‰èƒ½åœ¨ v1.1 ä¸­åŠ å…¥åˆ†é¡µã€‚å¦åˆ™ v1.0 çš„å®¢æˆ·ç«¯åŸæœ¬å¸Œæœ›é€šè¿‡ä¸€æ¬¡è¯·æ±‚å–å¾—æ‰€æœ‰ç»“æœï¼Œä½†å®é™…åªèƒ½å–åˆ°ä¸€éƒ¨åˆ†ã€‚ å‘å“åº”ä¿¡æ¯æ·»åŠ å­—æ®µ åªè¦ä¸æ”¹å˜å…¶ä»–å“åº”å­—æ®µçš„è¡Œä¸ºï¼Œå°±å¯ä»¥æ‰©å±•ä¸æ˜¯èµ„æºçš„å“åº”æ¶ˆæ¯ï¼ˆä¾‹å¦‚ListBooksResponseï¼‰ï¼Œè€Œä¸ä¼šç ´åå…¼å®¹æ€§ã€‚å³ä½¿å¯¼è‡´å†—ä½™ï¼Œä»»ä½•åœ¨æ—§çš„å“åº”æ¶ˆæ¯ä¸­çš„å­—æ®µä¹Ÿåº”è¯¥å­˜åœ¨äºæ–°çš„å“åº”ä¸­å¹¶ä¿æŒå®ƒåŸæ¥çš„è¯­ä¹‰ã€‚ ä¾‹å¦‚ï¼Œ1.0 ä¸­çš„ä¸€ä¸ªæŸ¥è¯¢è¯·æ±‚çš„å“åº”æœ‰ bool ç±»å‹çš„å­—æ®µ contained_duplicates æ¥æŒ‡ç¤ºå› ä¸ºé‡å¤è€Œå¿½ç•¥æ‰çš„ç»“æœã€‚åœ¨ 1.1 ä¸­ï¼Œæˆ‘ä»¬åœ¨ duplicate_count å­—æ®µä¸­æä¾›æ›´è¯¦ç»†çš„ä¿¡æ¯ï¼Œå°½ç®¡ä» 1.1 ç‰ˆæœ¬æ¥çœ‹æ˜¯å¤šä½™çš„ï¼Œä½† contained_duplicates å­—æ®µ å¿…é¡»ï¼ˆmustï¼‰ è¦ä¿ç•™ã€‚ å‘æšä¸¾æ·»åŠ å€¼ åªåœ¨è¯·æ±‚ä¿¡æ¯ä¸­ä½¿ç”¨çš„æšä¸¾ç±»å‹å¯ä»¥è‡ªç”±æ‰©å±•æ¥æ·»åŠ æ–°å…ƒç´ ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨èµ„æºè§†å›¾æ—¶ï¼Œæ–°çš„è§†å›¾èƒ½å¤Ÿæ·»åŠ åˆ°æ–° minor ç‰ˆæœ¬ä¸­ã€‚å®¢æˆ·ç«¯ä»æ¥ä¸éœ€è¦æ¥æ”¶æ­¤æšä¸¾ï¼Œæ‰€ä»¥ä¹Ÿä¸éœ€è¦å…³å¿ƒå®ƒã€‚ å¯¹äºèµ„æºæ¶ˆæ¯å’Œå“åº”æ¶ˆæ¯ï¼Œé»˜è®¤å‡è®¾å®¢æˆ·ç«¯åº”è¯¥å¤„ç†å®ƒæ„è¯†ä¸åˆ°çš„æšä¸¾å€¼ã€‚ä½†æ˜¯ API ä½œè€…åº”è¯¥æ„è¯†åˆ°ç¼–å†™èƒ½å¤Ÿæ­£ç¡®å¤„ç†æ–°æšä¸¾å€¼çš„ä»£ç å¯èƒ½æ˜¯å›°éš¾çš„ã€‚åº”è¯¥ï¼ˆshouldï¼‰ åœ¨æ–‡æ¡£ä¸­è®°å½•å½“é‡åˆ°æœªçŸ¥æšä¸¾å€¼æ—¶å®¢æˆ·ç«¯çš„æœŸæœ›è¡Œä¸ºã€‚ proto3 å…è®¸å®¢æˆ·ç«¯æ¥æ”¶å®ƒä»¬ä¸å…³å¿ƒçš„å€¼å¹¶ä¸”å½“æ‰§è¡Œé‡æ–°åºåˆ—åŒ–æ¶ˆæ¯æ—¶ä¼šä¿æŒå€¼ä¸å˜ï¼Œæ‰€ä»¥è¿™æ ·å°±ä¸ä¼šæ‰“ç ´è¯»å–/ä¿®æ”¹/å†™å…¥å¾ªç¯çš„å…¼å®¹æ€§ã€‚JSON æ ¼å¼å…è®¸å‘é€æ•°å€¼ï¼Œå…¶ä¸­è¯¥å€¼çš„â€œåç§°â€æ˜¯æœªçŸ¥çš„ï¼Œä½†æ˜¯æœåŠ¡ç«¯é€šå¸¸ä¸ä¼šçŸ¥é“å®¢æˆ·ç«¯æ˜¯å¦çœŸæ­£çŸ¥é“ç‰¹å®šå€¼ã€‚å› æ­¤ JSON å®¢æˆ·ç«¯å¯èƒ½çŸ¥é“å®ƒä»¬å·²ç»æ”¶åˆ°äº†ä»¥å‰å¯¹ä»–ä»¬æœªçŸ¥çš„å€¼ï¼Œä½†ä»–ä»¬åªä¼šçœ‹åˆ°åç§°æˆ–æ•°å­—è€Œä¸æ˜¯ä¸¤ä¸ªéƒ½æœ‰ã€‚åœ¨è¯»å–/ä¿®æ”¹/å†™å…¥å¾ªç¯ä¸­å°†ç›¸åŒçš„å€¼è¿”å›ç»™æœåŠ¡ç«¯ä¸åº”è¯¥ä¿®æ”¹è¿™ä¸ªå€¼ï¼Œå› ä¸ºæœåŠ¡ç«¯åº”è¯¥ç†è§£è¿™ä¸¤ç§å½¢å¼ã€‚ æ·»åŠ åªè¾“å‡ºï¼ˆoutput-onlyï¼‰çš„èµ„æºå­—æ®µ å¯ä»¥ï¼ˆmayï¼‰ æ·»åŠ ä»…ç”±æœåŠ¡ç«¯æä¾›çš„èµ„æºå®ä½“ä¸­çš„å­—æ®µã€‚æœåŠ¡ç«¯ å¯ä»¥ï¼ˆmayï¼‰ éªŒè¯è¯·æ±‚ä¸­çš„å€¼æ˜¯å¦æœ‰æ•ˆï¼Œä½†æ˜¯å¦‚æœè¯¥å€¼è¢«çœç•¥åˆ™ ä¸€å®šä¸èƒ½ï¼ˆmust notï¼‰ å¤±è´¥ã€‚ ç ´åå‘åå…¼å®¹çš„ä¿®æ”¹ åˆ é™¤/é‡å‘½åæœåŠ¡ã€æ¥å£ã€å­—æ®µåã€æ–¹æ³•æˆ–æšä¸¾å€¼ ä»æ ¹æœ¬ä¸Šè¯´ï¼Œå¦‚æœå®¢æˆ·ç«¯ä»£ç ä½¿ç”¨äº†æŸäº›å­—æ®µï¼Œé‚£ä¹ˆåˆ é™¤æˆ–é‡å‘½åå®ƒå°†ä¼šç ´åå…¼å®¹æ€§ï¼Œå¹¶ä¸” å¿…é¡»ï¼ˆmustï¼‰ å¢åŠ  major ç‰ˆæœ¬å·ã€‚å¼•ç”¨æ—§åç§°çš„ä¸€äº›è¯­è¨€ï¼ˆå¦‚ C# å’Œ Javaï¼‰åœ¨ç¼–è¯‘æ—¶ä¼šå¤±è´¥ï¼Œ å¦ä¸€äº›è¯­è¨€ä¼šå¼•èµ·è¿è¡Œæ—¶å¼‚å¸¸æˆ–æ•°æ®ä¸¢å¤±ã€‚åè®®æ ¼å¼çš„å…¼å®¹æ€§åœ¨è¿™é‡Œæ˜¯æ— å…³ç´§è¦çš„ã€‚ ä¿®æ”¹ HTTP ç»‘å®š è¿™é‡Œçš„ä¿®æ”¹å®é™…æŒ‡åˆ é™¤å’Œæ·»åŠ ã€‚ä¾‹å¦‚ï¼Œä½ æƒ³è¦æ”¯æŒ PATCHï¼Œä½†å·²å‘å¸ƒçš„ç‰ˆæœ¬æ”¯æŒ PUTï¼Œæˆ–è€…å·²ç»ä½¿ç”¨äº†é”™è¯¯çš„è‡ªå®šä¹‰åŠ¨è¯ï¼Œä½  å¯ä»¥ï¼ˆmayï¼‰ æ·»åŠ æ–°çš„ç»‘å®šï¼Œä½†æ˜¯ ä¸€å®šä¸è¦ï¼ˆmust notï¼‰ ç§»é™¤æ—§çš„ï¼Œå› ä¸ºå’Œåˆ é™¤æœåŠ¡çš„æ–¹æ³•ä¸€æ ·ä¼šç ´åå…¼å®¹æ€§ã€‚ ä¿®æ”¹å­—æ®µç±»å‹ å°½ç®¡æ–°ç±»å‹æ˜¯åè®®å…¼å®¹çš„ï¼Œèƒ½å¤Ÿæ”¹å˜å®¢æˆ·ç«¯åº“è‡ªåŠ¨ç”Ÿæˆçš„ä»£ç ï¼Œå› æ­¤ å¿…é¡»ï¼ˆmustï¼‰ è¦å‡çº§ major ç‰ˆæœ¬ã€‚ä¼šå¯¼è‡´éœ€è¦ç¼–è¯‘çš„é™æ€ç±»å‹çš„è¯­è¨€åœ¨ç¼–è¯‘æœŸå°±å‘ç”Ÿé”™è¯¯ã€‚ ä¿®æ”¹èµ„æºåçš„æ ¼å¼ èµ„æº ä¸€å®šä¸èƒ½ï¼ˆmust notï¼‰ ä¿®æ”¹åå­—ï¼è¿™æ„å‘³ç€é›†åˆåä¸èƒ½è¢«ä¿®æ”¹ã€‚ ä¸åƒå…¶ä»–å¤§å¤šæ•°ç ´åå…¼å®¹æ€§çš„ä¿®æ”¹ï¼Œè¿™ä¼šå½±å“ major ç‰ˆæœ¬å·ï¼šå¦‚æœå®¢æˆ·ç«¯æœŸæœ›ä½¿ç”¨ v2.0 è®¿é—®åœ¨ v1.0 ä¸­åˆ›å»ºçš„èµ„æºï¼ˆæˆ–åè¿‡æ¥ï¼‰ï¼Œåˆ™åº”è¯¥åœ¨ä¸¤ä¸ªç‰ˆæœ¬ä¸­ä½¿ç”¨ç›¸åŒçš„èµ„æºåç§°ã€‚ å¯¹èµ„æºåçš„éªŒè¯ä¹Ÿ ä¸åº”è¯¥ï¼ˆshould notï¼‰ æ”¹å˜ï¼ŒåŸå› å¦‚ä¸‹ï¼š å¦‚æœéªŒè¯å˜ä¸¥æ ¼ï¼Œä¹‹å‰æˆåŠŸèƒ½è¯·æ±‚ç°åœ¨å¯èƒ½ä¼šå¤±è´¥ å¦‚æœæ¯”ä¹‹å‰æ–‡æ¡£ä¸­è®°å½•çš„éªŒè¯è¦å®½æ¾ï¼Œä¾æ®ä¹‹å‰æ–‡æ¡£çš„å®¢æˆ·ç«¯å¯èƒ½ä¼šè¢«ç ´åã€‚å®¢æˆ·ç«¯å¾ˆå¯èƒ½åœ¨å…¶ä»–åœ°æ–¹ä¿å­˜äº†èµ„æºåï¼Œå¹¶ä¸”å¯¹å­—ç¬¦é›†å’Œåå­—çš„é•¿åº¦æ•æ„Ÿã€‚æˆ–è€…ï¼Œå®¢æˆ·ç«¯å¯èƒ½ä¼šæ‰§è¡Œè‡ªå·±çš„èµ„æºåç§°éªŒè¯æ¥ä¿æŒä¸æ–‡æ¡£ä¸€è‡´ã€‚ï¼ˆä¾‹å¦‚ï¼Œå½“å¼€å§‹æ”¯æŒ EC2 èµ„æºçš„é•¿ ID æ—¶ï¼Œäºšé©¬é€Šå‘ç”¨æˆ·å‘å‡ºäº†è®¸å¤šè­¦å‘Šå¹¶æä¾›äº†è¿ç§»çš„æ—¶é—´ï¼‰ è¯·æ³¨æ„è¿™æ ·çš„ä¿®æ”¹åªèƒ½åœ¨ proto çš„æ–‡æ¡£ä¸­å¯è§ã€‚å› æ­¤å½“è¯„å®¡ CL æ—¶å®¡æŸ¥é™¤æ³¨é‡Šå¤–çš„ä¿®æ”¹æ˜¯ä¸å¤Ÿçš„ã€‚ ä¿®æ”¹å·²æœ‰è¯·æ±‚çš„å¯è§æ€§ï¼ˆvisible behaviorï¼‰ å®¢æˆ·ç«¯æ€»æ˜¯ä¾èµ– API çš„è¡Œä¸ºå’Œè¯­ä¹‰ï¼Œå³ä½¿æ²¡æœ‰æ˜ç¡®æ”¯æŒæˆ–è®°å½•æ­¤è¡Œä¸ºã€‚å› ä¸ºåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ä¿®æ”¹ API çš„è¡Œä¸ºå’Œè¯­ä¹‰åœ¨å®¢æˆ·ç«¯çœ‹æ¥æ˜¯ç ´åæ€§çš„ã€‚å¦‚æœæŸè¡Œä¸ºä¸æ˜¯åŠ å¯†éšè—çš„ï¼Œä½  åº”è¯¥ï¼ˆshouldï¼‰ å‡è®¾ç”¨æˆ·å·²ç»ä¾èµ–å®ƒäº†ã€‚ å› ä¸ºè¿™ä¸ªåŸå› åŠ å¯†åˆ†é¡µ token æ˜¯ä¸ªå¥½ä¸»æ„ï¼Œä»¥é˜²æ­¢ç”¨æˆ·åˆ›å»ºè‡ªå·±çš„ tokenï¼Œä»¥åŠé˜²æ­¢å½“ token è¡Œä¸ºå‘ç”Ÿå˜åŒ–æ—¶å¯èƒ½å¸¦æ¥çš„ä¸å…¼å®¹æ€§ã€‚ åœ¨ HTTP å®šä¹‰ä¸­ä¿®æ”¹ URL æ ¼å¼ é™¤äº†ä¸Šé¢åˆ—å‡ºçš„èµ„æºåç§°çš„å˜åŒ–ï¼Œè¿™é‡Œè¿˜è¦è€ƒè™‘ä¸¤ç§ç±»å‹çš„ä¿®æ”¹ï¼š è‡ªå®šä¹‰æ–¹æ³•åï¼šè™½ç„¶ä¸æ˜¯èµ„æºåç§°çš„ä¸€éƒ¨åˆ†ï¼Œä½†è‡ªå®šä¹‰æ–¹æ³•åç§°æ˜¯ REST å®¢æˆ·ç«¯ POST è¯·æ±‚ URL çš„ä¸€éƒ¨åˆ†ã€‚æ›´æ”¹è‡ªå®šä¹‰æ–¹æ³•åç§°ä¸åº”è¯¥ç ´å gRPC å®¢æˆ·ç«¯ï¼Œä½†æ˜¯å…¬å…± API å¿…é¡»å‡å®šå®ƒä»¬å…·æœ‰ REST å®¢æˆ·ç«¯ã€‚ èµ„æºå‚æ•°åï¼šä» v1/shelves/{shelf}/books/{book} åˆ° v1/shelves/{shelf_id}/books/{book_id} çš„ä¿®æ”¹ä¸ä¼šå½±å“æ›¿ä»£çš„èµ„æºåç§°ï¼Œä½†å¯èƒ½ä¼šå½±å“ä»£ç ç”Ÿæˆã€‚ åœ¨èµ„æºæ¶ˆæ¯ä¸­æ·»åŠ è¯»/å†™å­—æ®µ å®¢æˆ·ç«¯ä¼šç»å¸¸æ‰§è¡Œè¯»å–/ä¿®æ”¹/å†™å…¥çš„æ“ä½œã€‚å¤§å¤šæ•°å®¢æˆ·ç«¯ä¸æ”¯æŒå®ƒä»¬æ„è¯†ä¸åˆ°çš„å­—æ®µå€¼ï¼Œç‰¹åˆ«æ˜¯ proto3 ä¸æ”¯æŒã€‚ä½ å¯ä»¥æŒ‡å®šä»»æ„æ¶ˆæ¯ç±»å‹ï¼ˆè€Œä¸æ˜¯åŸå§‹ç±»å‹ï¼‰ä¸­ç¼ºå¤±çš„å­—æ®µè¡¨ç¤ºæ›´æ–°æ—¶ä¸ä¼šè¢«ä¿®æ”¹ï¼Œä½†è¿™æ ·ä½¿åˆ é™¤è¿™æ ·çš„å­—æ®µå˜çš„å›°éš¾ã€‚åŸå§‹ç±»å‹ï¼ˆåŒ…æ‹¬ string å’Œ bytesï¼‰ä¸èƒ½ç®€å•åœ°ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œå› ä¸ºæ˜ç¡®åœ°è®¾ç½® int32 çš„å€¼ä¸º 0 å’Œä¸å¯¹å®ƒè®¾ç½®å€¼åœ¨ proto3 ä¸­å¹¶æ²¡æœ‰åŒºåˆ«ã€‚ ä½¿ç”¨å­—æ®µæ©ç æ¥è¿›è¡Œæ‰€æœ‰æ›´æ–°æ“ä½œä¸ä¼šæœ‰é—®é¢˜ï¼Œå› ä¸ºå®¢æˆ·ç«¯ä¸ä¼šéšå¼è¦†ç›–å…¶ä¸çŸ¥é“çš„å­—æ®µã€‚ç„¶è€Œè¿™æ˜¯ä¸€ä¸ªä¸å¯»å¸¸çš„å†³å®šï¼Œå› ä¸ºå¤§éƒ¨åˆ† API å…è®¸å…¨éƒ¨èµ„æºè¢«æ›´æ–°ã€‚ æŸ¥çœ‹å…¶ä»–ç« èŠ‚]]></content>
      <tags>
        <tag>æ¶æ„</tag>
        <tag>ç¿»è¯‘</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Google API è®¾è®¡æŒ‡å—ï¼ç‰ˆæœ¬æ§åˆ¶]]></title>
    <url>%2F2017%2F04%2Fgoogle-api-design-guide%2Fversioning%2F</url>
    <content type="text"><![CDATA[ç¿»è¯‘è‡ª API Design Guide - Versioning è¿™ä¸€ç« æ˜¯ç½‘ç»œ API çš„ç‰ˆæœ¬æ§åˆ¶æŒ‡å—ã€‚å› ä¸ºä¸€ä¸ª API æœåŠ¡ å¯ä»¥ï¼ˆmayï¼‰ æä¾›å¤šä¸ª API æ¥å£ï¼ŒAPI ç‰ˆæœ¬ç­–ç•¥åº”ç”¨åœ¨ API æ¥å£ä¸Šè€Œä¸æ˜¯ API æœåŠ¡ã€‚ä¸ºäº†æ–¹ä¾¿ï¼Œä¸‹é¢çš„ API è¡¨ç¤º API æ¥å£ã€‚ ç½‘ç»œ API åº”è¯¥ï¼ˆshouldï¼‰ ä½¿ç”¨ Semantic Versioningã€‚å¯¹äºç‰ˆæœ¬å· MAJOR.MINOR.PATCHï¼š æœ‰ä¸å…¼å®¹çš„å‡çº§æ—¶ï¼Œå¢åŠ  MAJOR æ·»åŠ äº†èƒ½å‘åå…¼å®¹çš„æ–°åŠŸèƒ½æ—¶ï¼Œå¢åŠ  MINOR ä¿®æ”¹äº†èƒ½å‘åå…¼å®¹çš„ BUG æ—¶ï¼Œå¢åŠ  PATCH æ ¹æ® API ç‰ˆæœ¬çš„ä¸åŒï¼Œmajor ç‰ˆæœ¬å·ä½¿ç”¨ä¸åŒçš„è§„åˆ™ï¼š å¯¹äº version 1(v1)ï¼Œmajor éƒ¨åˆ† åº”è¯¥ï¼ˆshouldï¼‰ åŠ ä¸Š proto çš„åŒ…åå­—ï¼Œä¾‹å¦‚ google.pubsub.v1ã€‚å¦‚æœåŒ…ååŒ…å«ç¨³å®šçš„ç±»å‹å¹¶ä¸”æ¥å£ä¸ä¼šæœ‰ä¸å…¼å®¹çš„æ”¹å˜ï¼Œmajor éƒ¨åˆ† å¯ä»¥ï¼ˆmayï¼‰ å¿½ç•¥ç‰ˆæœ¬å·ï¼Œä¾‹å¦‚ï¼šgoogle.protobuf å’Œ google.longrunningã€‚ å¯¹äºé™¤ v1 å¤–çš„æ‰€æœ‰ç‰ˆæœ¬ï¼Œmajor ç‰ˆæœ¬å· å¿…é¡»ï¼ˆmustï¼‰ åŠ ä¸Š proto çš„åŒ…åå­—ã€‚ä¾‹å¦‚ google.pubsub.v2ã€‚ å¯¹äº pre-GA çš„å‘å¸ƒï¼ˆä¾‹å¦‚ alpha å’Œ betaï¼‰ï¼Œæ¨èåœ¨ç‰ˆæœ¬å·ä¸­æ·»åŠ åç¼€ï¼Œåç¼€ åº”è¯¥ï¼ˆshouldï¼‰ ä»¥ pre-release çš„ç‰ˆæœ¬åï¼ˆä¾‹å¦‚ alphaã€betaï¼‰å’Œå¯é€‰çš„ pre-release ç‰ˆæœ¬å·ç»„æˆã€‚ ç‰ˆæœ¬è¿›åº¦çš„ä¾‹å­ï¼š Version Proto Package Description v1alpha v1alpha1 v1 alpha å‘å¸ƒ v1beta1 v1beta1 v1 beta ç¬¬ä¸€æ¬¡å‘å¸ƒ v1beta2 v1beta2 v1 beta ç¬¬äºŒæ¬¡å‘å¸ƒ v1test v1test å¸¦æœ‰å‡æ•°æ®çš„å†…éƒ¨æµ‹è¯•ç‰ˆ v1 v1 major çš„ç‰ˆæœ¬æ˜¯ v1ï¼Œå¯æ­£å¼ä½¿ç”¨ v1.1beta1 v1p1beta1 å¯¹ v1 ç‰ˆçš„é¦–æ¬¡å°ç‰ˆæœ¬ï¼ˆminorï¼‰ä¿®æ”¹çš„ beta å‘å¸ƒ v1.1 v1 å°ç‰ˆæœ¬å‡çº§åˆ° v1.1 v2beta1 v2beta1 v2 beta ç¬¬ä¸€æ¬¡å‘å¸ƒ v2 v2 major çš„ç‰ˆæœ¬æ˜¯ v2ï¼Œå¯æ­£å¼ä½¿ç”¨ minor å’Œ patch çš„ç‰ˆæœ¬å· åº”è¯¥ï¼ˆshouldï¼‰ è¡¨ç°åœ¨ API é…ç½®å’Œæ–‡æ¡£ä¸­ï¼Œä¸€å®šä¸è¦ï¼ˆmust notï¼‰ å†™åœ¨ proto çš„åŒ…åä¸­ã€‚ æ³¨æ„ï¼šGoogle API å¹³å°ç›®å‰æ²¡æœ‰åŸç”Ÿæ”¯æŒ minor å’Œ patchã€‚å¯¹äºæ¯ä¸€ä¸ª major ç‰ˆæœ¬åªæœ‰ä¸€å¥—æ–‡ä»¶å’Œå®¢æˆ·ç«¯çš„åº“ã€‚API ä½œè€…éœ€è¦é€šè¿‡æ–‡æ¡£å’Œå‘å¸ƒæ—¥å¿—æ‰‹åŠ¨è®°å½• minor å’Œ patchã€‚ æ–°çš„ major ç‰ˆæœ¬å· ä¸€å®šä¸è¦ï¼ˆmust notï¼‰ ä¾èµ– ç›¸åŒ API ä¹‹å‰çš„ major ç‰ˆæœ¬ã€‚åœ¨äº†è§£ç›¸å…³è”çš„ä¾èµ–æ€§å’Œç¨³å®šæ€§é£é™©åï¼ŒAPI å¯ä»¥ï¼ˆmayï¼‰ ä¾èµ–å…¶ä»– APIã€‚ä¸€ä¸ªç¨³å®šçš„ API ç‰ˆæœ¬ å¿…é¡»ï¼ˆmustï¼‰ åªä¾èµ–å…¶ä»– API çš„æœ€æ–°ç¨³å®šç‰ˆæœ¬ã€‚ åœ¨ä¸€æ®µæ—¶é—´å†…ï¼Œç›¸åŒ API çš„ä¸åŒç‰ˆæœ¬ å¿…é¡»ï¼ˆmustï¼‰ åœ¨å•ä¸ªå®¢æˆ·ç«¯ä¸­åŒæ—¶å·¥ä½œã€‚è¿™æ ·æ‰èƒ½å¸®åŠ©å®¢æˆ·ç«¯ä»æ—§ç‰ˆ API å¹³æ»‘è¿ç§»åˆ°æ–°ç‰ˆ APIã€‚ åªæœ‰å½“æ²¡æœ‰ä¾èµ–åæ—§ç‰ˆæœ¬ API æ‰èƒ½è¢«åˆ é™¤ã€‚ è¢«å¤šä¸ª API å…±äº«çš„é€šç”¨ç¨³å®šçš„æ•°æ®ç±»å‹ï¼ˆä¾‹å¦‚æ—¥æœŸå’Œæ—¶é—´ï¼‰ åº”è¯¥ï¼ˆshouldï¼‰ å®šä¹‰åœ¨å•ç‹¬çš„ proto åŒ…ä¸­ã€‚å¦‚æœæœ‰å¿…è¦è¿›è¡Œä¸å…¼å®¹çš„ä¿®æ”¹ï¼Œåˆ™ å¿…é¡»ï¼ˆmustï¼‰ å¼•å…¥æ–°çš„ç±»å‹æˆ–åŒ…å«æ–° major ç‰ˆæœ¬çš„åŒ…ã€‚ å‘åå…¼å®¹ å®šä¹‰ä»€ä¹ˆæ˜¯å‘åå…¼å®¹çš„ä¿®æ”¹æ˜¯æ¯”è¾ƒå›°éš¾çš„ã€‚ ä¸‹é¢åˆ—å‡ºäº†ä¸€äº›ï¼Œä½†å¦‚æœä½ æœ‰ä»»ä½•ç–‘é—®ï¼Œç‚¹å‡»è¿™é‡ŒæŸ¥çœ‹è¯¦æƒ…ã€‚ ä¿æŒå‘åå…¼å®¹çš„ä¿®æ”¹ å‘ API æœåŠ¡ä¸­æ·»åŠ  API æ¥å£ å‘ API æ¥å£ä¸­æ·»åŠ æ–¹æ³• å‘æ–¹æ³•æ·»åŠ  HTTP ç»‘å®š å‘è¯·æ±‚ä¿¡æ¯æ·»åŠ å­—æ®µ å‘å“åº”ä¿¡æ¯æ·»åŠ å­—æ®µ å‘æšä¸¾æ·»åŠ å€¼ æ·»åŠ åªè¾“å‡ºï¼ˆoutput-onlyï¼‰çš„èµ„æºå­—æ®µ ç ´åå‘åå…¼å®¹çš„ä¿®æ”¹ åˆ é™¤/é‡å‘½åæœåŠ¡ã€æ¥å£ã€å­—æ®µåã€æ–¹æ³•æˆ–æšä¸¾å€¼ ä¿®æ”¹ HTTP ç»‘å®š ä¿®æ”¹å­—æ®µç±»å‹ ä¿®æ”¹èµ„æºåçš„æ ¼å¼ ä¿®æ”¹å·²æœ‰è¯·æ±‚çš„å¯è§æ€§ï¼ˆvisible behaviorï¼‰ åœ¨ HTTP å®šä¹‰ä¸­ä¿®æ”¹ URL æ ¼å¼ åœ¨èµ„æºæ¶ˆæ¯ä¸­æ·»åŠ è¯»/å†™å­—æ®µ æŸ¥çœ‹å…¶ä»–ç« èŠ‚]]></content>
      <tags>
        <tag>æ¶æ„</tag>
        <tag>ç¿»è¯‘</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Google API è®¾è®¡æŒ‡å—ï¼ä½¿ç”¨ proto3]]></title>
    <url>%2F2017%2F04%2Fgoogle-api-design-guide%2Fproto3%2F</url>
    <content type="text"><![CDATA[ç¿»è¯‘è‡ª API Design Guide - Using proto3 è¿™ä¸€ç« è®¨è®ºåœ¨ API è®¾è®¡ä¸­å¦‚ä½•ä½¿ç”¨ Protocol Bufferã€‚ä¸ºäº†ç®€åŒ–å¼€å‘ä½“éªŒå¹¶æé«˜è¿è¡Œæ•ˆç‡ï¼ŒgPRC API åº”è¯¥ï¼ˆshouldï¼‰ åœ¨ API å®šä¹‰æ—¶ä½¿ç”¨ Protocol Buffers ç¬¬ 3 ç‰ˆï¼ˆproto3ï¼‰ã€‚ Protocol Buffer æ˜¯ä¸€ä¸ªä¸ºäº†å®šä¹‰æ•°æ®ç»“æ„å’Œç¼–ç¨‹æ¥å£çš„è¯­è¨€ç‹¬ç«‹å¹³å°ç‹¬ç«‹çš„ç®€å•çš„æ¥å£å®šä¹‰è¯­è¨€ï¼ˆIDLï¼‰ã€‚å®ƒæ”¯æŒäºŒè¿›åˆ¶å’Œæ–‡æœ¬æ ¼å¼ï¼Œå¹¶ä¸”èƒ½å¤Ÿåœ¨ä¸åŒçš„å¹³å°ä¸åŒçš„åè®®ä¸­ä½¿ç”¨ã€‚ proto3 æ˜¯ Protocol Buffer çš„æœ€æ–°ç‰ˆæœ¬ï¼Œä¸ proto2 æ¯”æœ‰å¦‚ä¸‹æ”¹å˜ï¼š åŸå§‹å­—æ®µï¼ˆprimitive fieldsï¼‰ä¸å†æ”¯æŒ hasFieldã€‚æœªè®¾ç½®çš„åŸå§‹å­—æ®µæœ‰è¯­è¨€ç›¸å…³çš„é»˜è®¤å€¼ã€‚ æ¶ˆæ¯å­—æ®µä»ç„¶å¯ç”¨ï¼Œå¯ä»¥ä½¿ç”¨ç¼–è¯‘å™¨ç”Ÿæˆçš„ hasField æ–¹æ³•æˆ–ä¸ null è¿›è¡Œæ¯”è¾ƒæˆ–ä¸ç”±å…·ä½“å®ç°å®šä¹‰çš„å“¨å…µå€¼æ¯”è¾ƒã€‚ ä¸å†æ”¯æŒç”¨æˆ·è‡ªå®šä¹‰çš„å­—æ®µé»˜è®¤å€¼ æšä¸¾å®šä¹‰ å¿…é¡»ï¼ˆmustï¼‰ ä»¥ 0 å¼€å§‹ ä¸å†æ”¯æŒ required å­—æ®µ ä¸å†æ”¯æŒæ‰©å±•ï¼ˆextensionsï¼‰ï¼Œè¯·ä½¿ç”¨ google.protobuf.Any ç”±äºå‘åå…¼å®¹æ€§å’Œè¿è¡Œæ—¶å…¼å®¹æ€§çš„åŸå› ï¼Œgoogle/protobuf/descriptor.proto ç‰¹æ®Šä¾‹å¤– åˆ é™¤äº†ç»„è¯­æ³•ï¼ˆgroupï¼‰ åˆ é™¤è¿™äº›ç‰¹æ€§æ˜¯ä¸ºäº†è®© API çš„è®¾è®¡æ›´åŠ ç®€æ´å¯é å’Œæé«˜æ€§èƒ½ã€‚ä¾‹å¦‚åœ¨è®°å½•æ—¥å¿—å‰ç»å¸¸éœ€è¦è¿‡æ»¤ä¸€äº›æ•æ„Ÿå­—æ®µï¼Œä½†å½“å­—æ®µæ˜¯ required æ—¶ï¼Œè¿™ç§æ“ä½œæ˜¯ä¸å¯èƒ½çš„ã€‚ æŸ¥çœ‹ Protocol Buffers è·å–æ›´å¤šä¿¡æ¯ã€‚ æŸ¥çœ‹å…¶ä»–ç« èŠ‚]]></content>
      <tags>
        <tag>æ¶æ„</tag>
        <tag>ç¿»è¯‘</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Google API è®¾è®¡æŒ‡å—ï¼æ–‡æ¡£]]></title>
    <url>%2F2017%2F04%2Fgoogle-api-design-guide%2Fdocumentation%2F</url>
    <content type="text"><![CDATA[ç¿»è¯‘è‡ª API Design Guide - Documentation è¿™ä¸€ç« æ˜¯ä¸º API æ·»åŠ å†…éƒ¨æ–‡æ¡£çš„æŒ‡å—ã€‚å¤§éƒ¨åˆ† API æœ‰æ¦‚è¿°ã€æ•™ç¨‹å’Œæ›´é«˜çº§åˆ«çš„å‚è€ƒæ–‡æ¡£ï¼ˆæ­¤æŒ‡å—ä¸è®¨è®ºï¼‰ã€‚API åã€èµ„æºåå’Œæ–¹æ³•åçš„ä¿¡æ¯è¯·æŸ¥çœ‹å‘½åçº¦å®šã€‚ æ³¨é‡Šæ ¼å¼ åœ¨ .proto æ–‡ä»¶ä¸­ä½¿ç”¨ // æ¥æ·»åŠ æ³¨é‡Šã€‚ 1234// Creates a shelf in the library, and returns the new Shelf.rpc CreateShelf(CreateShelfRequest) returns (Shelf) &#123; option (google.api.http) = &#123; post: &quot;/v1/shelves&quot; body: &quot;shelf&quot; &#125;;&#125; åœ¨æœåŠ¡é…ç½®ä¸­æ·»åŠ æ³¨é‡Š ä½œä¸ºåœ¨ .proto æ–‡ä»¶ä¸­æ·»åŠ æ³¨é‡Šçš„æ›¿ä»£æ–¹æ³•ï¼Œä½ å¯ä»¥åœ¨ API çš„ YAML æœåŠ¡é…ç½®æ–‡ä»¶ä¸­æ·»åŠ æ³¨é‡Šã€‚å¦‚æœä¸¤ä¸ªæ–‡ä»¶ä¸­éƒ½è®°å½•äº†ç›¸åŒçš„å…ƒç´ ï¼Œåˆ™è¯¥æ–‡ä»¶ä¸­çš„æ–‡æ¡£å°†ä¼˜å…ˆäº .proto ä¸­çš„æ–‡æ¡£ 1234567documentation: summary: Gets and lists social activities overview: A simple example service that lets you get and list possible social activities rules: - selector: google.social.Social.GetActivity description: Gets a social activity. If the activity does not exist, returns Code.NOT_FOUND.... å½“åœ¨ä¸€ä¸ª .proto æ–‡ä»¶ä¸­æœ‰å¤šä¸ªæœåŠ¡å¹¶ä¸”è¦æä¾›ç‰¹å®šäºæœåŠ¡çš„æ–‡æ¡£æ—¶ï¼Œä½ å°±éœ€è¦ä¸Šé¢çš„æ–¹æ³•ã€‚å¯ä»¥åœ¨ YAML ä¸­æ·»åŠ  overview è¯¦ç»†è®°å½• API çš„æè¿°ä¿¡æ¯ã€‚ä½†æ˜¯ï¼Œä¸€èˆ¬æ¨èå°†æ³¨é‡Šæ·»åŠ åˆ° .protoã€‚ ä¸ .proto æ³¨é‡Šä¸€æ ·ï¼Œå¯ä»¥åœ¨ YAML æ–‡ä»¶çš„æ³¨é‡Šä¸­ä½¿ç”¨ Markdown æ¥æä¾›å…¶ä»–æ ¼å¼ã€‚ API æè¿° API æè¿°æ˜¯ä¸€ä¸ªæè¿°æ­¤ API èƒ½åšä»€ä¹ˆï¼Œä»¥åŠ¨è¯å¼€å§‹çš„å¥å­ã€‚åœ¨ .proto æ–‡ä»¶ä¸­ï¼ŒAPI æè¿°ä»¥æ³¨é‡Šçš„æ–¹æ³•æ·»åŠ åˆ°å¯¹åº”çš„ service ä¸Šï¼Œä¾‹å¦‚ï¼š 1234// Manages books and shelves in a simple digital library.service LibraryService &#123;...&#125; API æè¿°çš„å…¶ä»–ç¤ºä¾‹ï¼š Shares updates, photos, videos, and more with your friends around the world. Accesses a cloud-hosted machine learning service that makes it easy to build smart apps that respond to streams of data. èµ„æºæè¿° é¡¾åæ€ä¹‰èµ„æºæè¿°ç”¨æ¥æè¿°èµ„æºä»£è¡¨çš„ä»€ä¹ˆä¸œè¥¿ã€‚åœ¨ .proto æ–‡ä»¶ä¸­ï¼Œèµ„æºæè¿°ä½œä¸ºæ³¨é‡Šæ·»åŠ åˆ°å¯¹åº”æ¶ˆæ¯ä¸Šï¼Œä¾‹å¦‚ï¼š 1234// A book resource in the Library API.message Book &#123; ...&#125; èµ„æºæè¿°çš„å…¶ä»–ç¤ºä¾‹ï¼š A task on the userâ€™s to-do list. Each task has a unique priority. An event on the userâ€™s calendar. å­—æ®µå’Œå‚æ•°æè¿° ç”¨äºæè¿°å­—æ®µå’Œå‚æ•°çš„å®šä¹‰ï¼Œä¸€äº›ç¤ºä¾‹ï¼š The number of topics in this series. The accuracy of the latitude and longitude coordinates, in meters. Must be non-negative. Flag governing whether attachment URL values are returned for submission resources in this series. The default value for series.insert is true. The container for voting information. Present only when voting information is recorded. Not currently used or deprecated. å­—æ®µå’Œå‚æ•°æè¿°: å¿…é¡»æ¸…æ¥šåœ°æè¿°è¾¹ç•Œæ¡ä»¶ï¼ˆæè¿°å“ªäº›å€¼æœ‰æ•ˆå“ªäº›å€¼æ— æ•ˆã€‚API ç”¨æˆ·ä¼šå°½æœ€å¤§çš„å¯èƒ½æ¥è¯¯ç”¨æœåŠ¡ï¼Œè€Œä¸”ä¸èƒ½é˜…è¯»åº•å±‚ä»£ç æ¥å¼„æ¸…æ¥šï¼‰ å¿…é¡»æŒ‡å®šé»˜è®¤å€¼å’Œé»˜è®¤è¡Œä¸º å½“æ˜¯å­—ç¬¦ä¸²æ—¶ï¼Œè¦æè¿°è¯­æ³•ã€å…è®¸çš„å­—ç¬¦å’Œéœ€è¦çš„ç¼–ç æ ¼å¼ï¼Œä¾‹å¦‚ 1-255 characters in the set [A-a0-9] A valid URL path string starting with / that follows the RFC 2332 conventions. Max length is 500 characters. å¦‚æœå¯ä»¥çš„è¯ï¼Œæä¾›ç¤ºä¾‹ å½“å­—æ®µ å¿…é¡»ã€ä»…è¾“å…¥ã€ä»…è¾“å‡º æ—¶ï¼Œå¿…é¡»åœ¨å­—æ®µæè¿°çš„å¼€å§‹è¿›è¡Œè¯´æ˜ã€‚é»˜è®¤æƒ…å†µä¸‹æ‰€æœ‰å­—æ®µå’Œå‚æ•°éƒ½æ˜¯å¯é€‰çš„ã€‚ä¾‹å¦‚ï¼š 1234567891011message Table &#123; // Required. The resource name of the table. string name = 1; // Input only. Whether to dry run the table creation. bool dryrun = 2; // Output only. The timestamp when the table was created. Assigned by // the server. Timestamp create_time = 3; // The display name of the table. string display_name = 4;&#125; æ–¹æ³•æè¿° æ–¹æ³•æè¿°ç”¨æ¥è¯´æ˜æ–¹æ³•çš„ä½œç”¨å’Œæ“ä½œçš„èµ„æºã€‚é€šå¸¸ä»¥ç¬¬ä¸‰äººç§°çš„ç°åœ¨æ—¶åŠ¨è¯å¼€å§‹ã€‚ç¤ºä¾‹ï¼š Lists calendar events for the authenticated user. Updates a calendar event with the data included in the request. Deletes a location record from the authenticated userâ€™s location history. Creates or updates a location record in the authenticated userâ€™s location history using the data included in the request. If a location resource already exists with the same timestamp value, the data provided overwrites the existing data. æ³¨æ„äº‹é¡¹ ç¡®ä¿æè¿°ç®€æ´å®Œæ•´å¹¶ä¸”å®¹æ˜“è¢«ç†è§£ã€‚ä¸èƒ½ä»…åšé‡è¿°ï¼Œä¾‹å¦‚ series.insert æ–¹æ³•çš„æè¿°ä¸èƒ½ç®€å•åœ°å†™æˆ â€œInserts a seriesâ€ã€‚å‘½ååº”è¯¥åŒ…å«ä¸°å¯Œçš„ä¿¡æ¯ï¼Œå¤§å¤šæ•°è¯»è€…ä¼šé˜…è¯»æè¿°ï¼Œå› ä¸ºä»–ä»¬éœ€è¦æ¯”åå­—æœ¬èº«æ›´å¤šçš„ä¿¡æ¯ã€‚å¦‚æœä¸çŸ¥é“åœ¨æè¿°ä¸­è¦å†™ä»€ä¹ˆï¼Œè¯•ç€å›ç­”ä¸‹é¢çš„é—®é¢˜ï¼š å®ƒæ˜¯ä»€ä¹ˆ æˆåŠŸæˆ–å¤±è´¥åä¼šå¯¼è‡´ä»€ä¹ˆã€‚ä»€ä¹ˆä¼šå¯¼è‡´å¤±è´¥ã€‚ æ˜¯å¹‚ç­‰çš„å— å•ä½æ˜¯ä»€ä¹ˆï¼ˆä¾‹å¦‚ï¼šç±³ã€åº¦ã€åƒç´ ï¼‰ æ¥æ”¶å‚æ•°çš„èŒƒå›´ å‰¯ä½œç”¨æ˜¯ä»€ä¹ˆ å¦‚ä½•ä½¿ç”¨ å¸¸è§é”™è¯¯æ˜¯ä»€ä¹ˆ æ˜¯å¦æ€»æ˜¯å­˜åœ¨ï¼ˆä¾‹å¦‚ï¼šâ€œContainer for voting information. Present only when voting information is recorded.â€ï¼‰ æ˜¯å¦æœ‰é»˜è®¤å€¼ æƒ¯ä¾‹ æœ¬èŠ‚åˆ—å‡ºäº†æ–‡æœ¬æè¿°å’Œæ–‡æ¡£çš„ä¸€äº›ä½¿ç”¨æƒ¯ä¾‹ã€‚ä½¿ç”¨ ID è¡¨ç¤ºæ ‡è¯†ç¬¦ï¼ˆè€Œä¸ä½¿ç”¨ Id æˆ– idï¼‰ã€‚ä½¿ç”¨ JSON è¡¨ç¤ºæ•°æ®æ ¼å¼ï¼ˆè€Œä¸ä½¿ç”¨ Json æˆ– jsonï¼‰ã€‚æ‰€æœ‰å­—æ®µ/å‚æ•°ä½¿ç”¨ code font çš„æ ¼å¼ï¼Œå­—ç¬¦ä¸²è¦ç”¨å¼•å·æ‹¬èµ·æ¥ã€‚ ID JSON RPC REST property_name æˆ– &quot;string_literal&quot; true / false è¯­è¨€é£æ ¼ å’Œå‘½åçº¦å®šä¸€æ ·ï¼Œåœ¨å†™æ³¨é‡Šæ—¶æ¨èä½¿ç”¨ç®€æ´ä¸€è‡´çš„è¯è¯­å’Œé£æ ¼ï¼Œè®©æ¯è¯­éè‹±è¯­çš„è¯»è€…å®¹æ˜“ç†è§£ã€‚å› æ­¤è¦é¿å…è¡Œè¯ã€ä¿šè¯­ã€å¤æ‚çš„éšå–»ã€æµè¡Œæ–‡åŒ–æˆ–å…¶ä»–ä¸å®¹æ˜“ç†è§£çš„å†…å®¹ã€‚ä½¿ç”¨å‹å¥½ä¸“ä¸šçš„é£æ ¼ç›´æ¥ä¸è¯»è€…â€œäº¤è°ˆâ€ï¼Œå¹¶å°½å¯èƒ½ä¿æŒæ³¨é‡Šçš„ç®€æ´ã€‚è¯·è®°ä½ï¼Œå¤§éƒ¨åˆ†è¯»è€…åªæƒ³çŸ¥é“å¦‚ä½•ä½¿ç”¨ APIï¼Œè€Œä¸æ˜¯é˜…è¯»ä½ çš„æ–‡æ¡£ï¼ æŸ¥çœ‹å…¶ä»–ç« èŠ‚]]></content>
      <tags>
        <tag>æ¶æ„</tag>
        <tag>ç¿»è¯‘</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Google API è®¾è®¡æŒ‡å—ï¼è®¾è®¡æ¨¡å¼]]></title>
    <url>%2F2017%2F04%2Fgoogle-api-design-guide%2Fdesign-patterns%2F</url>
    <content type="text"><![CDATA[ç¿»è¯‘è‡ª API Design Guide - Design Patterns ç©ºå“åº”ä½“ æ ‡å‡†çš„ Delete æ–¹æ³• å¿…é¡»ï¼ˆmustï¼‰ è¿”å› google.protobuf.Empty æ¥å®ç°å…¨å±€ä¸€è‡´æ€§ã€‚å®ƒè¿˜å¯ä»¥é˜²æ­¢å®¢æˆ·ç«¯ä¾èµ–äºåœ¨é‡è¯•æœŸé—´ä¸å¯ç”¨çš„é™„åŠ å…ƒæ•°æ®ã€‚å› ä¸ºéšç€æ—¶é—´æ¨ç§»å¯¹äºè‡ªå®šä¹‰æ–¹æ³•ï¼Œ å¯¹äºè‡ªå®šä¹‰æ–¹æ³•ï¼Œå®ƒä»¬ å¿…é¡»ï¼ˆmustï¼‰ å…·æœ‰è‡ªå·±çš„ XxxResponse æ¶ˆæ¯ï¼Œå³ä½¿å®ƒä»¬æ˜¯ç©ºçš„ï¼Œå› ä¸ºåŠŸèƒ½å¾ˆå¯èƒ½éšç€æ—¶é—´çš„æ¨ç§»è€Œå¢åŠ ï¼Œå¹¶ä¸”éœ€è¦è¿”å›é™„åŠ æ•°æ®ã€‚ èŒƒå›´å­—æ®µ è¡¨ç¤ºèŒƒå›´çš„å­—æ®µ åº”è¯¥ï¼ˆshouldï¼‰ ä½¿ç”¨ç¬¦åˆå‘½åçº¦å®šçš„åŠå¼€åŠé—­åŒºé—´ [start_xxx, end_xxx)ï¼Œä¾‹å¦‚ [start_key, end_key) æˆ– [start_time, end_time)ã€‚C++ STL å’Œ Java æ ‡å‡†åº“ç»å¸¸ä½¿ç”¨åŠå¼€åŠé—­çš„è¯­ä¹‰ã€‚API åº”è¯¥ï¼ˆshouldï¼‰ é¿å…ä½¿ç”¨è¡¨ç¤ºåŒºé—´çš„å…¶ä»–æ–¹æ³•ï¼Œä¾‹å¦‚ (index, count) æˆ– [first, last]ã€‚ èµ„æºæ ‡ç­¾ åœ¨é¢å‘èµ„æºçš„ API ä¸­ï¼Œèµ„æºç»“æ„ç”± API å®šä¹‰ã€‚ä¸ºäº†å…è®¸å®¢æˆ·ç«¯å‘èµ„æºé™„åŠ å°‘é‡ä¸”ç®€å•çš„å…ƒæ•°æ®ï¼ˆä¾‹å¦‚å°†ä¸€å°è™šæ‹Ÿæœºèµ„æºæ ‡è®°ä¸ºæ•°æ®åº“æœåŠ¡å™¨ï¼‰ï¼ŒAPI åº”è¯¥ï¼ˆshouldï¼‰ ä½¿ç”¨åœ¨ google.api.LabelDescriptor ä¸­æè¿°çš„èµ„æºæ ‡ç­¾è®¾è®¡æ¨¡å¼ã€‚ API åº”è¯¥ï¼ˆshouldï¼‰ åœ¨èµ„æºå®šä¹‰ä¸­æ·»åŠ å­—æ®µ map&lt;string, string&gt; labelsï¼š 1234message Book &#123; string name = 1; map&lt;string, string&gt; labels = 2;&#125; è€—æ—¶æ“ä½œ å¦‚æœä¸€ä¸ª API æ–¹æ³•éœ€è¦èŠ±è´¹è¾ƒé•¿æ—¶é—´è¿è¡Œï¼Œå¯ä»¥å°†å…¶è®¾è®¡æˆå‘å®¢æˆ·ç«¯è¿”å›ä¸€ä¸ªè¡¨ç¤ºé•¿æ—¶é—´è¿è¡Œçš„èµ„æºï¼Œå®¢æˆ·ç«¯å¯é€šè¿‡è¿™ä¸ªèµ„æºæ¥è·å–æ“ä½œçš„æ‰§è¡Œè¿›åº¦å¹¶å–å¾—æ‰§è¡Œç»“æœã€‚Operation å®šä¹‰äº†è€—æ—¶æ“ä½œçš„æ ‡å‡†æ¥å£ã€‚ä¸èƒ½ï¼ˆmust notï¼‰ ä¸º API ä½¿ç”¨è‡ªå®šä¹‰çš„è€—æ—¶æ“ä½œæ¥å£ä»¥å…æ‰“ç ´ä¸€è‡´æ€§ã€‚ èµ„æº å¿…é¡»ï¼ˆmustï¼‰ ä½œä¸ºå“åº”æ¶ˆæ¯ç›´æ¥è¿”å›ï¼Œå¹¶ä¸”å¯¹èµ„æºæ“ä½œçš„ç»“æœ åº”è¯¥ï¼ˆshouldï¼‰ ååº”åœ¨ API ä¸­ã€‚ä¾‹å¦‚ï¼šå½“åˆ›å»ºèµ„æºæ—¶è¿™ä¸ªèµ„æº åº”è¯¥ï¼ˆshouldï¼‰ æ˜¾ç¤ºåœ¨ LIST å’Œ GET æ–¹æ³•ä¸­ï¼Œå¹¶ä¸” åº”è¯¥ï¼ˆshouldï¼‰ æŒ‡ç¤ºå‡ºè¿™ä¸ªèµ„æºè¿˜æ²¡æœ‰å‡†å¤‡å¥½ã€‚å¦‚æœæ–¹æ³•ä¸éœ€è¦é•¿æœŸæ‰§è¡Œï¼Œå½“æ“ä½œå®Œæˆæ—¶ Operation.response å­—æ®µåº”è¯¥åŒ…å«ç›´æ¥è¿”å›çš„æ¶ˆæ¯ã€‚ åˆ—è¡¨åˆ†é¡µ å³ä½¿ç»“æœé›†å¾ˆå°ï¼Œå¯ LIST çš„é›†åˆä¹Ÿ åº”è¯¥ï¼ˆshouldï¼‰ æ”¯æŒåˆ†é¡µã€‚ ç†ç”±ï¼šå°½ç®¡å‘å·²æœ‰çš„ API æ·»åŠ åˆ†é¡µåŠŸèƒ½ä» API çš„è§†è§’æ¥çœ‹æ˜¯çº¯ç²¹çš„å¢åŠ åŠŸèƒ½ï¼Œä½†å®ƒå®é™…ä¼šæ”¹å˜è¡Œä¸ºã€‚ä¸çŸ¥é“æœ‰åˆ†é¡µåŠŸèƒ½çš„å·²æœ‰å®¢æˆ·ç«¯ä¼šé”™è¯¯åœ°å°†å–åˆ°çš„ç¬¬ä¸€é¡µæ•°æ®å½“æˆå…¨éƒ¨æ•°æ®ã€‚ ä¸ºäº†åœ¨ List æ–¹æ³•ä¸­æ”¯æŒåˆ†é¡µï¼Œ API åº”è¯¥ï¼ˆshallï¼‰ï¼š åœ¨ List æ–¹æ³•çš„è¯·æ±‚ä¿¡æ¯ä¸­å®šä¹‰ä¸€ä¸ª string å­—æ®µ page_tokenã€‚å®¢æˆ·ç«¯é€šè¿‡è¿™ä¸ªå­—æ®µæ¥è¯·æ±‚æŒ‡å®šçš„æŸä¸€é¡µã€‚ åœ¨ List æ–¹æ³•çš„è¯·æ±‚ä¿¡æ¯ä¸­å®šä¹‰ä¸€ä¸ª int32 å­—æ®µ page_sizeã€‚å®¢æˆ·ç«¯é€šè¿‡è¿™ä¸ªå­—æ®µæ¥æŒ‡å®šè¿”å›ç»“æœçš„æœ€å¤§æ•°é‡ã€‚æœåŠ¡ç«¯å¯ä»¥è¿›ä¸€æ­¥é™åˆ¶åœ¨å•ä¸ªé¡µé¢ä¸­è¿”å›çš„æœ€å¤§ç»“æœæ•°é‡ã€‚page_size æ˜¯ 0 æ—¶ï¼Œå°†ç”±æœåŠ¡ç«¯å†³å®šè¿”å›ç»“æœçš„æ•°é‡ã€‚ åœ¨ List æ–¹æ³•çš„å“åº”ä¿¡æ¯ä¸­å®šä¹‰ä¸€ä¸ª string å­—æ®µ next_page_tokenã€‚è¿™ä¸ªå­—æ®µè¡¨ç¤ºå–å¾—ä¸‹ä¸€é¡µçš„é¡µç ã€‚ç©ºå­—ç¬¦ä¸²è¡¨ç¤ºæ²¡æœ‰æ›´å¤šæ•°æ®äº†ã€‚ ä¸ºäº†å–å¾—ä¸‹ä¸€é¡µçš„ç»“æœï¼Œå®¢æˆ·ç«¯ åº”è¯¥ï¼ˆshallï¼‰ å°†å“åº”ä¸­çš„ next_page_token ä¼ å…¥ä¸‹æ¬¡çš„è¯·æ±‚ï¼š 123456789101112rpc ListBooks(ListBooksRequest) returns (ListBooksResponse);message ListBooksRequest &#123; string name = 1; int32 page_size = 2; string page_token = 3;&#125;message ListBooksResponse &#123; repeated Book books = 1; string next_page_token = 2;&#125; å½“å®¢æˆ·ç«¯åœ¨ query å‚æ•°ä¼ å…¥é™¤ page token ä¹‹å¤–çš„å‚æ•°æ—¶ï¼Œå¦‚æœ query å‚æ•°ä¸ page token ä¸ä¸€è‡´ï¼ŒæœåŠ¡ å¿…é¡»ï¼ˆmustï¼‰ æ‹’ç»æ­¤è¯·æ±‚ã€‚ page token çš„å†…å®¹ åº”è¯¥ï¼ˆshouldï¼‰ æ˜¯å¯¹ web å®‰å…¨çš„ BASE64 ç¼–ç åçš„ protocol bufferï¼Œè¿™æ ·å°±ä¸ä¼šæœ‰å…¼å®¹æ€§é—®é¢˜ã€‚page token ä¸­å­˜åœ¨æ•æ„Ÿä¿¡æ¯æ—¶ï¼Œåº”è¯¥ï¼ˆshouldï¼‰ å°†å…¶åŠ å¯†ã€‚æœåŠ¡ç«¯ å¿…é¡»ï¼ˆmustï¼‰ é€šè¿‡ä»¥ä¸‹æ–¹æ³•æ¥é˜²æ­¢é€šè¿‡ç¯¡æ”¹ page token æ¥è·å–æ•æ„Ÿä¿¡æ¯çš„é—®é¢˜ï¼š æ ¹æ®åç»­è¯·æ±‚æŒ‡å®š query å‚æ•° åœ¨ page token ä¸­ä»…å¼•ç”¨æœåŠ¡ç«¯çš„çŠ¶æ€ åœ¨ page token ä¸­åŠ å¯†å¹¶ç­¾å query å‚æ•°ï¼Œå¹¶ä¸”åœ¨æ¯æ¬¡è°ƒç”¨ä¸­å¯¹è¿™äº›å‚æ•°è¿›è¡ŒéªŒè¯å’Œé‰´æƒ åˆ†é¡µåŠŸèƒ½ä¹Ÿ å¯ä»¥ï¼ˆmayï¼‰ åœ¨å“åº”ä¸­é€šè¿‡åä¸º total_size ç±»å‹ä¸º int32 çš„å­—æ®µæ¥æä¾›æŸ¥è¯¢èµ„æºçš„æ€»æ•°é‡ã€‚ åˆ—å‡ºå­é›†åˆ API æœ‰æ—¶éœ€è¦å®¢æˆ·ç«¯å¯¹å­é›†åˆè¿›è¡Œ List/Search æ“ä½œã€‚ä¾‹å¦‚ä¸€ä¸ª API æœ‰ä¹¦æ¶é›†åˆï¼Œæ¯ä¸ªä¹¦æ¶æœ‰ä¹¦çš„é›†åˆï¼Œå®¢æˆ·ç«¯æƒ³è¦åœ¨æ‰€æœ‰ä¹¦æ¶ä¸­æœç´¢ä¸€æœ¬ä¹¦ã€‚è¿™ç§æƒ…å†µä¸‹æ¨èåœ¨å­é›†åˆä¸Šä½¿ç”¨æ ‡å‡†çš„ Listï¼Œå¹¶ä¸”ä¸ºçˆ¶é›†åˆæŒ‡å®šé€šé…ç¬¦ &quot;-&quot;ã€‚ä¾‹å¦‚ï¼š 1GET https://library.googleapis.com/v1/shelves/-/books?filter=xxx æ³¨æ„ï¼šä½¿ç”¨ &quot;-&quot; è€Œé &quot;*&quot; æ˜¯ä¸ºäº†é¿å… URL è½¬ä¹‰ã€‚ ä»å­é›†åˆä¸­å–å¾—å”¯ä¸€èµ„æº æœ‰æ—¶å­é›†åˆä¸­çš„èµ„æºå…·æœ‰åœ¨å…¶çˆ¶é›†åˆå†…å”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹é€šè¿‡ Get æ¥å–å¾—æŸèµ„æºè€Œä¸éœ€è¦çŸ¥é“å®ƒçš„çˆ¶é›†åˆå¯èƒ½æ˜¯æœ‰ç”¨çš„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå»ºè®®ä½¿ç”¨æ ‡å‡† Getï¼Œå¹¶ä¸ºèµ„æºå”¯ä¸€çš„æ‰€æœ‰çˆ¶é›†åˆæŒ‡å®šé€šé…ç¬¦ &quot;-&quot;ã€‚ä¾‹å¦‚ï¼š 1GET https://library.googleapis.com/v1/shelves/-/books/&#123;id&#125; å“åº” å¿…é¡»ï¼ˆmustï¼‰ ä½¿ç”¨èµ„æºçš„å¸¦æœ‰çˆ¶é›†åˆæ ‡è¯†ç¬¦çš„è§„èŒƒåç§°ã€‚ä¾‹å¦‚ä¸Šé¢çš„è¯·æ±‚åº”è¯¥è¿”å›åç§°ç±»ä¼¼ shelves/shelf713/books/book8141 çš„èµ„æºï¼Œè€Œä¸æ˜¯ shelves/-/books/book8141ã€‚ æ’åº å¦‚æœ API æ–¹æ³•å…è®¸å®¢æˆ·ç«¯æŒ‡å®šåˆ—è¡¨ç»“æœçš„æ’åºé¡ºåºï¼Œè¯·æ±‚æ¶ˆæ¯ä¸­ åº”è¯¥ï¼ˆshouldï¼‰ åŒ…å«å¦‚ä¸‹å­—æ®µï¼š 1string order_by = ...; è¿™ä¸ªå€¼ åº”è¯¥ï¼ˆshouldï¼‰ éµå¾ª SQL è¯­æ³•ï¼šç”¨é€—å·åˆ†éš”çš„å­—æ®µåˆ—è¡¨ã€‚ä¾‹å¦‚ï¼š&quot;foo,bar&quot;ã€‚é»˜è®¤å‡åºæ’åˆ—ã€‚åº”è¯¥ï¼ˆshouldï¼‰ ç»™å­—æ®µæ·»åŠ åç¼€ &quot; desc&quot; æ¥è¡¨ç¤ºé™åºã€‚ä¾‹å¦‚ï¼š&quot;foo desc,bar&quot;ã€‚ å¤šä½™çš„ç©ºæ ¼å¯ä»¥å¿½ç•¥ï¼Œ&quot;foo,bar desc&quot; å’Œ &quot; foo , bar desc &quot;æ˜¯ç›¸ç­‰çš„ã€‚ è¯·æ±‚æ ¡éªŒ å¦‚æœ API æ–¹æ³•æœ‰å‰¯ä½œç”¨ï¼Œå¹¶ä¸”éœ€è¦ä»…éªŒè¯è¯·æ±‚è€Œä¸äº§ç”Ÿå‰¯ä½œç”¨ï¼Œè¯·æ±‚æ¶ˆæ¯ åº”è¯¥ï¼ˆshouldï¼‰ åŒ…å«ä¸€ä¸ªå­—æ®µï¼š 1bool validate_only = ...; å½“æ­¤å­—æ®µè®¾ç½®ä¸º true æ—¶ï¼ŒæœåŠ¡ç«¯ ä¸€å®šä¸è¦ï¼ˆmust notï¼‰ æ‰§è¡Œä»»ä½•æœ‰å‰¯ä½œç”¨çš„æ“ä½œï¼Œè€Œæ˜¯å¯¹è¯·æ±‚è¿›è¡Œæ ¡éªŒã€‚ æ ¡éªŒæˆåŠŸæ—¶ ä¸€å®šï¼ˆmustï¼‰ è¦è¿”å›google.rpc.Code.OKï¼Œå¹¶ä¸”ä½¿ç”¨ç›¸åŒè¯·æ±‚ä¿¡æ¯çš„å®Œæ•´è¯·æ±‚ ä¸åº”è¯¥ï¼ˆshould notï¼‰ è¿”å› google.rpc.Code.INVALID_ARGUMENTã€‚æ³¨æ„ï¼Œå¯èƒ½å› ä¸ºå…¶ä»–é”™è¯¯ï¼ˆæ¯”å¦‚ google.rpc.Code.ALREADY_EXISTS æˆ–ç«æ€æ¡ä»¶ï¼‰æ­¤è¯·æ±‚è¿˜æ˜¯ä¼šå¤±è´¥ã€‚ è¯·æ±‚é‡å…¥ å¯¹äºç½‘ç»œ APIï¼Œå¹‚ç­‰æ˜¯å¾ˆé‡è¦çš„ï¼Œå› ä¸ºå½“æœ‰ç½‘ç»œå¼‚å¸¸æ—¶å®ƒä»¬èƒ½å¤Ÿå®‰å…¨åœ°è¿›è¡Œé‡è¯•ã€‚ç„¶è€Œä¸€äº› API å¹¶ä¸å®¹æ˜“å®ç°å¹‚ç­‰æ€§ï¼Œä¾‹å¦‚éœ€è¦é¿å…ä¸å¿…è¦é‡å¤çš„åˆ›å»ºèµ„æºæ“ä½œã€‚å¯¹äºè¿™ç±»æƒ…å†µï¼Œè¯·æ±‚ä¿¡æ¯ åº”è¯¥ï¼ˆshouldï¼‰ åŒ…å«ä¸€ä¸ªå”¯ä¸€ IDï¼ˆä¾‹å¦‚ UUIDï¼‰ï¼Œè¿™æ ·æœåŠ¡ç«¯èƒ½å¤Ÿé€šè¿‡æ­¤ ID æ¥æ£€æµ‹é‡å¤ï¼Œä¿è¯è¯·æ±‚åªè¢«å¤„ç†ä¸€æ¬¡ã€‚ 123// æœåŠ¡ç«¯ç”¨äºæ£€æµ‹é‡å¤è¯·æ±‚çš„å”¯ä¸€ ID// æ­¤å­—æ®µåº”è¯¥å‘½åä¸º `request_id`string request_id = ...; å› ä¸ºå®¢æˆ·ç«¯å¾ˆå¯èƒ½æ²¡æœ‰æ¥æ”¶åˆ°ä¹‹å‰çš„å“åº”ï¼Œæ‰€ä»¥å½“æ£€æµ‹åˆ°é‡å¤è¯·æ±‚åï¼ŒæœåŠ¡ç«¯ åº”è¯¥ï¼ˆshouldï¼‰ è¿”å›ä¹‹å‰æˆåŠŸçš„å“åº”ã€‚ æšä¸¾é»˜è®¤å€¼ æ¯ä¸ªæšä¸¾å®šä¹‰ å¿…é¡»ï¼ˆmustï¼‰ ä»¥ 0 å€¼å¼€å§‹ï¼Œç”¨äºå½“æšä¸¾å€¼æ²¡æœ‰æ˜ç¡®æŒ‡å®šæ—¶ã€‚API å¿…é¡»ï¼ˆmustï¼‰ åœ¨æ–‡æ¡£ä¸­è¯´æ˜å¦‚ä½•å¤„ç† 0 å€¼ã€‚ å¦‚æœæœ‰é€šç”¨çš„é»˜è®¤è¡Œä¸ºï¼Œåº”è¯¥ï¼ˆshouldï¼‰ ä½¿ç”¨æšä¸¾å€¼ 0ã€‚API åº”è¯¥åœ¨æ–‡æ¡£ä¸­è¯´æ˜æœŸå¾…çš„è¡Œä¸ºã€‚ å¦‚æœæ²¡æœ‰é€šç”¨çš„é»˜è®¤è¡Œä¸ºï¼Œæšä¸¾å€¼ 0 åº”è¯¥ï¼ˆshouldï¼‰ å‘½åä¸º ENUM_TYPE_UNSPECIFIED å¹¶ä¸”å’Œé”™è¯¯ INVALID_ARGUMENT ä¸€èµ·ä½¿ç”¨ã€‚ 123456789101112enum Isolation &#123; // æœªæŒ‡å®š ISOLATION_UNSPECIFIED = 0; // å¿«ç…§è¯»ã€‚å¦‚æœæ‰€æœ‰è¯»å†™éƒ½ä¸èƒ½åœ¨å¹¶å‘äº‹åŠ¡ä¸­é€»è¾‘åœ°åºåˆ—åŒ–ï¼Œåˆ™ä¼šå‘ç”Ÿå†²çª SERIALIZABLE = 1; // å¿«ç…§è¯»ã€‚å¹¶å‘äº‹åŠ¡å‘åŒä¸€è¡Œå†™å…¥æ—¶å¯¼è‡´å†²çª SNAPSHOT = 2; ...&#125;// å½“æœªæŒ‡å®šæ—¶ï¼ŒæœåŠ¡å™¨å°†ä½¿ç”¨ SNAPSHOT æˆ–æ›´é«˜çš„éš”ç¦»çº§åˆ«Isolation level = 1; ä¸€ä¸ªæƒ¯ç”¨åç§° å¯ä»¥ï¼ˆmayï¼‰ ç”¨äº 0 å€¼ï¼Œä¾‹å¦‚ï¼Œgoogle.rpc.Code.OK æ˜¯æŒ‡å®šä¸å­˜åœ¨é”™è¯¯çš„æƒ¯ç”¨æ–¹æ³•ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒOK ä¸æšä¸¾ç±»å‹ä¸­çš„ UNSPECIFIED åœ¨è¯­ä¹‰ä¸Šæ˜¯ç›¸ç­‰çš„ã€‚ åœ¨å­˜åœ¨æœ¬è´¨ä¸Šåˆç†å’Œå®‰å…¨çš„é»˜è®¤æƒ…å†µä¸‹ï¼Œå¯ä»¥ï¼ˆmayï¼‰ ä½¿ç”¨ 0 å€¼ã€‚ä¾‹å¦‚ï¼Œåœ¨èµ„æºè§†å›¾æšä¸¾ä¸­ BASIC æ˜¯ 0 å€¼ã€‚ è¯­æ³•å¥æ³• åœ¨æŸäº› API è®¾è®¡ä¸­ï¼Œæœ‰å¿…è¦ä¸ºæŸäº›æ•°æ®æ ¼å¼å®šä¹‰ç®€å•çš„è¯­æ³•ï¼Œä¾‹å¦‚å¯æ¥å—çš„æ–‡æœ¬è¾“å…¥ã€‚ä¸ºäº†åœ¨ä¸åŒ API ä¸­æä¾›ä¸€è‡´çš„å¼€å‘ä½“éªŒå’Œå‡å°‘å­¦ä¹ æ›²çº¿ï¼ŒAPI è®¾è®¡è€… å¿…é¡»ï¼ˆmustï¼‰ ä½¿ç”¨ ISO 14977 æ‰©å±•çš„ Backus-Naur è¡¨æ ¼ï¼ˆEBNFï¼‰å¥æ³•æ¥å®šä¹‰è¿™äº›è¯­æ³•ã€‚ 1234567Production = name &quot;=&quot; [ Expression ] &quot;;&quot; ;Expression = Alternative &#123; &quot;|&quot; Alternative &#125; ;Alternative = Term &#123; Term &#125; ;Term = name | TOKEN | Group | Option | Repetition ;Group = &quot;(&quot; Expression &quot;)&quot; ;Option = &quot;[&quot; Expression &quot;]&quot; ;Repetition = &quot;&#123;&quot; Expression &quot;&#125;&quot; ; æ³¨æ„ï¼šTOKEN è¡¨ç¤ºåœ¨è¯­æ³•ä¹‹å¤–å®šä¹‰çš„ç»ˆç«¯ã€‚ æ•´æ•°ç±»å‹ åœ¨API è®¾è®¡ä¸­ï¼Œä¸åº”è¯¥ï¼ˆshould notï¼‰ ä½¿ç”¨åƒ uint32 å’Œ fixed32 è¿™ç§æ— ç¬¦å·æ•´å‹ï¼Œè¿™æ˜¯å› ä¸ºä¸€äº›é‡è¦çš„ç¼–ç¨‹è¯­è¨€å’Œç³»ç»Ÿï¼ˆä¾‹å¦‚ Java, JavaScript å’Œ OpenAPIï¼‰ä¸èƒ½å¾ˆå¥½åœ°æ”¯æŒå®ƒä»¬å¹¶ä¸”æ›´å®¹æ˜“å¯¼è‡´æº¢å‡ºçš„é—®é¢˜ã€‚å¦ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œä¸åŒçš„ API å¾ˆå¯èƒ½å¯¹åŒä¸€ä¸ªèµ„æºä½¿ç”¨ä¸åŒ¹é…çš„æœ‰ç¬¦å·å’Œæ— ç¬¦å·ç±»å‹ã€‚ åœ¨å¤§å°å’Œæ—¶é—´è¿™ç§è´Ÿæ•°æ²¡æœ‰æ„ä¹‰çš„ç±»å‹ä¸­ å¯ä»¥ï¼ˆmayï¼‰ ä½¿ç”¨ä¸”ä»…ä½¿ç”¨ -1 æ¥è¡¨ç¤ºç‰¹å®šçš„æ„ä¹‰ï¼Œä¾‹å¦‚åˆ°åœ¨æ–‡ä»¶ç»“å°¾ï¼ˆEOFï¼‰ã€æ— ç©·çš„æ—¶é—´ã€æ— èµ„æºé™é¢æˆ–æœªçŸ¥çš„å¹´çºªã€‚å½“è¿™æ ·ä½¿ç”¨è´Ÿæ•°æ—¶ï¼Œå¿…é¡»ï¼ˆmustï¼‰ åœ¨æ–‡æ¡£ä¸­æ˜ç¡®è¯´æ˜ä»¥é˜²æ­¢æ··æ·†ã€‚API ç”Ÿæˆå™¨ä¹Ÿåº”è¯¥åœ¨æ–‡æ¡£ä¸­è®°å½•éšå¼é»˜è®¤å€¼ 0 è¡¨ç¤ºçš„è¡Œä¸ºã€‚ éƒ¨åˆ†å“åº” å®¢æˆ·ç«¯æœ‰æ—¶åªéœ€è¦å“åº”ä¿¡æ¯ä¸­çš„ç‰¹å®šå­é›†ã€‚ä¸€äº› API å¹³å°æä¾›äº†å¯¹éƒ¨åˆ†å“åº”çš„åŸç”Ÿæ”¯æŒã€‚Google API å¹³å°é€šè¿‡å“åº”å­—æ®µæ©ç æ¥æä¾›æ”¯æŒã€‚å¯¹äºä»»ä¸€ REST API è°ƒç”¨ï¼Œæœ‰ä¸€ä¸ªéšå¼çš„ç³»ç»Ÿ query å‚æ•° $fieldsï¼Œå®ƒæ˜¯ google.protobuf.FieldMask çš„ JSON è¡¨ç¤ºã€‚åœ¨è¿”å›ç»™å®¢æˆ·ç«¯ä¹‹å‰ï¼Œå“åº”æ¶ˆæ¯ä¼šè¢« $fields å­—æ®µè¿‡æ»¤ã€‚æ­¤è¡Œä¸ºæ˜¯åœ¨ API å¹³å°è‡ªåŠ¨æ‰§è¡Œçš„ã€‚ 1GET https://library.googleapis.com/v1/shelves?$fields=name èµ„æºè§†å›¾ ä¸ºäº†å‡å°‘ç½‘ç»œæµé‡ï¼Œå…è®¸å®¢æˆ·ç«¯é™åˆ¶æœåŠ¡å™¨åœ¨å…¶å“åº”ä¸­è¿”å›çš„èµ„æºçš„å“ªäº›éƒ¨åˆ†æ˜¯æœ‰ç”¨çš„ï¼Œè¿”å›èµ„æºçš„è§†å›¾è€Œä¸æ˜¯å…¨éƒ¨èµ„æºè¡¨ç¤ºã€‚API ä¸­çš„èµ„æºè§†å›¾æ˜¯é€šè¿‡å‘è¯·æ±‚æ·»åŠ å‚æ•°æ¥å®ç°çš„ï¼Œè¯¥å‚æ•°å…è®¸å®¢æˆ·ç«¯åœ¨å“åº”ä¸­æŒ‡å®šè¦æ¥æ”¶èµ„æºçš„å“ªä¸ªè§†å›¾ã€‚ æ­¤å‚æ•°ï¼š åº”è¯¥ï¼ˆshouldï¼‰ æ˜¯æšä¸¾ç±»å‹ å¿…é¡»ï¼ˆmustï¼‰ å‘½åä¸º view æšä¸¾ä¸­çš„æ¯ä¸ªå€¼å®šä¹‰äº†èµ„æºçš„å“ªéƒ¨åˆ†ï¼ˆå­—æ®µï¼‰åœ¨å“åº”ä¸­ä¼šè¢«è¿”å›ã€‚æ–‡æ¡£ä¸­ åº”è¯¥ï¼ˆshouldï¼‰ æ˜ç¡®è®°å½•æ¯ä¸ª view å€¼ä¼šè¿”å›ä»€ä¹ˆã€‚ 123456789101112131415161718192021222324package google.example.library.v1;service Library &#123; rpc ListBooks(ListBooksRequest) returns (ListBooksResponse) &#123; option (google.api.http) = &#123; get: &quot;/v1/&#123;name=shelves/*&#125;/books&quot; &#125; &#125;;&#125;enum BookView &#123; // å“åº”ä¸­åªåŒ…å«ä½œè€…ã€æ ‡é¢˜ã€ISBN å’Œå”¯ä¸€çš„å›¾ä¹¦ IDã€‚è¿™æ˜¯é»˜è®¤å€¼ã€‚ BASIC = 0; // è¿”å›æ‰€æœ‰ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä¹¦ä¸­çš„å†…å®¹ FULL = 1;&#125;message ListBooksRequest &#123; string name = 1; // æŒ‡å®šè¿”å›å›¾ä¹¦èµ„æºçš„å“ªäº›éƒ¨åˆ† BookView view = 2;&#125; å¯¹åº”çš„ URLï¼š 1GET https://library.googleapis.com/v1/shelves/shelf1/books?view=BASIC å¯ä»¥åœ¨ æ ‡å‡†æ–¹æ³• ä¸€ç« ä¸­æŸ¥çœ‹æ›´å¤šå…³äºæ–¹æ³•å®šä¹‰ã€è¯·æ±‚å’Œå“åº”çš„å†…å®¹ã€‚ ETag ETag æ˜¯ä¸€ä¸ªä¸é€æ˜çš„æ ‡è¯†ç¬¦ï¼Œå…è®¸å®¢æˆ·ç«¯è¿›è¡Œæ¡ä»¶è¯·æ±‚ã€‚ä¸ºäº†æ”¯æŒ ETagï¼ŒAPI åº”è¯¥ï¼ˆshouldï¼‰ åœ¨èµ„æºå®šä¹‰ä¸­åŒ…å«ä¸€ä¸ªå­—ç¬¦ä¸²å­—æ®µ etagï¼Œå®ƒçš„è¯­ä¹‰ å¿…é¡»(must) ä¸ ETagçš„å¸¸ç”¨ç”¨æ³•ç›¸åŒ¹é…ã€‚é€šå¸¸ï¼Œetag åŒ…å«ç”±æœåŠ¡å™¨è®¡ç®—å‡ºçš„èµ„æºæŒ‡çº¹ã€‚æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…ç»´åŸºç™¾ç§‘å’Œ RFC 7232ã€‚ ETags å¯ä»¥å¼ºéªŒè¯æˆ–å¼±éªŒè¯ï¼Œå…¶ä¸­å¼±éªŒè¯çš„ETag ä»¥ W / ä¸ºå‰ç¼€ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¼ºéªŒè¯æ„å‘³ç€å…·æœ‰ç›¸åŒ ETag çš„ä¸¤ä¸ªèµ„æºå…·æœ‰ç›¸åŒçš„å†…å®¹å’Œç›¸åŒçš„é¢å¤–å­—æ®µï¼ˆContent-Typeï¼‰ã€‚è¿™æ„å‘³ç€å¼ºéªŒè¯çš„ ETag å…è®¸ç¼“å­˜ç¨åç»„è£…çš„éƒ¨åˆ†å“åº”ã€‚ ç›¸åï¼Œå…·æœ‰ç›¸åŒå¼±éªŒè¯ ETag å€¼çš„èµ„æºæ„å‘³ç€è¿™äº›è¡¨ç¤ºåœ¨è¯­ä¹‰ä¸Šæ˜¯ç­‰æ•ˆçš„ï¼Œä½†ä¸ä¸€å®šæ¯å­—èŠ‚éƒ½ç›¸åŒï¼Œå› æ­¤ä¸é€‚åˆäºå­—èŠ‚èŒƒå›´è¯·æ±‚çš„å“åº”ç¼“å­˜ã€‚ 1234// å¼ºéªŒè¯çš„ ETagï¼ˆåŒ…å«å¼•å·ï¼‰&quot;1a2f3e4d5b6c7c&quot;// å¼±éªŒè¯çš„ ETagï¼ˆåŒ…å«å‰ç¼€å’Œå¼•å·ï¼‰W/&quot;1a2b3c4d5ef&quot; è¾“å‡ºå­—æ®µ API å¯èƒ½å¸Œæœ›å°†ç”±å®¢æˆ·ç«¯æä¾›çš„å­—æ®µå’Œåªç”±æœåŠ¡ç«¯åœ¨ç‰¹å®šèµ„æºä¸Šè¿”å›çš„å­—æ®µè¿›è¡ŒåŒºåˆ†ã€‚å¯¹äºä»…è¾“å‡ºçš„å­—æ®µï¼Œ**å¿…é¡»ï¼ˆshallï¼‰**è®°å½•å­—æ®µå±æ€§ã€‚ è¯·æ³¨æ„ï¼Œå¦‚æœå®¢æˆ·ç«¯åœ¨è¯·æ±‚ä¸­è®¾ç½®äº†ä»…è¾“å‡ºï¼ˆoutput onlyï¼‰å­—æ®µï¼Œæˆ–è€…å®¢æˆ·ç«¯ä½¿ç”¨ä»…è¾“å‡ºå­—æ®µæŒ‡å®šäº†ä¸€ä¸ª google.protobuf.FieldMaskï¼Œåˆ™æœåŠ¡å™¨ å¿…é¡»ï¼ˆmustï¼‰ æ¥å—è¯¥è¯·æ±‚è€Œä¸èƒ½å‡ºé”™ã€‚è¿™æ„å‘³ç€æœåŠ¡å™¨ å¿…é¡»ï¼ˆmustï¼‰ å¿½ç•¥ä»…è¾“å‡ºå­—æ®µçš„å­˜åœ¨åŠå…¶ä»»ä½•æŒ‡ç¤ºã€‚è¿™ä¸ªå»ºè®®çš„åŸå› æ˜¯å› ä¸ºå®¢æˆ·ç«¯é€šå¸¸ä¼šå°†æœåŠ¡å™¨è¿”å›çš„èµ„æºé‡ç”¨ä¸ºå¦ä¸€ä¸ªè¯·æ±‚çš„è¾“å…¥ï¼Œä¾‹å¦‚ä¸€ä¸ªè·å–åˆ°çš„ Book å°†åœ¨ UPDATE æ–¹æ³•ä¸­è¢«å†æ¬¡ä½¿ç”¨ã€‚å¦‚æœè¦éªŒè¯ä»…è¾“å‡ºå­—æ®µï¼Œå®¢æˆ·ç«¯éœ€è¦åšæ¸…é™¤è¾“å‡ºå­—æ®µçš„é¢å¤–å·¥ä½œã€‚ 12345message Book &#123; string name = 1; // åªç”¨åšè¾“å‡º Timestamp create_time = 2;&#125; æŸ¥çœ‹å…¶ä»–ç« èŠ‚]]></content>
      <tags>
        <tag>æ¶æ„</tag>
        <tag>ç¿»è¯‘</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[golang struct è½¬ json æ—¶å¦‚ä½•å¿½ç•¥éƒ¨åˆ†å­—æ®µ]]></title>
    <url>%2F2017%2F04%2Fgolang%20struct%20%E8%BD%AC%20json%20%E6%97%B6%E5%A6%82%E4%BD%95%E5%BF%BD%E7%95%A5%E9%83%A8%E5%88%86%E5%AD%97%E6%AE%B5%2F</url>
    <content type="text"><![CDATA[å°†å­—æ®µé¦–å­—æ¯æ”¹ä¸ºå°å†™æˆ–æ·»åŠ  json:&quot;-&quot; æ ‡ç­¾èƒ½å¤Ÿåœ¨ json.Marshal() æ—¶å¿½ç•¥æŒ‡å®šå­—æ®µï¼Œä½†æ­¤æ–‡ç« æƒ³è®¨è®ºçš„æ˜¯åœ¨ä¸ä¿®æ”¹åŸ struct ç»“æ„çš„å‰æä¸‹è¿‡å¿½ç•¥éƒ¨åˆ†å­—æ®µçš„æ–¹æ³•ã€‚ ä¸ºä»€ä¹ˆä¼šæœ‰è¿™ç§éœ€æ±‚å‘¢ï¼Ÿå¦‚æœè¦è½¬ä¸º json çš„ struct å®šä¹‰åœ¨ä¾èµ–åŒ…ä¸­æˆ–æœ‰å…¶ä»–åœ°æ–¹éœ€è¦è¾“å‡ºè¿™äº›å­—æ®µï¼Œè¿™æ—¶å°±ä¸èƒ½ä¿®æ”¹åŸ structã€‚ å®šä¹‰åªæœ‰å¿…è¦å­—æ®µçš„æ–° struct å®šä¹‰æ–° structï¼Œåœ¨æ–° struct ä¸­åªä¿ç•™å¿…è¦å­—æ®µã€‚ 123456789101112131415type source struct &#123; A int `json:"a"` B int `json:"b"`&#125;type target struct &#123; A int `json:"a"`&#125;func main() &#123; s := source&#123;A: 1, B: 2&#125; t := target&#123;A: s.A&#125; bytes, _ := json.Marshal(t) fmt.Println(string(bytes))&#125; è¿™æ˜¯æœ€å®¹æ˜“æƒ³åˆ°çš„æ–¹æ³•ï¼Œä½†å½“å­—æ®µè¾ƒå¤šæˆ– struct è¾ƒå¤æ‚ï¼ˆæ¯”å¦‚åµŒå¥—å¤šå±‚å…¶ä»– structï¼‰æ—¶å°±ä¼šæœ‰å¾ˆå¤šå°† source çš„å­—æ®µèµ‹å€¼ç»™ target çš„æ“ä½œã€‚ å®šä¹‰ tag ä¸åŒç»“æ„ç›¸åŒçš„ struct æ­¤æ–¹æ³•ä»…é€‚ç”¨ golang 1.8+ï¼Œ1.8 ä¹‹åç»“æ„ç›¸åŒä½† tag ä¸åŒçš„ struct ä¹‹é—´èƒ½å¤Ÿå¼ºåˆ¶è½¬æ¢ã€‚åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œæˆ‘ä»¬èƒ½ç®€åŒ–æ‰å­—æ®µèµ‹å€¼çš„æ“ä½œã€‚å®Œæ•´ç¤ºä¾‹ç‚¹å‡»è¿™é‡Œã€‚ 12345678910111213141516type source struct &#123; A int `json:"a"` B int `json:"b"` // æ³¨æ„è¿™é‡Œ&#125;type target struct &#123; A int `json:"a"` B int `json:"-"` // æ³¨æ„è¿™é‡Œ&#125;func main() &#123; s := source&#123;A: 1, B: 2&#125; t := target(s) bytes, _ := json.Marshal(t) fmt.Println(string(bytes))&#125; é€šè¿‡ map è½¬æ¢ json å’Œ struct è½¬æ¢æ—¶ï¼Œstruct å¿…é¡»æå‰å®šä¹‰å¥½ã€‚å¦‚æœä¸çŸ¥é“ç»“æ„æˆ–ä¸æƒ³å®šä¹‰ structï¼Œå¯ä»¥å°†å…¶è½¬ä¸º interface{} 123456func main() &#123; bytes := []byte(`&#123;"test":"abc"&#125;`) var f interface&#123;&#125; json.Unmarshal(bytes, &amp;f) fmt.Println(f)&#125; ä¸Šé¢çš„æ‰§è¡Œç»“æœæ˜¯ map[test:abc]ã€‚ æ‰€ä»¥å¯ä»¥å°†åŸ struct è½¬ä¸º map[string]interface{}ï¼Œå°†éœ€è¦çš„å­—æ®µä¿å­˜å…¥æ–°çš„ map[string]interface{}ï¼Œç„¶åè½¬ä¸º jsonï¼š 12345678910111213141516171819202122232425262728293031type obj map[string]interface&#123;&#125;func trim(source obj, target obj) obj &#123; out := make(obj) for k, v := range source &#123; if vv, find := target[k]; find &#123; switch vv.(type) &#123; case obj: out[k] = make(obj) if len(vv.(obj)) == 0 &#123; out[k] = v &#125; else &#123; out[k] = trim(v.(map[string]interface&#123;&#125;), vv.(obj)) &#125; case []obj: if len(vv.([]obj)) == 0 &#123; out[k] = v &#125; else &#123; out[k] = make([]obj, 0) for i := range v.([]interface&#123;&#125;) &#123; o := trim(v.([]interface&#123;&#125;)[i].(map[string]interface&#123;&#125;), vv.([]obj)[0]) out[k] = append(out[k].([]obj), o) &#125; &#125; default: out[k] = v &#125; &#125; &#125; return out&#125; trim() çš„ source å‚æ•°æ˜¯åŸå§‹ structï¼Œtarget å‚æ•°ä¸­åªä¿ç•™éœ€è¦çš„å­—æ®µã€‚åŸå§‹ struct å’Œ target ç¤ºä¾‹ï¼š 1234567891011121314151617181920212223242526272829type T1 struct &#123; Field1 string `json:"field_1"` Field2 []int `json:"field_2"` Field3 int `json:"field_3"`&#125;type T2 struct &#123; Field1 string `json:"field_1"` Field2 []int `json:"field_2"` Field3 int `json:"field_3"` T1 T1 `json:"t_1"`&#125;// åŸå§‹ structtype ComplexStruct struct &#123; T1 Array []T1 `json:"array"` T2 T2 `json:"t_2"`&#125;// target ä¸­è®°å½•éœ€è¦çš„ keyï¼Œå€¼ä¸ºå¯¹è±¡æ—¶ä½¿ç”¨ obj&#123;&#125;ï¼Œå€¼ä¸ºå¯¹è±¡æ•°ç»„æ—¶ç”¨ []obj&#123;&#125;ï¼Œå…¶ä»–ç±»å‹ç”¨""å³å¯target := obj&#123; "array": []obj&#123; &#123; "field_1": "", "field_3": "", &#125;, &#125;, "t_2": obj&#123; "t_1": obj&#123;&#125;, &#125;,&#125; trim() çš„è¿”å›å€¼æ˜¯åªä¿ç•™éœ€è¦å­—æ®µçš„ map[string]interface{}ï¼Œå†å°†å…¶ json.Marshal()å³å¯ 123out := trim(source, target)bytes, _ = json.MarshalIndent(out, "", " ")fmt.Println(string(bytes)) å®Œæ•´ä»£ç è¯·çœ‹ gist æˆ– play ï¼ˆåªæ˜¯ demoï¼Œæ²¡ç»è¿‡å¤§é‡æµ‹è¯•ï¼‰ã€‚ä½¿ç”¨è¿™ç§æ–¹æ³•åªéœ€è¦å®šä¹‰å‡º targetï¼Œä¸éœ€è¦åƒä¸Šä¸¤ä¸ªæ–¹æ³•é‚£æ ·é‡æ–°å®šä¹‰ structï¼Œä»£ç ä¼šæ›´ç®€æ´ä¸€äº›ã€‚]]></content>
      <tags>
        <tag>go</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Google API è®¾è®¡æŒ‡å—ï¼å‘½åçº¦å®š]]></title>
    <url>%2F2017%2F04%2Fgoogle-api-design-guide%2Fnaming-conventions%2F</url>
    <content type="text"><![CDATA[ç¿»è¯‘è‡ª API Design Guide - Naming Conventions ä¸ºäº†åœ¨é•¿æœŸå’Œå¤§é‡ä½¿ç”¨çš„ API ä¸­æä¾›ç»Ÿä¸€çš„å¼€å‘ä½“éªŒï¼ŒAPI ä¸­çš„æ‰€æœ‰åå­— åº”è¯¥ï¼ˆshouldï¼‰ : ç®€å• ç›´è§‚ ä¸€è‡´ æ­¤æ–‡ç« è®¨è®ºäº†æ¥å£ã€èµ„æºã€é›†åˆã€æ–¹æ³•å’Œæ¶ˆæ¯çš„åå­—ã€‚ å› ä¸ºå¾ˆå¤šå¼€å‘è€…çš„æ¯è¯­å¹¶ä¸æ˜¯è‹±è¯­ï¼Œè¿™äº›å‘½åçº¦å®šé€šè¿‡é¼“åŠ±ä½¿ç”¨ç®€å•ã€ç»Ÿä¸€çš„çŸ­è¯æ±‡æ¥å‘½åæ–¹æ³•å’Œèµ„æºæ¥ä¿è¯å¤§éƒ¨åˆ†å¼€å‘è€…èƒ½å¤Ÿå®¹æ˜“ç†è§£ APIã€‚ API ä¸­çš„åå­— åº”è¯¥ï¼ˆshouldï¼‰ ä½¿ç”¨ç¾å¼è‹±è¯­ï¼Œä¾‹å¦‚ï¼šlicenseï¼ˆä¸æ˜¯ licenceï¼‰ï¼Œcolorï¼ˆä¸æ˜¯ colourï¼‰ã€‚ ä½¿ç”¨å¸¸ç”¨çš„ç®€çŸ­å½¢å¼æˆ–ç¼©å†™ï¼Œä¾‹å¦‚ï¼š API æ¯” Application Programming Interface æ›´å¥½ã€‚ å°½é‡ä½¿ç”¨ç›´æ¥ã€ç†Ÿæ‚‰çš„æœ¯è¯­ï¼Œä¾‹å¦‚ï¼šæè¿°å¯¹èµ„æºçš„åˆ é™¤ï¼ˆé”€æ¯ï¼‰æ—¶ï¼Œdelete æ¯” erase æ›´å¥½ã€‚ å¯¹ç›¸åŒçš„æ¦‚å¿µä½¿ç”¨ç›¸åŒçš„åå­—æˆ–æœ¯è¯­ï¼ŒåŒ…æ‹¬åœ¨ API ä¸­å…±äº«çš„æ¦‚å¿µã€‚ é¿å…åå­—é‡ç”¨ï¼Œå¯¹ä¸åŒçš„æ¦‚å¿µè¦ä½¿ç”¨ä¸åŒåå­—ã€‚ é¿å…ä½¿ç”¨åœ¨ API ä¸Šä¸‹æ–‡ä¸­ä¼šé€ æˆæ··ä¹±çš„è¿‡äºé€šç”¨çš„åå­—ï¼Œå®ƒä»¬ä¼šå¯¼è‡´å¯¹ API æ¦‚å¿µçš„è¯¯è§£ã€‚åº”è¯¥é€‰æ‹©èƒ½å¤Ÿç²¾ç¡®æè¿°æ¦‚å¿µçš„åå­—ã€‚è¿™å¯¹äºå®šä¹‰ä¸€é˜¶ API å…ƒç´ çš„åç§°å°¤å…¶é‡è¦ã€‚å› ä¸ºåå­—ä¸ä¸Šä¸‹æ–‡ç›¸å…³ï¼Œæ‰€ä»¥å¹¶æ²¡æœ‰æ˜ç¡®çš„åå­—é»‘åå•ã€‚Instance, info å’Œ service æ˜¯ä¼šäº§ç”Ÿé—®é¢˜çš„åå­—ã€‚åº”è¯¥é€‰æ‹©èƒ½å¤Ÿæ˜ç¡®è¡¨è¾¾å‡º API æ¦‚å¿µï¼ˆä¾‹ï¼šinstance è¡¨ç¤ºä»€ä¹ˆçš„å®ä¾‹ï¼Ÿï¼‰å¹¶ä¸”å®¹æ˜“ä¸å…¶ä»–ç›¸å…³æ¦‚å¿µæœ‰åŒºåˆ†ï¼ˆä¾‹ï¼šalert çš„æ„æ€æ˜¯è§„åˆ™ï¼Œä¿¡å·è¿˜æ˜¯é€šçŸ¥ï¼Ÿï¼‰çš„åå­—ã€‚ è°¨æ…ä½¿ç”¨ä¼šä¸å¸¸ç”¨ç¼–ç¨‹è¯­è¨€ä¸­çš„å…³é”®å­—æœ‰å†²çªçš„åå­—ã€‚ äº§å“å äº§å“åæ˜¯æŒ‡ API çš„äº§å“è¥é”€åç§°ï¼Œä¾‹å¦‚ Google Calendar APIã€‚åœ¨ APIã€UIã€æ–‡æ¡£ã€æœåŠ¡æ¡æ¬¾ã€ç»“è´¦å•å’Œå•†ä¸šåˆåŒä¸­ä½¿ç”¨çš„äº§å“åç§° åº”è¯¥ï¼ˆshouldï¼‰ ä¸€è‡´ã€‚ Google API å¿…é¡»ï¼ˆmustï¼‰ ä½¿ç”¨ Google ä½œä¸ºäº§å“åçš„å‰ç¼€ï¼Œé™¤éå®ƒä»¬åƒ Gmail, Nest, Youtube è¿™ç§æœ‰ä¸åŒçš„å“ç‰Œã€‚ä¸€èˆ¬æ¥è¯´äº§å“å åº”è¯¥ï¼ˆshouldï¼‰ ç”±äº§å“å’Œå¸‚åœºéƒ¨é—¨å†³å®šã€‚ ä¸‹è¡¨åˆ—å‡ºäº†æ‰€æœ‰ç›¸å…³ API åç§°åŠå…¶ä¸€è‡´æ€§çš„ç¤ºä¾‹ï¼Œæœ‰å…³å„è‡ªåç§°åŠå…¶çº¦å®šçš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·ç»§ç»­å¾€ä¸‹çœ‹ã€‚ API å ç¤ºä¾‹ äº§å“å Google Calendar API æœåŠ¡å calendar.googleapis.com åŒ…å google.calendar.v3 æ¥å£å google.calendar.v3.CalendarService èµ„æºç›®å½• //google/calendar/v3 API å calendar æœåŠ¡å æœåŠ¡å åº”è¯¥ï¼ˆshouldï¼‰ æ˜¯ä¸€ä¸ªèƒ½å¤Ÿè¢«è§£æä¸ºä¸€ä¸ªæˆ–å¤šä¸ªç½‘ç»œåœ°å€çš„åˆæ³• DNS åå­—ã€‚å…¬æœ‰ Google API çš„æœåŠ¡åéµå¾ªå¦‚ä¸‹æ¨¡å¼ï¼šxxx.googleapis.comã€‚ä¾‹å¦‚ï¼šè°·æ­Œæ—¥å†çš„æœåŠ¡åæ˜¯ calendar.googleapis.comã€‚ å¦‚æœä¸€ä¸ª API ç”±å¤šä¸ªæœåŠ¡ç»„æˆï¼Œå®ƒä»¬ åº”è¯¥ï¼ˆshouldï¼‰ ä»¥èƒ½å¤Ÿæé«˜å¯å‘ç°æ€§çš„æ–¹æ³•å‘½åã€‚ä¸€ç§æ–¹æ³•æ˜¯ä¸ºè¿™äº›æœåŠ¡åä½¿ç”¨ç›¸åŒçš„å‰ç¼€ã€‚ä¾‹å¦‚æœåŠ¡ build.googleapis.com å’Œ buildresults.googleapis.com éƒ½æ˜¯ Google Build API çš„ä¸€éƒ¨åˆ†ã€‚ åŒ…å åœ¨ .proto æ–‡ä»¶ä¸­å®šä¹‰çš„åŒ…å åº”è¯¥ï¼ˆshouldï¼‰ ä¸äº§å“åå’ŒæœåŠ¡åç›¸åŒã€‚æœ‰ç‰ˆæœ¬å·çš„åŒ…å å¿…é¡»ï¼ˆmustï¼‰ ä»¥ç‰ˆæœ¬å·ç»“å°¾ã€‚ä¾‹å¦‚ï¼š 12// Google Calendar APIpackage google.calendar.v3; ä¸ä¸æœåŠ¡ç›´æ¥å…³è”çš„æŠ½è±¡ APIï¼Œä¾‹å¦‚ Google Watcher API åº”è¯¥ï¼ˆshouldï¼‰ ä½¿ç”¨ä¸äº§å“åç›¸åŒçš„ proto åŒ…åï¼š 12// Google Watcher APIpackage google.watcher.v1; åœ¨ .proto æ–‡ä»¶ä¸­æŒ‡å®šçš„ Java åŒ…å å¿…é¡»ï¼ˆmustï¼‰ ç¬¦åˆæ ‡å‡† Java åŒ…åçš„å‰ç¼€ï¼ˆcom., edu., net. ç­‰ï¼‰ã€‚ä¾‹å¦‚ï¼š 1234package google.calendar.v3;// æŒ‡å®š Java åŒ…çš„åå­—ï¼Œä½¿ç”¨æ ‡å‡†å‰ç¼€ &quot;com.&quot;option java_package = &quot;com.google.calendar.v3&quot;; é›†åˆ ID é›†åˆ ID åº”è¯¥ï¼ˆshouldï¼‰ ä½¿ç”¨ç¾å¼è‹±è¯­çš„ã€å¤æ•°å½¢å¼çš„ã€é¦–å­—æ¯å°å†™çš„é©¼å³°å‘½åæ³•ï¼Œä¾‹å¦‚ï¼ševents, children æˆ– deletedEventsã€‚ æ¥å£å ä¸ºäº†é¿å…å’Œå½¢å¦‚ pubsub.googleapis.com çš„èµ„æºåæ··æ·†ï¼Œæœ¯è¯­ æ¥å£å æŒ‡çš„æ˜¯åœ¨ .proto æ–‡ä»¶ä¸­å®šä¹‰ service æ—¶ä½¿ç”¨çš„åå­—ï¼š 12345// Library is the interface name.service Library &#123; rpc ListBooks(...) returns (...); rpc ...&#125; ä½ å¯ä»¥è®¤ä¸º æœåŠ¡å æ˜¯æŒ‡ä¸€ç»„ API çš„å…·ä½“å®ç°ï¼Œæ¥å£å æ˜¯æŒ‡ä¸€ä¸ª API çš„æŠ½è±¡å®šä¹‰ã€‚ æ¥å£åç§° åº”è¯¥ï¼ˆshouldï¼‰ ä½¿ç”¨ç›´è§‚çš„åè¯ï¼Œå¦‚ Calendar æˆ– Blobã€‚ä¸åº”è¯¥ï¼ˆshould notï¼‰ ä¸ç¼–ç¨‹è¯­è¨€ä¸­å·²æœ‰çš„ä»»ä½•æ¦‚å¿µæˆ–è¿è¡Œæ—¶åº“å†²çªï¼ˆå¦‚ï¼šFileï¼‰ã€‚ å½“ æ¥å£å ä¸ API ä¸­å…¶ä»–åå­—å†²çªæ—¶ï¼Œåº”è¯¥ä¸ºå…¶åŠ ä¸Šå‰ç¼€ï¼ˆå¦‚ Api æˆ– Serviceï¼‰æ¥è¿›è¡ŒåŒºåˆ†ã€‚ æ–¹æ³•å åœ¨å…¶ IDL è§„èŒƒä¸­ï¼ŒæœåŠ¡ å¯ä»¥ï¼ˆmayï¼‰ å®šä¹‰ä¸é›†åˆå’Œèµ„æºä¸Šçš„æ–¹æ³•ç›¸å¯¹åº”çš„ä¸€ä¸ªæˆ–å¤šä¸ªRPCæ–¹æ³•ã€‚æ–¹æ³•å åº”è¯¥ï¼ˆshouldï¼‰ éµå¾ªåƒ VerbNoun è¿™æ ·é¦–å­—æ¯å¤§å†™çš„é©¼å³°å‘½åæ³•çš„å‘½åçº¦å®šï¼Œå…¶ä¸­åè¯ï¼ˆNounï¼‰é€šå¸¸æ˜¯èµ„æºç±»å‹ã€‚ åŠ¨è¯ï¼ˆVerbï¼‰ åè¯ï¼ˆNounï¼‰ æ–¹æ³•å è¯·æ±‚ä¿¡æ¯ å“åº”ä¿¡æ¯ List Book ListBooks ListBooksRequest ListBooksResponse Get Book GetBook GetBookRequest Book Create Book CreateBook CreateBookRequest Book Update Book UpdateBook UpdateBookRequest Book Rename Book RenameBook RenameBookRequest RenameBookResponse Delete Book DeleteBook DeleteBookRequest google.protobuf.Empty æ¶ˆæ¯å RPC æ–¹æ³•çš„è¯·æ±‚ä¸å“åº”æ¶ˆæ¯ åº”è¯¥ï¼ˆshouldï¼‰ ä»¥æ–¹æ³•ååˆ†åˆ«åŠ ä¸Š Request å’Œ Response çš„æ–¹å¼å‘½åã€‚é™¤éæ–¹æ³•çš„è¯·æ±‚æˆ–å“åº”ç±»å‹å¦‚ä¸‹ï¼š ç©ºæ¶ˆæ¯ï¼ˆä½¿ç”¨ google.protobuf.Emptyï¼‰ èµ„æºç±»å‹ ä»£è¡¨ä¸€ç§æ“ä½œçš„èµ„æº æšä¸¾å æšä¸¾ç±»å‹çš„åå­— å¿…é¡»ï¼ˆmustï¼‰ ä½¿ç”¨é¦–å­—æ¯å¤§å†™çš„é©¼å³°å‘½åæ³•ã€‚ æšä¸¾å€¼ å¿…é¡»ï¼ˆmustï¼‰ ä»¥ä¸‹åˆ’çº¿åˆ†éš”ä¸”å­—æ¯å…¨éƒ¨å¤§å†™çš„æ–¹å¼æ¥å‘½åï¼ˆä¾‹å¦‚ï¼šCAPITALIZED_NAMES_WITH_UNDERSCORESï¼‰ã€‚æ¯ä¸ªæšä¸¾å€¼ å¿…é¡»ï¼ˆmustï¼‰ ä»¥åˆ†å·è€Œä¸æ˜¯é€—å·ç»“å°¾ã€‚ç¬¬ä¸€ä¸ªå€¼ åº”è¯¥ï¼ˆshouldï¼‰ å‘½åä¸º ENUM_TYPE_UNSPECIFIEDï¼Œç”¨äºå½“æ²¡æœ‰æ˜ç¡®æŒ‡å®šæšä¸¾å€¼æ—¶è¿”å›ã€‚ 123456enum FooBar &#123; // ç¬¬ä¸€ä¸ªè¡¨ç¤ºé»˜è®¤å€¼ï¼Œå¹¶ä¸”ä¸€å®šç­‰äº 0 FOO_BAR_UNSPECIFIED = 0; FIRST_VALUE = 1; SECOND_VALUE = 2;&#125; å­—æ®µå åœ¨ .proto æ–‡ä»¶ä¸­å®šä¹‰çš„å­—æ®µå å¿…é¡»ï¼ˆmustï¼‰ ä»¥ä¸‹åˆ’çº¿åˆ†éš”ä¸”å­—æ¯å…¨éƒ¨å°å†™çš„æ–¹å¼æ¥å‘½åï¼ˆä¾‹å¦‚ï¼šlower_case_underscore_separated_namesï¼‰ã€‚è¿™äº›åå­—ä¼šéµå®ˆå„ç¼–ç¨‹è¯­è¨€çš„å‘½åçº¦å®šæ¥æ˜ å°„åˆ°ç”Ÿæˆçš„ä»£ç ä¸­ã€‚ é‡å¤å­—æ®µåï¼ˆRepeated fieldï¼‰ API ä¸­çš„é‡å¤å­—æ®µ å¿…é¡»ï¼ˆmustï¼‰ ä½¿ç”¨åˆé€‚çš„å¤æ•°å½¢å¼ã€‚è¿™ç¬¦åˆç°æœ‰ Google API çš„æƒ¯ä¾‹ä»¥åŠå¤–éƒ¨å¼€å‘äººå‘˜çš„é€šå¸¸æœŸæœ›ã€‚ æ—¶é—´å’Œé—´éš” åº”è¯¥ï¼ˆshouldï¼‰ ä½¿ç”¨ google.protobuf.Timestampå¹¶ä¸”å­—æ®µå åº”è¯¥ï¼ˆshouldï¼‰ ä»¥ time ç»“å°¾æ¥è¡¨ç¤ºç‹¬ç«‹äºä»»ä¸€æ—¶åŒºçš„æ—¶é—´ç‚¹ã€‚ä¾‹å¦‚ start_time, end_timeã€‚ å¦‚æœè¡¨ç¤ºä¸€ä¸ªæ´»åŠ¨çš„æ—¶é—´ï¼Œå­—æ®µå åº”è¯¥ï¼ˆshouldï¼‰ ä½¿ç”¨ verb_time æ ¼å¼ï¼Œå¦‚ create_time, update_timeã€‚é¿å…ä½¿ç”¨åŠ¨è¯çš„è¿‡å»æ—¶å½¢å¼ï¼Œå¦‚ created_time æˆ– last_updated_timeã€‚ åº”è¯¥ï¼ˆshouldï¼‰ ä½¿ç”¨ google.protobuf.Duration æ¥è¡¨ç¤ºä¸€ä¸ªæ—¶é—´æ®µã€‚ 1234message FlightRecord &#123; google.protobuf.Timestamp takeoff_time = 1; google.protobuf.Duration flight_duration = 2;&#125; å¦‚æœå› ä¸ºé—ç•™ç³»ç»Ÿæˆ–å…¼å®¹åŸå› è¦ä½¿ç”¨æ•´å½¢æ¥è¡¨ç¤ºæ—¶é—´ç›¸å…³çš„å­—æ®µï¼ˆåŒ…å«å¢™ä¸Šæ—¶é—´ã€æ—¶é—´æ®µã€å»¶è¿Ÿï¼‰ï¼Œå­—æ®µå å¿…é¡»ï¼ˆmustï¼‰ æœ‰å¦‚ä¸‹å½¢å¼ï¼š 1xxx_&#123;time|duration|delay|latency&#125;_&#123;seconds|millis|micros|nanos&#125; 1234message Email &#123; int64 send_time_millis = 1; int64 receive_time_millis = 2;&#125; å¦‚æœå› ä¸ºé—ç•™ç³»ç»Ÿæˆ–å…¼å®¹åŸå› è¦ä½¿ç”¨å­—ç¬¦ä¸²æ¥è¡¨ç¤ºæ—¶é—´æˆ³ï¼Œå­—æ®µå ä¸åº”è¯¥ï¼ˆshould notï¼‰ åŒ…å«ä»»ä½•å•ä½åç¼€ã€‚åº”è¯¥ï¼ˆshouldï¼‰ ä½¿ç”¨å½¢å¦‚ 2014-07-30T10:43:17Z çš„ RFC 3339 æ ¼å¼ã€‚ æ—¥æœŸä¸æ—¶é—´ åº”è¯¥ï¼ˆshouldï¼‰ ä½¿ç”¨ google.type.Date å¹¶ä¸”å­—æ®µåä»¥ _date ç»“å°¾æ¥è¡¨ç¤ºç‹¬ç«‹äºæ—¶åŒºä¸æ—¶é—´çš„æ—¥æœŸã€‚å¦‚æœå¿…é¡»ä»¥å­—ç¬¦ä¸²è¡¨ç¤ºï¼Œåº”è¯¥ä½¿ç”¨å½¢å¦‚ YYYY-MM-DD çš„ ISO 8601 æ—¥æœŸæ ¼å¼ï¼ˆä¾‹å¦‚ 2014-07-30ï¼‰ã€‚ åº”è¯¥ï¼ˆshouldï¼‰ ä½¿ç”¨ google.type.TimeOfDay å¹¶ä¸”å­—æ®µåä»¥ _time ç»“å°¾æ¥è¡¨ç¤ºç‹¬ç«‹äºæ—¶åŒºä¸æ—¥æœŸçš„æ—¶é—´ã€‚å¦‚æœå¿…é¡»ä»¥å­—ç¬¦ä¸²è¡¨ç¤ºï¼Œåº”è¯¥ä½¿ç”¨å½¢å¦‚ HH:MM:SS[.FFF] çš„ ISO 8601 çš„ 24 å°æ—¶æ—¶é—´æ ¼å¼ï¼ˆä¾‹å¦‚ 14:55:01.672ï¼‰ã€‚ 1234message StoreOpening &#123; google.type.Date opening_date = 1; google.type.TimeOfDay opening_time = 2;&#125; æ•°é‡ ä»¥æ•´å½¢è¡¨ç¤ºçš„æ•°é‡ å¿…é¡»ï¼ˆmustï¼‰ åŒ…å«å•ä½ã€‚ 1xxx_&#123;bytes|width_pixels|meters&#125; å¦‚æœè¡¨ç¤ºç‰©å“çš„æ•°é‡ï¼Œå­—æ®µå åº”è¯¥ï¼ˆshouldï¼‰ ä½¿ç”¨ _count åšä¸ºåç¼€ï¼Œå¦‚ node_countã€‚ List è¿‡æ»¤å­—æ®µ å¦‚æœ List æ–¹æ³•æ”¯æŒè¿‡æ»¤èµ„æºï¼ŒåŒ…å«è¿‡æ»¤è¡¨è¾¾å¼çš„å­—æ®µ åº”è¯¥ï¼ˆshouldï¼‰ å‘½åä¸º filterã€‚ä¾‹ï¼š 1234567message ListBooksRequest &#123; // çˆ¶èµ„æºå string parent = 1; // è¿‡æ»¤è¡¨è¾¾å¼ string filter = 2;&#125; List å“åº” List æ–¹æ³•çš„å“åº”æ¶ˆæ¯ä¸­åŒ…å«èµ„æºåˆ—è¡¨çš„å­—æ®µåå­— å¿…é¡»ï¼ˆmustï¼‰ æ˜¯èµ„æºåçš„å¤æ•°å½¢å¼ã€‚ä¾‹å¦‚ï¼Œæ–¹æ³• CalendarApi.ListEvents() å¿…é¡»ï¼ˆmustï¼‰ å®šä¹‰å“åº”æ¶ˆæ¯ ListEventsResponseï¼Œæ­¤æ¶ˆæ¯ä¸­åŒ…å«åä¸º events çš„é‡å¤å­—æ®µæ¥ç”¨äºè¿”å›èµ„æºåˆ—è¡¨ã€‚ 123456789101112131415161718service CalendarApi &#123; rpc ListEvents(ListEventsRequest) returns (ListEventsResponse) &#123; option (google.api.http) = &#123; get: &quot;/v3/&#123;parent=calendars/*&#125;/events&quot;; &#125;; &#125;&#125;message ListEventsRequest &#123; string parent = 1; int32 page_size = 2; string page_token = 3;&#125;message ListEventsResponse &#123; repeated Event events = 1; string next_page_token = 2;&#125; é©¼å³°å‘½åæ³• é™¤äº†å­—æ®µåå’Œæšä¸¾å€¼ï¼Œåœ¨ .proto æ–‡ä»¶ä¸­çš„æ‰€æœ‰å®šä¹‰ å¿…é¡»ï¼ˆmustï¼‰ ä½¿ç”¨é¦–å­—æ¯å¤§å†™çš„é©¼å³°å‘½åæ³•ã€‚ åå­—ç¼©å†™ å¯¹äºåƒ config å’Œ spec è¿™ç§è¢«è½¯ä»¶å·¥ç¨‹å¸ˆç†ŸçŸ¥çš„ç¼©å†™ï¼Œåœ¨ API å®šä¹‰ä¸­ åº”è¯¥ï¼ˆshouldï¼‰ ä½¿ç”¨ç¼©å†™è€Œä¸æ˜¯å…¶å®Œæ•´å½¢å¼ï¼Œè¿™ä¼šä½¿ä»£ç ä¾¿äºè¯»å†™ã€‚åœ¨æ­£å¼çš„æ–‡æ¡£ä¸­ åº”è¯¥ï¼ˆshouldï¼‰ ä½¿ç”¨å…¶å®Œæ•´å½¢å¼ã€‚ä¾‹å¦‚ï¼š config (configuration) id (identifier) spec (specification) stats (statistics) æŸ¥çœ‹å…¶ä»–ç« èŠ‚]]></content>
      <tags>
        <tag>æ¶æ„</tag>
        <tag>ç¿»è¯‘</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Google API è®¾è®¡æŒ‡å—ï¼é”™è¯¯å¤„ç†]]></title>
    <url>%2F2017%2F04%2Fgoogle-api-design-guide%2Ferrors%2F</url>
    <content type="text"><![CDATA[ç¿»è¯‘è‡ª API Design Guide - Errors æœ¬ç« ç®€å•ä»‹ç» Google API çš„é”™è¯¯æ¨¡å‹ä»¥åŠå¼€å‘äººå‘˜å¦‚ä½•æ­£ç¡®ç”Ÿæˆå’Œå¤„ç†é”™è¯¯çš„ä¸€èˆ¬æŒ‡å¯¼ã€‚ Google API ä½¿ç”¨äº†ç®€å•çš„åè®®æ— å…³çš„é”™è¯¯æ¨¡å‹ï¼Œè¿™å…è®¸æˆ‘ä»¬åœ¨ä¸åŒ APIï¼Œä¸åŒåè®®ï¼ˆä¾‹å¦‚ gRPC æˆ– HTTPï¼‰ï¼Œä¸åŒçš„é”™è¯¯ä¸Šä¸‹æ–‡ï¼ˆå¦‚åŒæ­¥ã€æ‰¹é‡å¤„ç†ã€å·¥ä½œæµé”™è¯¯ï¼‰ä¸­æä¾›ç›¸åŒçš„ä½¿ç”¨ä½“éªŒã€‚ é”™è¯¯æ¨¡å‹ é”™è¯¯æ¨¡å‹ç”± google.rpc.Status å®šä¹‰ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š 123456789101112package google.rpc;message Status &#123; // å®¹æ˜“è¢«å®¢æˆ·ç«¯å¤„ç†çš„ç®€å•é”™è¯¯ç ï¼Œå®é™…çš„é”™è¯¯ç å®šä¹‰åœ¨`google.rpc.Code` int32 code = 1; // æ˜“äºå¼€å‘è€…é˜…è¯»çš„é”™è¯¯ä¿¡æ¯ï¼Œå®ƒåº”è¯¥è§£é‡Šé”™è¯¯å¹¶ä¸”æä¾›å¯è¡Œçš„è§£å†³æ–¹æ³• string message = 2; // é™„åŠ çš„é”™è¯¯ä¿¡æ¯ï¼Œå®¢æˆ·ç«¯èƒ½å¤Ÿé€šè¿‡å®ƒå¤„ç†é”™è¯¯ï¼Œä¾‹å¦‚é‡è¯•çš„ç­‰å¾…æ—¶é—´æˆ–è€…å¸®åŠ©é¡µé¢é“¾æ¥ repeated google.protobuf.Any details = 3;&#125; å› ä¸ºå¤§éƒ¨åˆ† Google API ä½¿ç”¨é¢å‘èµ„æºçš„è®¾è®¡ï¼Œæ‰€ä»¥é”™è¯¯å¤„ç†é€šè¿‡åœ¨å¤§é‡èµ„æºä¸Šä½¿ç”¨ä¸€å°ç»„æ ‡å‡†é”™è¯¯ä¹Ÿéµå¾ªäº†ç›¸åŒçš„è®¾è®¡åŸåˆ™ã€‚ä¾‹å¦‚ï¼ŒæœåŠ¡ç«¯ä½¿ç”¨ä¸€ä¸ªæ ‡å‡†çš„ google.rpc.Code.NOT_FOUND é”™è¯¯ç åŠ ä¸Šç‰¹å®šçš„èµ„æºåæ¥è¡¨ç¤ºâ€œæœªæ‰¾åˆ°â€é”™è¯¯ï¼Œè€Œä¸æ˜¯å®šä¹‰ä¸åŒç§ç±»çš„â€œæœªæ‰¾åˆ°â€é”™è¯¯ã€‚æ›´å°‘çš„é”™è¯¯çŠ¶æ€å‡å°‘äº†æ–‡æ¡£çš„å¤æ‚æ€§ï¼Œåœ¨å®¢æˆ·ç«¯çš„åº“ä¸­æä¾›æ›´å¥½çš„ä¹ æƒ¯æ€§æ˜ å°„ï¼Œåœ¨ä¸é™åˆ¶å¯åŒ…å«ä¿¡æ¯çš„æƒ…å†µä¸‹å‡å°‘äº†å®¢æˆ·ç«¯é€»è¾‘çš„å¤æ‚æ€§ã€‚ é”™è¯¯ç  Google API å¿…é¡»ï¼ˆmustï¼‰ ä½¿ç”¨ google.rpc.Code ä¸­å®šä¹‰çš„æ ‡å‡†é”™è¯¯ç ã€‚å•ç‹¬çš„ API åº”è¯¥ï¼ˆshouldï¼‰ é¿å…å®šä¹‰é™„åŠ é”™è¯¯ç ï¼Œå› ä¸ºå¼€å‘è€…éå¸¸ä¸å–œæ¬¢ä¸ºå¤§é‡é”™è¯¯ç ç¼–å†™å¤„ç†é€»è¾‘ã€‚ä½œä¸ºå‚è€ƒï¼Œæ¯ä¸ª API å¤„ç†å¹³å‡ 3 ä¸ªé”™è¯¯ç æ„å‘³ç€å¤§éƒ¨åˆ†ç¨‹åºé€»è¾‘åœ¨è¿›è¡Œé”™è¯¯å¤„ç†ï¼Œè¿™å¹¶ä¸æ˜¯å¥½çš„å¼€å‘ä½“éªŒã€‚ é”™è¯¯æ¶ˆæ¯ é”™è¯¯æ¶ˆæ¯åº”è¯¥å¸®åŠ©ç”¨æˆ·è½»æ¾å¹¶å¿«é€Ÿåœ° ç†è§£å¹¶è§£å†³ API é”™è¯¯ã€‚é€šå¸¸æƒ…å†µè¯·å‚è€ƒå¦‚ä¸‹è§„åˆ™ï¼š ä¸è¦å‡è®¾ç”¨æˆ·éå¸¸äº†è§£ä½ çš„ APIã€‚ç”¨æˆ·å¯èƒ½æ˜¯å®¢æˆ·ç«¯å¼€å‘è€…ã€è¿ç»´äººå‘˜ã€IT äººå‘˜æˆ–è€… app çš„æ™®é€šç”¨æˆ·ã€‚ ä¸è¦å‡è®¾ç”¨æˆ·äº†è§£æœåŠ¡å®ç°çš„ç»†èŠ‚æˆ–ç†Ÿæ‚‰é”™è¯¯ä¸Šä¸‹æ–‡ï¼ˆä¾‹å¦‚æ—¥å¿—åˆ†æï¼‰ã€‚ å¦‚æœå¯èƒ½çš„è¯ï¼Œåº”æ„å»ºé”™è¯¯æ¶ˆæ¯ï¼Œä»¥ä¾¿æŠ€æœ¯ç”¨æˆ·ï¼ˆä½†ä¸ä¸€å®šæ˜¯ API çš„å¼€å‘äººå‘˜ï¼‰å¯ä»¥å¯¹é”™è¯¯è¿›è¡Œå“åº”å¹¶æ›´æ­£ã€‚ ä¿æŒé”™è¯¯ä¿¡æ¯çš„ç®€çŸ­ã€‚å¦‚æœéœ€è¦çš„è¯ï¼Œæä¾›é“¾æ¥ä»¥ä¾¿è¿·æƒ‘çš„ç”¨æˆ·èƒ½å¤Ÿæå‡ºé—®é¢˜å¾—åˆ°åé¦ˆæˆ–å¾—åˆ°æ›´å¤šä¿¡æ¯ã€‚å¦åˆ™ï¼Œè¯·ä½¿ç”¨ details å­—æ®µæ¥æ‰©å±•é”™è¯¯æ¶ˆæ¯ã€‚ é”™è¯¯è¯¦æƒ… Google API ä¸ºé”™è¯¯è¯¦æƒ…å®šä¹‰äº†ä¸€ç»„æ ‡å‡†é”™è¯¯è´Ÿè½½ï¼Œå¯ä»¥å» google/rpc/error_details.proto æŸ¥çœ‹ã€‚è¿™é‡ŒåŒ…å«äº† API ä¸­æœ€å¸¸è§çš„é”™è¯¯ï¼Œä¾‹å¦‚è¾¾åˆ°èµ„æºé™é¢å’Œé”™è¯¯çš„è¾“å…¥å‚æ•°ã€‚ä¸é”™è¯¯ç ç›¸åŒï¼Œé”™è¯¯è¯¦æƒ…ä¹Ÿåº”è¯¥ä½¿ç”¨æ ‡å‡†çš„è´Ÿè½½ã€‚ åªæœ‰åœ¨èƒ½å¤Ÿå¸®åŠ©ç¨‹åºä»£ç å¤„ç†é”™è¯¯æ—¶æ‰å¯ä»¥ä¸ºé”™è¯¯è¯¦æƒ…å¼•å…¥æ–°çš„ç±»å‹ã€‚å¦‚æœé”™è¯¯ä¿¡æ¯åªèƒ½å¤Ÿç”±äººï¼ˆéä»£ç ï¼‰å¤„ç†ï¼Œåº”å½“è®©å¼€å‘è€…ä¾èµ–é”™è¯¯æ¶ˆæ¯çš„å†…å®¹æ¥æ‰‹åŠ¨å¤„ç†ï¼Œè€Œä¸æ˜¯å¼•å…¥æ–°çš„é”™è¯¯è¯¦æƒ…ç±»å‹ã€‚å¦‚æœæ–°çš„ç±»å‹è¢«å¼•å…¥ï¼Œä¸€å®šè¦ä¸ºå®ƒä»¬è¿›è¡Œæ˜¾å¼çš„æ³¨å†Œã€‚ è¿™é‡Œæœ‰ä¸€äº› error_details è´Ÿè½½çš„ç¤ºä¾‹ï¼š RetryInfo æè¿°äº†å½“å®¢æˆ·ç«¯èƒ½å¤Ÿé‡è¯•è¯·æ±‚æ—¶ï¼Œå¯èƒ½è¿”å› Code.UNAVAILABLE æˆ– Code.ABORTED QuotaFailure æè¿°äº†é…é¢æ£€æŸ¥å¤±è´¥çš„åŸå› ï¼Œå¯èƒ½è¿”å› Code.RESOURCE_EXHAUSTED BadRequest æè¿°äº†å®¢æˆ·ç«¯çš„éæ³•è¯·æ±‚ï¼Œå¯èƒ½è¿”å› Code.INVALID_ARGUMENT HTTP æ˜ å°„ è™½ç„¶ proto3 æœ‰åŸç”Ÿçš„ JSON ç¼–ç ï¼Œä½† Google çš„ API å¹³å°ä½¿ç”¨å¦‚ä¸‹çš„ JSON æ ¼å¼è¿›è¡Œé”™è¯¯å“åº”ï¼Œä»¥å…è®¸å‘åå…¼å®¹ï¼š 1234567891011&#123; &quot;error&quot;: &#123; &quot;code&quot;: 401, &quot;message&quot;: &quot;Request had invalid credentials.&quot;, &quot;status&quot;: &quot;UNAUTHENTICATED&quot;, &quot;details&quot;: [&#123; &quot;@type&quot;: &quot;type.googleapis.com/google.rpc.RetryInfo&quot;, ... &#125;] &#125;&#125; å­—æ®µ æè¿° error ä¸ºäº†å‘åå…¼å®¹ Google API å®¢æˆ·ç«¯åº“æ·»åŠ çš„é¢å¤–å±‚ code Status.code æ˜ å°„ä¸º HTTP çŠ¶æ€ç  message å¯¹åº” Status.message status å¯¹åº” Status.code details å¯¹åº” Status.details RPC æ˜ å°„ ä¸åŒçš„ RPC åè®®ç”¨ä¸åŒçš„æ–¹æ³•æ˜ å°„åˆ°é”™è¯¯æ¨¡å‹ï¼ˆerror modelï¼‰ã€‚å¯¹äº gRPCï¼Œç”Ÿæˆçš„ä»£ç å’Œæ‰€æœ‰è¯­è¨€çš„è¿è¡Œåº“éƒ½åŸç”Ÿæ”¯æŒé”™è¯¯æ¨¡å‹ã€‚ä½ å¯ä»¥å» gRPC çš„ API æ–‡æ¡£ä¸­æŸ¥çœ‹è¯¦æƒ…ã€‚ å®¢æˆ·ç«¯åº“çš„æ˜ å°„ Google å®¢æˆ·ç«¯åº“å¯èƒ½ä¼šé€‰æ‹©æŒ‰ç…§ä¸åŒçš„æƒ¯ä¾‹æ¥å¯¹ä¸åŒè¯­è¨€è¿›è¡Œä¸åŒçš„é”™è¯¯å¤„ç†ã€‚ä¾‹å¦‚ï¼Œåº“ google-cloud-go ä¼šè¿”å› google.rpc.Status çš„å®ä¾‹ï¼Œè€Œ google-cloud-java åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚ é”™è¯¯ä¿¡æ¯æœ¬åœ°åŒ– google.rpc.Status ä¸­çš„ message å­—æ®µæ˜¯é¢å‘å¼€å‘è€…çš„ï¼Œå¿…é¡»ï¼ˆmustï¼‰ æ˜¯è‹±è¯­ã€‚ å¦‚æœéœ€è¦å‘ç”¨æˆ·æä¾›é”™è¯¯ä¿¡æ¯ï¼Œè¯·ä½¿ç”¨ google.rpc.LocalizedMessageä½œä¸ºè¯¦æƒ…å­—æ®µã€‚google.rpc.LocalizedMessage å¯ä»¥è¢«æœ¬åœ°åŒ–ï¼Œä½†è¯·ä¿è¯ google.rpc.Status ä¸­æ˜¯è‹±æ–‡ã€‚ API æœåŠ¡åº”è¯¥é»˜è®¤ä½¿ç”¨è®¤è¯ç”¨æˆ·çš„ locale æˆ– HTTP Accept-Language å¤´æ¥å†³å®šæœ¬åœ°åŒ–è¯­è¨€ã€‚ é”™è¯¯å¤„ç† ä¸‹è¡¨åŒ…å«äº†æ‰€æœ‰åœ¨ google.rpc.Code ä¸­å®šä¹‰çš„ gRPC é”™è¯¯ä»£ç å’Œäº§ç”ŸåŸå› çš„ç®€å•æè¿°ã€‚å¯ä»¥é€šè¿‡æŸ¥çœ‹è¿”å›çŠ¶æ€ç çš„æè¿°å¹¶ä¿®æ”¹å¯¹åº”çš„ä»£ç æ¥å¤„ç†é”™è¯¯ã€‚ | HTTP | RPC | Description | | - | - | | 200 | OK | æ²¡æœ‰é”™è¯¯ | | 400 | INVALID_ARGUMENT | å®¢æˆ·ç«¯ä½¿ç”¨äº†é”™è¯¯çš„å‚æ•°ï¼Œé€šè¿‡ error message å’Œ error details æŸ¥çœ‹æ›´å¤šä¿¡æ¯ | | 400 | FAILED_PRECONDITION | å½“å‰çš„ç³»ç»ŸçŠ¶æ€ä¸èƒ½æ‰§è¡Œè¯·æ±‚ï¼Œä¾‹å¦‚åˆ é™¤éç©ºç›®å½• | | 400 | OUT_OF_RANGE | å®¢æˆ·ç«¯æŒ‡å®šæ— æ•ˆèŒƒå›´ | | 401 | UNAUTHENTICATED | ç”±äºç¼ºå°‘ã€æ— æ•ˆæˆ–è¿‡æœŸçš„ OAuth ä»¤ç‰Œï¼Œè¯·æ±‚æœªé€šè¿‡èº«ä»½éªŒè¯ | | 403 | PERMISSION_DENIED | å®¢æˆ·ç«¯æ²¡æœ‰è¶³å¤Ÿçš„æƒé™ï¼Œè¿™å¯èƒ½æ˜¯å› ä¸º OAuth ä»¤ç‰Œæ²¡æœ‰æ­£ç¡®çš„èŒƒå›´ï¼Œå®¢æˆ·ç«¯æ²¡æœ‰æƒé™æˆ–è€… API è¿˜æ²¡æœ‰å¼€æ”¾ | | 404 | NOT_FOUND | æŒ‡å®šçš„èµ„æºä¸å­˜åœ¨ï¼Œæˆ–è€…ç”±äºæœªå…¬å¼€çš„åŸå› ï¼ˆå¦‚ç™½åå•ï¼‰è¯·æ±‚è¢«æ‹’ç» | | 409 | ABORTED | å¹¶å‘å†²çªï¼Œä¾‹å¦‚è¯»å†™å†²çª | | 409 | ALREADY_EXISTS | å®¢æˆ·ç«¯è¯•å›¾åˆ›å»ºçš„èµ„æºå·²ç»å­˜åœ¨ | | 429 | RESOURCE_EXHAUSTED | è¶…è¿‡èµ„æºé™é¢æˆ–é¢‘ç‡é™åˆ¶,å®¢æˆ·ç«¯åº”è¯¥é€šè¿‡ google.rpc.QuotaFailure æŸ¥çœ‹æ›´å¤šä¿¡æ¯ | | 499 | CANCELLED | å®¢æˆ·ç«¯å–æ¶ˆè¯·æ±‚ | | 500 | DATA_LOSS | ä¸å¯æ¢å¤çš„æ•°æ®ä¸¢å¤±æˆ–æŸåï¼Œå®¢æˆ·ç«¯åº”è¯¥å°†æ­¤é”™è¯¯æŠ¥å‘Šç»™ç”¨æˆ· | | 500 | UNKNOWN | æœåŠ¡ç«¯æœªçŸ¥é”™è¯¯ï¼Œä¸€èˆ¬æ˜¯ BUG | | 500 | INTERNAL | æœåŠ¡ç«¯å†…éƒ¨é”™è¯¯ï¼Œä¸€èˆ¬æ˜¯ BUG | | 501 | NOT_IMPLEMENTED | æœåŠ¡ç«¯æœªå®ç°æ­¤ API | | 503 | UNAVAILABLE | æœåŠ¡ç«¯ä¸å¯ç”¨ï¼Œä¸€èˆ¬æ˜¯æœåŠ¡ç«¯æŒ‚äº† | | 504 | DEADLINE_EXCEEDED | è¯·æ±‚è¶…è¿‡æœ€åæœŸé™ï¼Œå¦‚æœé‡å¤å‘ç”Ÿï¼Œè¯·è€ƒè™‘å‡å°‘è¯·æ±‚çš„å¤æ‚æ€§ | é”™è¯¯é‡è¯• å½“å‘ç”Ÿ 500ï¼Œ503 å’Œ 504 é”™è¯¯æ—¶å®¢æˆ·ç«¯ åº”è¯¥ï¼ˆshouldï¼‰ ä»¥æŒ‡æ•°çº§å¢é•¿çš„é—´éš”æ¥é‡è¯•è¯·æ±‚ã€‚é™¤éæ–‡æ¡£ä¸­è¿›è¡Œäº†è¯´æ˜ï¼Œæœ€å°çš„é‡è¯•é—´éš”åº”è¯¥æ˜¯ 1 ç§’ã€‚å¯¹äº 429 é”™è¯¯ï¼Œå®¢æˆ·ç«¯åº”è¯¥ä»¥æœ€å° 30 ç§’çš„é—´éš”é‡è¯•ã€‚å¯¹äºå…¶ä»–é”™è¯¯ï¼Œé‡è¯•æ“ä½œå¯èƒ½å¹¶ä¸å¯è¡Œï¼Œè¯·å…ˆç¡®ä¿è¯·æ±‚æ˜¯å¹‚ç­‰çš„å¹¶æŸ¥çœ‹é”™è¯¯æ¶ˆæ¯ä»¥è·å¾—æŒ‡å¼•ã€‚ é”™è¯¯ä¼ æ’­ å¦‚æœ API æœåŠ¡ä¾èµ–äºå…¶ä»–æœåŠ¡ï¼Œåˆ™ä¸åº”ç›²ç›®åœ°å°†è¿™äº›æœåŠ¡ä¸­çš„é”™è¯¯ä¼ æ’­ç»™å®¢æˆ·ç«¯ã€‚ç¿»è¯‘é”™è¯¯æ—¶ï¼Œæœ‰å¦‚ä¸‹å»ºè®®ï¼š éšè—å®ç°ç»†èŠ‚å’Œæœºå¯†ä¿¡æ¯ è°ƒæ•´è´Ÿè´£è¯¥é”™è¯¯çš„ä¸€æ–¹ã€‚ä¾‹å¦‚ï¼Œåº”æŠŠä»å…¶ä»–æœåŠ¡æ¥æ”¶åˆ° INVALID ARGUMENT é”™è¯¯è½¬æ¢ä¸º INTERNAL è¿”å›ç»™è°ƒç”¨è€…ã€‚ ç”Ÿæˆé”™è¯¯ æœåŠ¡ç«¯äº§ç”Ÿçš„é”™è¯¯åº”è¯¥åŒ…å«è¶³å¤Ÿå¤šçš„ä¿¡æ¯æ¥å¸®åŠ©å®¢æˆ·ç«¯å¼€å‘è€…ç†è§£å’Œè§£å†³é—®é¢˜ã€‚åŒæ—¶ä¹Ÿè¦å°å¿ƒç”¨æˆ·æ•°æ®çš„å®‰å…¨å’Œéšç§ï¼Œå› ä¸ºé”™è¯¯ç»å¸¸ä¼šè¢«ä½œä¸ºæ—¥å¿—è®°å½•ä¸‹æ¥å¹¶è¢«å…¶ä»–äººæŸ¥çœ‹ï¼Œæ‰€ä»¥åº”é¿å…åœ¨é”™è¯¯ä¿¡æ¯å’Œé”™è¯¯è¯¦æƒ…ä¸­æš´éœ²æ•æ„Ÿä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œé”™è¯¯ä¿¡æ¯â€œClient IP address is not on whitelist 128.0.0.0/8â€å°†ç”¨æˆ·ä¸å¯è®¿é—®çš„æœåŠ¡ç«¯ç­–ç•¥æš´éœ²å‡ºå»äº†ã€‚ ä¸ºäº†ç”Ÿæˆåˆé€‚çš„é”™è¯¯ï¼Œä½ é¦–å…ˆåº”è¯¥ç†Ÿæ‚‰ google.rpc.Code æ¥ä¸ºæ¯ç§é”™è¯¯æ¡ä»¶é€‰æ‹©æœ€åˆé€‚çš„é”™è¯¯ã€‚æœåŠ¡ç«¯ç¨‹åºå¯ä»¥å¹¶è¡Œæ£€æŸ¥å¤šä¸ªé”™è¯¯æ¡ä»¶ï¼Œç„¶åè¿”å›ç¬¬ä¸€ä¸ªã€‚ ä¸‹è¡¨åˆ—å‡ºäº†æ¯ä¸€ç§é”™è¯¯ç å’Œå¯¹åº”çš„é”™è¯¯ä¿¡æ¯ç¤ºä¾‹ã€‚ HTTP RPC é”™è¯¯ä¿¡æ¯ç¤ºä¾‹ 400 INVALID_ARGUMENT Request field x.y.z is xxx, expected one of [yyy, zzz]. 400 FAILED_PRECONDITION Resource xxx is a non-empty directory, so it cannot be deleted. 400 OUT_OF_RANGE Parameter â€˜ageâ€™ is out of range [0, 125]. 401 UNAUTHENTICATED Invalid authentication credentials. 403 PERMISSION_DENIED Permission â€˜xxxâ€™ denied on file â€˜yyyâ€™. 404 NOT_FOUND Resource â€˜xxxâ€™ not found. 409 ABORTED Couldnâ€™t acquire lock on resource â€˜xxxâ€™. 409 ALREADY_EXISTS Resource â€˜xxxâ€™ already exists. 429 RESOURCE_EXHAUSTED Quota limit â€˜xxxâ€™ exceeded. 499 CANCELLED Request cancelled by the client. 500 DATA_LOSS è¯·çœ‹æç¤º 500 UNKNOWN è¯·çœ‹æç¤º 500 INTERNAL è¯·çœ‹æç¤º 501 NOT_IMPLEMENTED Method â€˜xxxâ€™ not implemented. 503 UNAVAILABLE è¯·çœ‹æç¤º 504 DEADLINE_EXCEEDED è¯·çœ‹æç¤º æç¤ºï¼šå› ä¸ºå®¢æˆ·ç«¯ä¸èƒ½ä¿®å¤æœåŠ¡ç«¯çš„é”™è¯¯ï¼Œç”Ÿæˆé¢å¤–çš„é”™è¯¯è¯¦æƒ…å¹¶æ²¡æœ‰ç”¨å¤„ã€‚ä¸ºäº†é¿å…é€šè¿‡ error condition æ³„éœ²æ•æ„Ÿä¿¡æ¯ï¼Œæ¨èä¸è¦ç”Ÿæˆä»»ä½• error message å¹¶ä¸”åªç”Ÿæˆ google.rpc.DebugInfo é”™è¯¯è¯¦æƒ…ã€‚DebugInfo åªèƒ½ç”¨äºæœåŠ¡ç«¯æ—¥å¿—ï¼Œä¸è¦å‘é€ç»™å®¢æˆ·ç«¯ã€‚ google.rpc å®šä¹‰äº†ä¸€ç»„æ ‡å‡†é”™è¯¯è´Ÿè½½ï¼Œå®ƒä»¬ä¼˜å…ˆäºè‡ªå®šä¹‰çš„é”™è¯¯è´Ÿè½½ã€‚ä¸‹è¡¨åˆ—å‡ºäº†æ¯ä¸ªé”™è¯¯ä»£ç åŠå…¶åŒ¹é…çš„æ ‡å‡†é”™è¯¯è´Ÿè½½ã€‚ HTTP RPC æ¨èçš„é”™è¯¯è¯¦æƒ… 400 INVALID_ARGUMENT google.rpc.BadRequest 400 FAILED_PRECONDITION google.rpc.PreconditionFailure 400 OUT_OF_RANGE google.rpc.BadRequest 401 UNAUTHENTICATED 403 PERMISSION_DENIED 404 NOT_FOUND 409 ABORTED 409 ALREADY_EXISTS 429 RESOURCE_EXHAUSTED google.rpc.QuotaFailure 499 CANCELLED 500 DATA_LOSS 500 UNKNOWN 500 INTERNAL 501 NOT_IMPLEMENTED 503 UNAVAILABLE 504 DEADLINE_EXCEEDED æŸ¥çœ‹å…¶ä»–ç« èŠ‚]]></content>
      <tags>
        <tag>æ¶æ„</tag>
        <tag>ç¿»è¯‘</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Google API è®¾è®¡æŒ‡å—ï¼æ ‡å‡†å­—æ®µ]]></title>
    <url>%2F2017%2F03%2Fgoogle-api-design-guide%2Fstandard-fields%2F</url>
    <content type="text"><![CDATA[ç¿»è¯‘è‡ª API Design Guide - Standard Fields æœ¬èŠ‚ä»‹ç»äº†åœ¨éœ€è¦ç±»ä¼¼æ¦‚å¿µæ—¶åº”ä½¿ç”¨çš„ä¸€ç»„æ ‡å‡†æ¶ˆæ¯å­—æ®µå®šä¹‰ï¼Œè¿™å°†ç¡®ä¿ç›¸åŒçš„æ¦‚å¿µåœ¨ä¸åŒçš„ API ä¸­å…·æœ‰ç›¸åŒçš„åç§°å’Œè¯­ä¹‰ã€‚ åç§° ç±»å‹ æè¿° name string name å­—æ®µåº”è¯¥åŒ…å«ç›¸å¯¹èµ„æºåç§° parent string å¯¹äºèµ„æºå®šä¹‰å’Œ List/Create è¯·æ±‚ï¼Œparent å­—æ®µåº”è¯¥åŒ…å«çˆ¶èµ„æºçš„ç›¸å¯¹èµ„æºåç§° create_time Timestamp èµ„æºåˆ›å»ºçš„æ—¶é—´æˆ³ update_time Timestamp èµ„æºæœ€åæ›´æ–°çš„æ—¶é—´æˆ³ï¼ˆå½“æ‰§è¡Œ create/patch/delete æ“ä½œæ—¶æ›´æ–°ï¼‰ delete_time Timestamp èµ„æºåˆ é™¤çš„æ—¶é—´æˆ³ï¼Œåªæœ‰æ”¯æŒæ¢å¤æ—¶æœ‰æ•ˆ time_zone string æ—¶åŒºåï¼Œå¿…é¡»æ˜¯ä¸€ä¸ªåƒ â€œAmerica/Los_Angelesâ€ çš„ IANA TZ åå­—ã€‚æ›´å¤šä¿¡æ¯è¯·å‚è€ƒ https://en.wikipedia.org/wiki/List_of_tz_database_time_zones region_code string å›½å®¶åœ°åŒºç¼–ç ï¼ˆCLDRï¼‰ï¼Œæ›´å¤šä¿¡æ¯è¯·å‚è€ƒ http://www.unicode.org/reports/tr35/#unicode_region_subtag language_code string BCP-47 è¯­è¨€ç¼–ç ä¾‹å¦‚â€œen-USâ€æˆ–â€œsr-Latnâ€ï¼Œæ›´å¤šä¿¡æ¯è¯·å‚è€ƒ http://www.unicode.org/reports/tr35/#Unicode_locale_identifier display_name string èµ„æºçš„æ˜¾ç¤ºåç§° title string èµ„æºçš„å®˜æ–¹åç§°ï¼Œä¾‹å¦‚å…¬å¸åç§°ã€‚å®ƒåº”è¯¥è¢«çœ‹åšæ˜¯ display_name çš„æ­£å¼åç§° description string èµ„æºçš„æè¿°ä¿¡æ¯ filter string List æ–¹æ³•çš„æ ‡å‡†è¿‡æ»¤å­—æ®µ query string åœ¨ search æ–¹æ³•ä¸­ä½¿ç”¨ï¼ŒåŠŸèƒ½ä¸ filter ç›¸åŒ page_token string List è¯·æ±‚ä¸­çš„åˆ†é¡µå­—æ®µ page_size int32 List è¯·æ±‚ä¸­ä¸€é¡µçš„å¤§å° total_size int32 èµ„æºæ€»æ•°é‡ next_page_token string List å“åº”ä¸­çš„ä¸‹ä¸€é¡µï¼Œç”¨äºä¸‹ä¸€æ¬¡è¯·æ±‚çš„ page_token å­—æ®µ resume_token string ç”¨äºæ¢å¤æµè¯·æ±‚çš„ opaque token labels map&lt;string, string&gt; è¡¨ç¤ºäº‘èµ„æºæ ‡ç­¾ deleted bool å¦‚æœèµ„æºæ”¯æŒæ¢å¤ï¼Œå®ƒå¿…é¡»å…·æœ‰ deleted æ ‡ç­¾æ¥æ ‡è®°èµ„æºæ˜¯å¦è¢«åˆ é™¤ show_deleted bool å¦‚æœèµ„æºæ”¯æŒæ¢å¤ï¼Œå¯¹åº”çš„ List æ–¹æ³•å¿…é¡»æœ‰ show_deleted å­—æ®µæ¥è¡¨ç¤ºæ˜¯å¦å±•ç¤ºè¢«åˆ é™¤çš„èµ„æº update_mask FieldMask ç”¨äºåœ¨ Update è¯·æ±‚ä¸­å¯¹èµ„æºè¿›è¡Œéƒ¨åˆ†æ›´æ–° validate_only bool ä¸º true æ—¶è¡¨ç¤ºè¯·æ±‚åªéªŒè¯è€Œä¸ä¼šæ‰§è¡Œ æŸ¥çœ‹å…¶ä»–ç« èŠ‚]]></content>
      <tags>
        <tag>æ¶æ„</tag>
        <tag>ç¿»è¯‘</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Google API è®¾è®¡æŒ‡å—ï¼è‡ªå®šä¹‰æ–¹æ³•]]></title>
    <url>%2F2017%2F03%2Fgoogle-api-design-guide%2Fcustom-methods%2F</url>
    <content type="text"><![CDATA[ç¿»è¯‘è‡ª API Design Guide - Custom Methods æ­¤ç¯‡æ–‡ç« è®¨è®ºå¦‚ä½•åœ¨ API è®¾è®¡ä¸­ä½¿ç”¨è‡ªå®šä¹‰æ–¹æ³•ã€‚ è‡ªå®šä¹‰æ–¹æ³•æŒ‡äº”ä¸ªæ ‡å‡†æ–¹æ³•ä¹‹å¤–çš„ API æ–¹æ³•ã€‚åº”è¯¥ï¼ˆshouldï¼‰ åªæœ‰å½“æ ‡å‡†æ–¹æ³•ä¸èƒ½å®Œæˆéœ€è¦çš„åŠŸèƒ½æ—¶æ‰ä½¿ç”¨è‡ªå®šä¹‰æ–¹æ³•ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒAPI è®¾è®¡è€… åº”è¯¥ï¼ˆshouldï¼‰ åœ¨å¯è¡Œçš„æƒ…å†µä¸‹é€‰æ‹©æ ‡å‡†æ–¹æ³•ã€‚æ ‡å‡†æ–¹æ³•æœ‰æ›´ç®€æ´å’Œæ˜ç¡®å®šä¹‰çš„è¯­ä¹‰å¹¶ä¸”è¢«å¤§å¤šæ•°å¼€å‘è€…ç†ŸçŸ¥ï¼Œæ‰€ä»¥å®ƒä»¬æ›´æ˜“äºä½¿ç”¨å¹¶ä¸”ä¸æ˜“å‡ºé”™ã€‚å¦ä¸€ä¸ªä¼˜åŠ¿æ˜¯ API å¹³å°å¯¹æ ‡å‡†æ–¹æ³•çš„æ”¯æŒæ›´å¥½ï¼Œæ¯”å¦‚è®¡è´¹ã€é”™è¯¯å¤„ç†ã€æ—¥å¿—å’Œç›‘æ§ã€‚ è‡ªå®šä¹‰æ–¹æ³•å¯ä»¥è¢«å…³è”åˆ°èµ„æºã€é›†åˆæˆ–æœåŠ¡ã€‚å®ƒ å¯ä»¥ï¼ˆmayï¼‰ æ¥æ”¶ä»»æ„è¯·æ±‚å¹¶è¿”å›ä»»æ„å“åº”ï¼Œå¹¶ä¸”ä¹Ÿå¯ä»¥æ”¯æŒæµå¼è¯·æ±‚ä¸å“åº”ã€‚ HTTP æ˜ å°„ è‡ªå®šä¹‰æ–¹æ³• åº”è¯¥ï¼ˆshouldï¼‰ ä½¿ç”¨å¦‚ä¸‹çš„é€šç”¨æ˜ å°„æ–¹æ³•ï¼š 1https://service.name/v1/some/resource/name:customVerb ä½¿ç”¨ : ä»£æ›¿ / æ¥åˆ†éš”èµ„æºåä¸è‡ªå®šä¹‰åŠ¨è¯æ˜¯ä¸ºäº†æ”¯æŒä»»æ„ path å‚æ•°ï¼Œä¾‹å¦‚ï¼Œå–æ¶ˆåˆ é™¤ï¼ˆundeleteï¼‰æ–‡ä»¶èƒ½æ˜ å°„ä¸º POST /files/a/long/file/name:undeleteã€‚ é€‰æ‹© HTTP æ˜ å°„æ—¶ å¿…é¡»ï¼ˆshallï¼‰ éµå®ˆå¦‚ä¸‹æŒ‡å—ï¼š è‡ªå®šä¹‰æ–¹æ³• åº”è¯¥ï¼ˆshouldï¼‰ ä½¿ç”¨ HTTP POST åŠ¨è¯ï¼Œå› ä¸º POST æœ‰æ›´åŠ çµæ´»çš„è¯­ä¹‰ è‡ªå®šä¹‰æ–¹æ³• ä¸åº”è¯¥ï¼ˆshould notï¼‰ ä½¿ç”¨ HTTP PATCHï¼Œä½† å¯ä»¥ï¼ˆmayï¼‰ ä½¿ç”¨å…¶å®ƒ HTTP åŠ¨è¯ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæ–¹æ³•å¿…é¡»ï¼ˆmustï¼‰ éµå¾ªè¯¥åŠ¨è¯çš„æ ‡å‡† HTTP è¯­ä¹‰ æ³¨æ„ï¼Œä½¿ç”¨ HTTP GET çš„è‡ªå®šä¹‰æ–¹æ³• å¿…é¡»ï¼ˆmustï¼‰ æ˜¯å¹‚ç­‰çš„å¹¶ä¸”ä¸èƒ½æœ‰å‰¯ä½œç”¨ã€‚ä¾‹å¦‚ï¼Œåœ¨èµ„æºä¸Šå®ç°ç‰¹æ®ŠæŸ¥è¯¢çš„è‡ªå®šä¹‰æ–¹æ³•åº”è¯¥ä½¿ç”¨ HTTP GETã€‚ è‡ªå®šä¹‰æ–¹æ³•ä¸­å¾…æ“ä½œçš„èµ„æºæˆ–é›†åˆå åº”è¯¥ï¼ˆshouldï¼‰ æ˜ å°„åˆ° URL path å‚æ•° URL path å¿…é¡»ï¼ˆmustï¼‰ ä»¥å†’å·åŠ ä¸Šè‡ªå®šä¹‰åŠ¨è¯åšä¸ºåç¼€ å¦‚æœè‡ªå®šä¹‰æ–¹æ³•ä½¿ç”¨çš„ HTTP åŠ¨è¯å…è®¸ HTTP è¯·æ±‚ä½“ï¼ˆPOSTã€PUTã€PATCHæˆ–è‡ªå®šä¹‰çš„ HTTP åŠ¨è¯ï¼‰ï¼Œè¿™äº›è‡ªå®šä¹‰æ–¹æ³•çš„ HTTP é…ç½® å¿…é¡»ï¼ˆmustï¼‰ ä½¿ç”¨ body: &quot;*&quot; å¹¶ä¸”æ‰€æœ‰å‰©ä½™çš„è¯·æ±‚ä¿¡æ¯ å¿…é¡»ï¼ˆshallï¼‰ æ˜ å°„åˆ° HTTP è¯·æ±‚ä½“ä¸­ å¦‚æœè‡ªå®šä¹‰æ–¹æ³•ä½¿ç”¨çš„ HTTP åŠ¨è¯ä¸å…è®¸ HTTP è¯·æ±‚ä½“ï¼ˆGETã€DELETEï¼‰ï¼Œè¿™äº›æ–¹æ³•çš„ HTTP é…ç½® ä¸€å®šä¸è¦ï¼ˆmust notï¼‰ ä½¿ç”¨ bodyï¼Œæ‰€æœ‰å‰©ä½™çš„è¯·æ±‚ä¿¡æ¯ å¿…é¡»ï¼ˆshallï¼‰ æ˜ å°„åˆ° HTTP query å‚æ•°ä¸­ è­¦å‘Šï¼šå¦‚æœæœåŠ¡å®ç°å¤šä¸ª APIï¼Œå¿…é¡»ï¼ˆmustï¼‰ å°å¿ƒåœ°åˆ›å»ºæœåŠ¡é…ç½®ä»¥é¿å… API é—´çš„è‡ªå®šä¹‰åŠ¨è¯å†²çªã€‚ 1234567891011121314151617181920212223242526272829303132// æœåŠ¡çº§åˆ«çš„è‡ªå®šä¹‰æ–¹æ³•rpc Watch(WatchRequest) returns (WatchResponse) &#123; // è‡ªå®šä¹‰æ–¹æ³•æ˜ å°„åˆ° HTTP POSTï¼Œæ‰€æœ‰å‚æ•°æ”¾åˆ°è¯·æ±‚ä½“ä¸­ option (google.api.http) = &#123; post: &quot;/v1:watch&quot; body: &quot;*&quot; &#125;;&#125;// é›†åˆçº§åˆ«çš„è‡ªå®šä¹‰æ–¹æ³•rpc ClearEvents(ClearEventsRequest) returns (ClearEventsResponse) &#123; option (google.api.http) = &#123; post: &quot;/v3/events:clear&quot; body: &quot;*&quot; &#125;;&#125;// èµ„æºçº§åˆ«çš„è‡ªå®šä¹‰æ–¹æ³•rpc CancelEvent(CancelEventRequest) returns (CancelEventResponse) &#123; option (google.api.http) = &#123; post: &quot;/v3/&#123;name=events/*&#125;:cancel&quot; body: &quot;*&quot; &#125;;&#125;// ç”¨äºæ‰¹é‡ get çš„è‡ªå®šä¹‰æ–¹æ³•rpc BatchGetEvents(BatchGetEventsRequest) returns (BatchGetEventsResponse) &#123; // æ‰¹é‡ get æ–¹æ³•æ˜ å°„åˆ° HTTP GET option (google.api.http) = &#123; get: &quot;/v3/events:batchGet&quot; &#125;;&#125; ç”¨ä¾‹ ä¸€äº›å¯é€‰æ‹©è‡ªå®šä¹‰æ–¹æ³•çš„å…¶ä»–æƒ…å†µï¼š é‡å¯è™šæ‹Ÿæœº è®¾è®¡çš„å¤‡é€‰æ–¹æ¡ˆå¯ä»¥æ˜¯â€œåœ¨é‡å¯èµ„æºé›†åˆä¸­åˆ›å»ºä¸€ä¸ªé‡å¯èµ„æºâ€ï¼ˆè¿‡äºå¤æ‚ï¼‰æˆ–è€…â€œè™šæ‹Ÿæœºå…·æœ‰å¯å˜çš„çŠ¶æ€ï¼Œå®¢æˆ·ç«¯èƒ½å¤Ÿå°†å…¶ä»è¿è¡Œä¸­æ”¹å˜ä¸ºé‡å¯ä¸­â€ï¼ˆä¼šå¼•å…¥æ›´å¤šé—®é¢˜ï¼Œæ¯”å¦‚æ˜¯å¦æœ‰å…¶ä»–çŠ¶æ€é—´çš„è½¬å˜ï¼‰ã€‚æ­¤å¤–ï¼Œé‡å¯æ˜¯ä¸€ä¸ªè¢«ç†ŸçŸ¥çš„æ¦‚å¿µï¼Œèƒ½å¤Ÿå¾ˆå¥½åœ°è½¬æ¢ä¸ºæ»¡è¶³å¼€å‘è€…éœ€æ±‚çš„è‡ªå®šä¹‰æ–¹æ³• å‘é€é‚®ä»¶ åˆ›å»ºé‚®ä»¶ä¿¡æ¯å¹¶ä¸ä¸€å®šè¦å°†å®ƒå‘é€å‡ºå»ï¼ˆè‰ç¨¿ï¼‰ã€‚ç›¸å¯¹äºå¤‡é€‰æ–¹æ¡ˆï¼ˆå°†æ¶ˆæ¯ç§»åŠ¨åˆ° Outbox é›†åˆï¼‰ï¼Œè‡ªå®šä¹‰æ–¹æ³•çš„ä¼˜ç‚¹æ˜¯å¯ä»¥è¢« API ç”¨æˆ·æ›´å¤šåœ°å‘ç°å¹¶ä¸”æ›´ç›´æ¥åœ°ç†è§£å®ƒçš„æ¦‚å¿µ å‘˜å·¥æ™‹çº§ å¦‚æœä½¿ç”¨æ ‡å‡†çš„ update æ¥å®ç°ï¼Œå®¢æˆ·ç«¯å¿…é¡»é‡å¤è¿›è¡Œç®¡ç†æµç¨‹çš„ç­–ç•¥æ¥ä¿è¯æ­£ç¡®çš„æ™‹çº§ ä¸€äº›æ ‡å‡†æ–¹æ³•æ¯”è‡ªå®šä¹‰æ–¹æ³•æ›´å¥½çš„ä¾‹å­ï¼š ä½¿ç”¨ä¸åŒçš„å‚æ•°æŸ¥è¯¢èµ„æºï¼ˆä½¿ç”¨æ ‡å‡†çš„ list æ–¹æ³•å’Œè¿‡æ»¤ï¼‰ ç®€å•çš„èµ„æºä¿®æ”¹ï¼ˆä½¿ç”¨å¸¦æœ‰å­—æ®µæ©ç çš„æ ‡å‡† update æ–¹æ³•ï¼‰ æ’¤æ¶ˆé€šçŸ¥ï¼ˆä½¿ç”¨æ ‡å‡†çš„ delete æ–¹æ³•ï¼‰ é€šç”¨è‡ªå®šä¹‰æ–¹æ³• å¸¸ç”¨çš„è‡ªå®šä¹‰æ–¹æ³•åç§°åˆ—è¡¨å¦‚ä¸‹ã€‚ API è®¾è®¡è€…åœ¨å¼•å…¥è‡ªå·²çš„åç§°ä¹‹å‰åº”è¯¥è€ƒè™‘è¿™äº›åç§°ï¼Œä»¥ä¾¿äºè·¨ API çš„ä¸€è‡´æ€§ æ–¹æ³•å è‡ªå®šä¹‰åŠ¨è¯ HTTP åŠ¨è¯ å¤‡æ³¨ Canecl :cancel POST å–æ¶ˆæœªå®Œæˆçš„æ“ä½œï¼ˆæ„å»ºã€è®¡ç®—ç­‰ï¼‰ BatchGet&lt;å¤æ•°åè¯&gt; :batchGet POST æ‰¹é‡å–å¾—å¤šä¸ªèµ„æºï¼ˆè¯¦æƒ…è¯·æŸ¥çœ‹ List çš„æè¿°ï¼‰ Move :move GET å°†èµ„æºä»ä¸€ä¸ªçˆ¶èµ„æºç§»åŠ¨åˆ°å¦ä¸€ä¸ªä¸­ Search :search GET ç”¨äºè·å–ä¸ç¬¦åˆ List è¯­ä¹‰çš„æ•°æ® Undelete :undelete POST æ¢å¤ä»¥å‰åˆ é™¤çš„èµ„æºï¼Œæ¨èçš„ä¿ç•™æœŸä¸º30å¤© æŸ¥çœ‹å…¶ä»–ç« èŠ‚]]></content>
      <tags>
        <tag>æ¶æ„</tag>
        <tag>ç¿»è¯‘</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Google API è®¾è®¡æŒ‡å—ï¼æ ‡å‡†æ–¹æ³•]]></title>
    <url>%2F2017%2F03%2Fgoogle-api-design-guide%2Fstandard-methods%2F</url>
    <content type="text"><![CDATA[ç¿»è¯‘è‡ª API Design Guide - Standard Methods æ­¤ç« èŠ‚å®šä¹‰æ ‡å‡†æ–¹æ³• Listã€Getã€Createã€Update å’Œ Deleteã€‚æ ‡å‡†æ–¹æ³•å­˜åœ¨çš„æ„ä¹‰æ˜¯å¹¿æ³›çš„ API ä¸­è®¸å¤š API æ–¹æ³•å…·æœ‰éå¸¸ç›¸ä¼¼çš„è¯­ä¹‰ï¼Œé€šè¿‡å°†è¿™äº›ç±»ä¼¼çš„ API èåˆåˆ°æ ‡å‡†æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ˜¾è‘—é™ä½å¤æ‚æ€§å¹¶æé«˜ä¸€è‡´æ€§ã€‚ä»¥ Google APIs ä¸ºä¾‹ï¼Œè¶…è¿‡ 70% æ˜¯æ ‡å‡†æ–¹æ³•ï¼Œè¿™è®©å®ƒä»¬æ›´åŠ æ˜“äºå­¦ä¹ å’Œä½¿ç”¨ã€‚ ä¸‹è¡¨æè¿°äº†å¦‚ä½•å°†å®ƒä»¬æ˜ å°„ä¸º REST æ–¹æ³•ï¼Œä¹Ÿç§°ä¸º CRUD æ–¹æ³•ï¼š æ–¹æ³• HTTP æ˜ å°„ HTTP è¯·æ±‚ä½“ HTTP å“åº”ä½“ List GET &lt;é›†åˆ URL&gt; ç©º èµ„æº[1]åˆ—è¡¨ Get GET &lt;èµ„æº URL&gt; ç©º èµ„æº[1] Create POST &lt;é›†åˆ URL&gt; èµ„æº èµ„æº[1] Update PUT æˆ– PATCH &lt;èµ„æº URL&gt; èµ„æº èµ„æº[1] Delete DELETE &lt;èµ„æº URL&gt; ç©º ç©º[2] [1] Listã€Getã€Create å’Œ Updateæ–¹æ³•æ”¯æŒå­—æ®µæ©ç æ—¶ï¼Œè¿”å›çš„èµ„æº å¯èƒ½ï¼ˆmayï¼‰ åªåŒ…å«éƒ¨åˆ†æ•°æ®ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒAPI å¹³å°ä¼šå¯¹æ‰€æœ‰æ–¹æ³•åŸç”Ÿæ”¯æŒå­—æ®µæ©ç ã€‚ [2] ä¸ç«‹å³åˆ é™¤èµ„æºï¼ˆæ¯”å¦‚é€šè¿‡æ›´æ–°æ ‡å¿—ä½æˆ–ä¼šæ‰§è¡Œæ—¶é—´è¾ƒé•¿çš„åˆ é™¤æ“ä½œï¼‰çš„ Delete æ–¹æ³•è¿”å›çš„å“åº” åº”è¯¥ï¼ˆshouldï¼‰ åŒ…å«é•¿æ—¶é—´è¿è¡Œçš„æ“ä½œæˆ–è¢«ä¿®æ”¹çš„èµ„æºã€‚ æ ‡å‡†æ–¹æ³•ä¹Ÿ å¯ä»¥ï¼ˆmayï¼‰ ä¸ºä¸èƒ½åœ¨ä¸€ä¸ª API è°ƒç”¨å‘¨æœŸå®Œæˆçš„è¯·æ±‚è¿”å›é•¿æœŸè¿è¡Œçš„æ“ä½œã€‚ ä¸‹é¢ç« èŠ‚è¯¦ç»†æè¿°äº†æ¯ä¸€ä¸ªæ ‡å‡†æ–¹æ³•ã€‚è¿™äº›ä¾‹å­å±•ç¤ºäº†åœ¨ .proto æ–‡ä»¶ä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œå…¶ä¸­åŒ…å«ç”¨äº HTTP æ˜ å°„çš„ç‰¹æ®Šæ³¨é‡Šã€‚ä½ å¯ä»¥åœ¨ Google APIs é¡¹ç›®ä¸­æ‰¾åˆ°è®¸å¤šä½¿ç”¨æ ‡å‡†æ–¹æ³•çš„ä¾‹å­ã€‚ List List æ–¹æ³•æ¥æ”¶èµ„æºåå’Œé›¶ä¸ªæˆ–å¤šä¸ªå…¶å®ƒå‚æ•°åšä¸ºè¾“å…¥ï¼Œè¿”å›ç¬¦åˆè¾“å…¥çš„èµ„æºåˆ—è¡¨ã€‚å®ƒä¹Ÿé€šå¸¸è¢«ç”¨æ¥æœç´¢èµ„æºã€‚ List é€‚åˆå–å¾—æ²¡æœ‰ç¼“å­˜ä¸”å¤§å°æœ‰é™çš„æ¥è‡ªå•ä¸ªé›†åˆçš„æ•°æ®ã€‚å¯¹äºæ›´å¹¿æ³›çš„æƒ…å†µï¼Œåº”è¯¥ï¼ˆshouldï¼‰ ä½¿ç”¨è‡ªå®šä¹‰æ–¹æ³•ã€‚ åº”è¯¥ä½¿ç”¨è‡ªå®šä¹‰çš„ BatchGet æ–¹æ³•æ¥å®ç°æ‰¹é‡è·å–ï¼ˆä¾‹å¦‚æ¥æ”¶å¤šä¸ªèµ„æº IDç„¶åè¿”å›å¯¹åº”çš„èµ„æºï¼‰ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ Listã€‚ä½†å¦‚æœå·²å­˜åœ¨èƒ½å¤Ÿæä¾›åŒæ ·åŠŸèƒ½çš„ List æ–¹æ³•ï¼Œä½  å¯ä»¥ï¼ˆmayï¼‰ ä¸ºæ­¤ç›®çš„é‡ç”¨ List æ–¹æ³•ã€‚å¦‚æœä½ åœ¨ä½¿ç”¨è‡ªå®šä¹‰çš„ BatchGet æ–¹æ³•ï¼Œåº”è¯¥ï¼ˆshouldï¼‰ å°†å®ƒæ˜ å°„æˆ HTTP GETã€‚ é€‚ç”¨çš„å¸¸è§æ¨¡å¼ï¼šåˆ†é¡µã€ç»“æœæ’åº é€‚ç”¨çš„å‘½åçº¦å®šï¼šè¿‡æ»¤å­—æ®µã€ç»“æœå­—æ®µ HTTP æ˜ å°„ï¼š List æ–¹æ³• å¿…é¡»ï¼ˆmustï¼‰ ä½¿ç”¨ HTTP GET åŠ¨è¯ã€‚ åº”è¯¥ï¼ˆshouldï¼‰ æŠŠè¦åˆ—å‡ºé›†åˆçš„èµ„æºåå­—æ”¾åœ¨ URL path å‚æ•°ä¸­ã€‚å¦‚æœé›†åˆåæ˜ å°„åˆ° URL path ä¸­ï¼ŒURL æ¨¡ç‰ˆçš„æœ€åä¸€æ®µï¼ˆé›†åˆ IDï¼‰ å¿…é¡»ï¼ˆmustï¼‰ æ˜¯å¸¸é‡ã€‚ æ‰€æœ‰å…¶ä»–çš„è¯·æ±‚ä¿¡æ¯å­—æ®µ å¿…é¡»ï¼ˆshallï¼‰ æ˜ å°„åˆ° URL çš„ query å‚æ•°ä¸­ã€‚ æ²¡æœ‰è¯·æ±‚ä½“ï¼ŒAPI é…ç½®ä¸­ä¸€å®šä¸èƒ½ï¼ˆmust notï¼‰ å®šä¹‰ bodyã€‚ å“åº”ä½“ åº”è¯¥ï¼ˆshouldï¼‰ åŒ…å«èµ„æºåˆ—è¡¨å’Œå¯é€‰çš„å…ƒæ•°æ®ã€‚ 123456789101112131415161718192021222324252627// åˆ—å‡ºæŒ‡å®šä¹¦æ¶ä¸Šçš„æ‰€æœ‰å›¾ä¹¦rpc ListBooks(ListBooksRequest) returns (ListBooksResponse) &#123; // List æ–¹æ³•æ˜ å°„ä¸º HTTP GET option (google.api.http) = &#123; // `parent` è·å–çˆ¶èµ„æºåï¼Œä¾‹å¦‚ &quot;shelves/shelf1&quot; get: &quot;/v1/&#123;parent=shelves/*&#125;/books&quot; &#125;;&#125;message ListBooksRequest &#123; // çˆ¶èµ„æºåç§°ï¼Œä¾‹å¦‚ &quot;shelves/shelf1&quot;. string parent = 1; // è¿”å›å€¼çš„æœ€å¤§æ¡æ•° int32 page_size = 2; // ä»ä¸Šä¸€ä¸ª List è¯·æ±‚è¿”å›çš„ next_page_token å€¼ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ string page_token = 3;&#125;message ListBooksResponse &#123; // å­—æ®µååº”è¯¥åŒ¹é…æ–¹æ³•åä¸­çš„åè¯ &quot;books&quot;ï¼Œæ ¹æ®è¯·æ±‚ä¸­çš„ page_size å­—æ®µï¼Œå°†ä¼šè¿”å›æœ€å¤§æ•°é‡çš„æ¡ç›® repeated Book books = 1; // ç”¨äºå–å¾—ä¸‹ä¸€é¡µç»“æœçš„å€¼ï¼Œæ²¡æœ‰æ—¶ä¸ºç©º string next_page_token = 2;&#125; Get GET æ–¹æ³•æ¥æ”¶èµ„æºåï¼Œé›¶ä¸ªæˆ–å¤šä¸ªå‚æ•°ï¼Œè¿”å›æŒ‡å®šçš„èµ„æºã€‚ HTTP æ˜ å°„ï¼š Get æ–¹æ³• å¿…é¡»ï¼ˆmustï¼‰ ä½¿ç”¨ HTTP GET åŠ¨è¯ã€‚ è¡¨ç¤ºèµ„æºåçš„è¯·æ±‚ä¿¡æ¯å­—æ®µ åº”è¯¥ï¼ˆshouldï¼‰ æ˜ å°„åˆ° URL path å‚æ•°ä¸­ã€‚ æ‰€æœ‰å…¶ä»–çš„è¯·æ±‚ä¿¡æ¯å­—æ®µ å¿…é¡»ï¼ˆshallï¼‰ æ˜ å°„åˆ° URL çš„ query å‚æ•°ä¸­ã€‚ æ²¡æœ‰è¯·æ±‚ä½“ï¼ŒAPI é…ç½®ä¸­ä¸€å®šä¸èƒ½ï¼ˆmust notï¼‰ å®šä¹‰ bodyã€‚ è¿”å›çš„èµ„æº å¿…é¡»ï¼ˆshallï¼‰ å¡«å……æ•´ä¸ªå“åº”ä½“ã€‚ 12345678910111213// å–å¾—æŒ‡å®šçš„ bookrpc GetBook(GetBookRequest) returns (Book) &#123; // Get æ˜ å°„ä¸º HTTP GETã€‚èµ„æºåæ˜ å°„åˆ° URL ä¸­ã€‚æ²¡æœ‰è¯·æ±‚ä½“ option (google.api.http) = &#123; // æ³¨æ„ URL ä¸­ç”¨äºè·å–èµ„æºåçš„æ¨¡æ¿å˜é‡ï¼Œä¾‹å¦‚ &quot;shelves/shelf1/books/book2&quot; get: &quot;/v1/&#123;name=shelves/*/books/*&#125;&quot; &#125;;&#125;message GetBookRequest &#123; // æ­¤å­—æ®µåŒ…å«è¢«è¯·æ±‚èµ„æºçš„åå­—ï¼Œä¾‹å¦‚ï¼š&quot;shelves/shelf1/books/book2&quot; string name = 1;&#125; Create Create æ–¹æ³•æ¥æ”¶ä¸€ä¸ªé›†åˆåã€é›¶ä¸ªæˆ–å¤šä¸ªå‚æ•°ï¼Œåœ¨æŒ‡å®šé›†åˆä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„èµ„æºå¹¶å°†å…¶è¿”å›ã€‚ å¦‚æœ API æ”¯æŒåˆ›å»ºèµ„æºï¼Œå®ƒ åº”è¯¥ï¼ˆshouldï¼‰ åœ¨æ‰€æœ‰å¯è¢«åˆ›å»ºçš„èµ„æºä¸Šå…·æœ‰ Create æ–¹æ³• ã€‚ HTTP æ˜ å°„ï¼š Create æ–¹æ³• å¿…é¡»ï¼ˆmustï¼‰ ä½¿ç”¨ HTTP POST åŠ¨è¯ã€‚ è¯·æ±‚æ¶ˆæ¯ä¸­ åº”è¯¥ï¼ˆshouldï¼‰ å«æœ‰åä¸º parent çš„å­—æ®µæ¥æ¥æ”¶æ–°å»ºèµ„æºçš„çˆ¶èµ„æºåã€‚ æ‰€æœ‰å…¶ä»–çš„è¯·æ±‚ä¿¡æ¯å­—æ®µ å¿…é¡»ï¼ˆshallï¼‰ æ˜ å°„åˆ° URL çš„ query å‚æ•°ä¸­ã€‚ è¯·æ±‚ å¯ä»¥ï¼ˆmayï¼‰ åŒ…å«åä¸º &lt;resource&gt;_id çš„å­—æ®µåæ¥å…è®¸è°ƒç”¨è€…é€‰æ‹©ä¸€ä¸ªå®¢æˆ·ç«¯åˆ†é…çš„ IDã€‚è¿™ä¸ªå­—æ®µ å¿…é¡»ï¼ˆmustï¼‰ æ˜ å°„åˆ° URL query å‚æ•°ä¸­ã€‚ åŒ…å«èµ„æºçš„è¯·æ±‚ä¿¡æ¯å­—æ®µ åº”è¯¥ï¼ˆshouldï¼‰ æ˜ å°„åˆ°è¯·æ±‚ä½“ä¸­ã€‚å¦‚æœ Create æ–¹æ³•ä½¿ç”¨äº† HTTP é…ç½®ä¸­çš„ body å­—æ®µï¼Œé‚£ä¹ˆ å¿…é¡»ï¼ˆmustï¼‰ ä½¿ç”¨ body: &quot;&lt;resource_field&gt;&quot; è¿™ç§æ ¼å¼ã€‚ è¿”å›çš„èµ„æº å¿…é¡»ï¼ˆshallï¼‰ å¡«å……åˆ°æ•´ä¸ªå“åº”ä½“ã€‚ å¦‚æœ Create æ–¹æ³•æ”¯æŒå®¢æˆ·ç«¯æŒ‡å®šèµ„æºåï¼Œå½“èµ„æºåå·²å­˜åœ¨æ—¶è¯·æ±‚ åº”è¯¥ï¼ˆshouldï¼‰ å¤±è´¥ï¼ˆæ¨èï¼ˆrecommendedï¼‰ ä½¿ç”¨ google.rpc.Code.ALREADY_EXISTSï¼‰æˆ–è€…æœåŠ¡ç«¯åˆ†é…å¦å¤–çš„åå­—ï¼Œå¹¶ä¸”æ–‡æ¡£ä¸­åº”è¯¥æ˜ç¡®æŒ‡å‡ºåˆ›å»ºçš„èµ„æºåå¯èƒ½ä¼šä¸ä¼ å…¥çš„åå­—ä¸åŒã€‚ 12345678910111213141516171819202122232425262728293031rpc CreateBook(CreateBookRequest) returns (Book) &#123; // Create æ˜ å°„ä¸º HTTP POSTï¼ŒURL path åšä¸ºé›†åˆåç§° // HTTP è¯·æ±‚ä½“ä¸­åŒ…å«èµ„æº option (google.api.http) = &#123; // é€šè¿‡ `parent` è·å–çˆ¶èµ„æºåï¼Œä¾‹å¦‚ &quot;shelves/1&quot; post: &quot;/v1/&#123;parent=shelves/*&#125;/books&quot; body: &quot;book&quot; &#125;;&#125;message CreateBookRequest &#123; // å°†è¢«åˆ›å»ºçš„ book çš„çˆ¶èµ„æºå string parent = 1; // book ä½¿ç”¨çš„ ID string book_id = 3; // èµ„æº book å°†è¢«åˆ›å»ºï¼Œå­—æ®µååº”è¯¥ä¸æ–¹æ³•åä¸­çš„åè¯ç›¸åŒ¹é… Book book = 2;&#125;rpc CreateShelf(CreateShelfRequest) returns (Shelf) &#123; option (google.api.http) = &#123; post: &quot;/v1/shelves&quot; body: &quot;shelf&quot; &#125;;&#125;message CreateShelfRequest &#123; Shelf shelf = 1;&#125; Update Update æ–¹æ³•æ¥æ”¶åŒ…å«èµ„æºå’Œé›¶ä¸ªæˆ–å¤šä¸ªå‚æ•°çš„è¯·æ±‚ï¼Œæ›´æ–°æŒ‡å®šçš„èµ„æºå’Œå±æ€§å¹¶è¿”å›æ›´æ–°åçš„èµ„æºã€‚ å¯ä¿®æ”¹çš„èµ„æºå±æ€§ åº”è¯¥ï¼ˆshouldï¼‰ ä½¿ç”¨ Update æ–¹æ³•æ¥æ›´æ–°ï¼Œé™¤éå±æ€§ä¸­åŒ…å«èµ„æºåæˆ–çˆ¶èµ„æºã€‚ä»»ä½•é‡å‘½åæˆ–ç§»åŠ¨èµ„æºçš„æ“ä½œ ä¸€å®šä¸è¦ï¼ˆmust notï¼‰ é€šè¿‡ Update æ‰§è¡Œï¼Œå¿…é¡»ï¼ˆshallï¼‰ é€šè¿‡è‡ªå®šä¹‰æ–¹æ³•å¤„ç†ã€‚ HTTP æ˜ å°„ï¼š æ ‡å‡†çš„ Update æ–¹æ³• åº”è¯¥ï¼ˆshouldï¼‰ æ”¯æŒèµ„æºçš„éƒ¨åˆ†æ›´æ–°ï¼Œä½¿ç”¨å¸¦æœ‰åä¸º update_mask çš„ FieldMask å­—æ®µçš„ HTTP åŠ¨è¯ PATCH æ¥æ‰§è¡Œæ“ä½œã€‚ åº”è¯¥ï¼ˆshouldï¼‰ ä½¿ç”¨è‡ªå®šä¹‰æ–¹æ³•æ¥å®ç°æ›´é«˜çº§çš„ Update æ–¹æ³•ï¼Œä¾‹å¦‚è¿½åŠ é‡å¤çš„å­—æ®µã€‚ å¦‚æœ Update æ–¹æ³•ä»…æ”¯æŒèµ„æºçš„å®Œæ•´æ›´æ–°ï¼Œåˆ™ å¿…é¡»ï¼ˆmustï¼‰ ä½¿ç”¨ HTTP åŠ¨è¯ PUTå®ç°ã€‚ç„¶è€Œå¹¶ä¸é¼“åŠ±è¿™æ ·åšï¼Œå› ä¸ºå½“æ·»åŠ æ–°çš„èµ„æºå­—æ®µæ—¶ä¼šæœ‰åå‘å…¼å®¹çš„é—®é¢˜ã€‚ è¢«ä¿®æ”¹èµ„æºçš„åç§°å­—æ®µ å¿…é¡»ï¼ˆmustï¼‰ æ˜ å°„åˆ° URL path å‚æ•°ä¸­ã€‚æ­¤å­—æ®µä¹Ÿ å¯ä»¥ï¼ˆmayï¼‰ åŠ åœ¨èµ„æºä¿¡æ¯ä¸­ã€‚ åŒ…å«èµ„æºçš„è¯·æ±‚ä¿¡æ¯ å¿…é¡»ï¼ˆmustï¼‰ æ˜ å°„åˆ°è¯·æ±‚ä½“ä¸­ã€‚ æ‰€æœ‰å…¶ä»–è¯·æ±‚ä¿¡æ¯ å¿…é¡»ï¼ˆmustï¼‰ æ˜ å°„åˆ° URL query å‚æ•°ä¸­ã€‚ è¿”å›å“åº”ä¸­çš„èµ„æºä¿¡æ¯ å¿…é¡»ï¼ˆmustï¼‰ æ˜¯è¢«ä¿®æ”¹çš„èµ„æºã€‚ å¦‚æœ API æ¥æ”¶å®¢æˆ·ç«¯åˆ†é…çš„èµ„æºåï¼Œé‚£ä¹ˆæœåŠ¡ç«¯ å¯ä»¥ï¼ˆmayï¼‰ å…è®¸å®¢æˆ·ç«¯æŒ‡å®šä¸€ä¸ªä¸å­˜åœ¨çš„èµ„æºåæ¥åˆ›å»ºæ–°çš„èµ„æºã€‚å¦åˆ™ï¼ŒUpdate æ–¹æ³•åº”è¯¥ï¼ˆshouldï¼‰ å› ä¸ºä¸å­˜åœ¨çš„èµ„æºåè€Œå¤±è´¥ã€‚å½“èµ„æºåä¸å­˜åœ¨æ˜¯å”¯ä¸€é”™è¯¯æ—¶ï¼Œåº”è¯¥ï¼ˆshouldï¼‰ ä½¿ç”¨é”™è¯¯ç  NOT_FOUNDã€‚ å³ä½¿ API çš„ Update æ–¹æ³•èƒ½å¤Ÿæ–°å»ºèµ„æºï¼Œå®ƒä¹Ÿ åº”è¯¥ï¼ˆshouldï¼‰ æä¾› Create æ–¹æ³•ã€‚è¿™æ˜¯å› ä¸ºåªæœ‰ Update æ–¹æ³•èƒ½å¤Ÿæ–°å»ºèµ„æºä¼šè®©äººè¿·æƒ‘ã€‚ 123456789101112131415161718rpc UpdateBook(UpdateBookRequest) returns (Book) &#123; // Update æ˜ å°„ä¸º HTTP PATCHã€‚èµ„æºåæ˜ å°„åˆ° URL path å‚æ•°ä¸­ // èµ„æºåŒ…å«åœ¨ HTTP è¯·æ±‚ä½“ä¸­ option (google.api.http) = &#123; // æ³¨æ„ç”¨äºè·å–å¾…æ›´æ–° book çš„èµ„æºåçš„ URL æ¨¡ç‰ˆå˜é‡ patch: &quot;/v1/&#123;book.name=shelves/*/books/*&#125;&quot; body: &quot;book&quot; &#125;;&#125;message UpdateBookRequest &#123; // æ›¿æ¢æœåŠ¡ç«¯ä¸Šçš„ book èµ„æº Book book = 1; // ç”¨äºèµ„æºæ›´æ–°çš„æ©ç  // `FieldMask` çš„å®šä¹‰è¯·å‚è€ƒ https://developers.google.com/protocol-buffers/docs/reference/google.protobuf#fieldmask FieldMask update_mask = 2;&#125; Delete Delete æ–¹æ³•æ¥æ”¶èµ„æºåå’Œé›¶ä¸ªæˆ–å¤šä¸ªå‚æ•°ï¼Œç„¶ååˆ é™¤æˆ–å‡†å¤‡åˆ é™¤æŒ‡å®šèµ„æºã€‚Delete æ–¹æ³• åº”è¯¥ï¼ˆshouldï¼‰ è¿”å› google.protobuf.Emptyã€‚ æ³¨æ„ï¼ŒAPI ä¸åº”è¯¥ï¼ˆshould notï¼‰ ä¾èµ– Delete æ–¹æ³•è¿”å›çš„ä»»ä½•ä¿¡æ¯ï¼Œå› ä¸ºå®ƒä¸èƒ½é‡å¤è°ƒç”¨ã€‚ HTTP æ˜ å°„ï¼š Delete æ–¹æ³• å¿…é¡»ï¼ˆmustï¼‰ ä½¿ç”¨ HTTP DELETE åŠ¨è¯ è¡¨ç¤ºèµ„æºåçš„è¯·æ±‚ä¿¡æ¯å­—æ®µ åº”è¯¥ï¼ˆshouldï¼‰ æ˜ å°„åˆ° URL path å‚æ•°ä¸­ æ‰€æœ‰å…¶ä»–çš„è¯·æ±‚ä¿¡æ¯å­—æ®µ å¿…é¡»ï¼ˆshallï¼‰ æ˜ å°„åˆ° URL çš„ query å‚æ•°ä¸­ æ²¡æœ‰è¯·æ±‚ä½“ï¼ŒAPI é…ç½® ä¸€å®šä¸è¦ï¼ˆmust notï¼‰ å®šä¹‰ body Delete æ–¹æ³•ç›´æ¥åˆ é™¤èµ„æºæ—¶ï¼Œåº”è¯¥ï¼ˆshouldï¼‰ è¿”å›ç©ºçš„å“åº” Delete æ–¹æ³•åˆå§‹åŒ–ä¸€ä¸ªé•¿æ—¶é—´çš„æ“ä½œæ—¶ï¼Œåº”è¯¥ï¼ˆshouldï¼‰ è¿”å›è¿™ä¸ªæ“ä½œ Delete æ–¹æ³•å°†èµ„æºæ ‡è®°ä¸ºè¢«åˆ é™¤æ—¶ï¼Œåº”è¯¥ï¼ˆshouldï¼‰ è¿”å›æ›´æ–°åçš„èµ„æº Delete æ–¹æ³•çš„è°ƒç”¨åœ¨æ•ˆæœä¸Šåº”è¯¥æ˜¯å¹‚ç­‰çš„ï¼Œä½†å¹¶ä¸éœ€è¦æœ‰ç›¸åŒçš„è¿”å›å€¼ã€‚ä»»æ„æ¬¡ Delete è¯·æ±‚çš„ç»“æœ åº”è¯¥ï¼ˆshouldï¼‰ æ˜¯èµ„æºè¢«åˆ é™¤ï¼Œä½†åªæœ‰ç¬¬ä¸€æ¬¡è¯·æ±‚åº”è¯¥è¿”å›æ­£ç¡®ï¼Œåç»­çš„è¯·æ±‚åº”è¯¥è¿”å› google.rpc.Code.NOT_FOUNDã€‚ 12345678910111213rpc DeleteBook(DeleteBookRequest) returns (google.protobuf.Empty) &#123; // Delete æ˜ å°„ä¸º HTTP DELETEã€‚èµ„æºåæ˜ å°„åˆ° URL path å‚æ•°ä¸­ // æ²¡æœ‰è¯·æ±‚ä½“ option (google.api.http) = &#123; // æ³¨æ„ URL æ¨¡æ¿å˜é‡è·å–å¾…åˆ é™¤èµ„æºçš„åç§°ï¼Œä¾‹å¦‚ &quot;shelves/shelf1/books/book2&quot; delete: &quot;/v1/&#123;name=shelves/*/books/*&#125;&quot; &#125;;&#125;message DeleteBookRequest &#123; // å¾…åˆ é™¤çš„èµ„æºåç§°ï¼Œä¾‹å¦‚ &quot;shelves/shelf1/books/book2&quot; string name = 1;&#125; æŸ¥çœ‹å…¶ä»–ç« èŠ‚]]></content>
      <tags>
        <tag>æ¶æ„</tag>
        <tag>ç¿»è¯‘</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Google API è®¾è®¡æŒ‡å—ï¼èµ„æºåç§°]]></title>
    <url>%2F2017%2F03%2Fgoogle-api-design-guide%2Fresource-names%2F</url>
    <content type="text"><![CDATA[ç¿»è¯‘è‡ª API Design Guide - Resource Names åœ¨é¢å‘èµ„æºçš„ API ä¸­ï¼Œèµ„æºæ˜¯å‘½åå®ä½“ï¼Œèµ„æºåç§°æ˜¯å…¶æ ‡è¯†ç¬¦ã€‚æ¯ä¸ªèµ„æº å¿…é¡»ï¼ˆ MUST ï¼‰ æœ‰å”¯ä¸€çš„èµ„æºåç§°ã€‚èµ„æºåç§°ç”±èµ„æºè‡ªå·±çš„ IDï¼Œä»»ä¸€çˆ¶èµ„æºçš„ ID åŠå…¶ API æœåŠ¡åç§°ç»„æˆã€‚ä¸‹é¢æˆ‘ä»¬å°†çœ‹ä¸€çœ‹èµ„æº ID å’Œèµ„æºåæ˜¯å¦‚ä½•æ„æˆçš„ã€‚ gRPC API åº”è¯¥ä¸ºèµ„æºåä½¿ç”¨æ— åè®®ï¼ˆscheme-lessï¼‰çš„ URIã€‚å®ƒä»¬é€šå¸¸éµå¾ª REST URL æƒ¯ä¾‹å¹¶ä¸”å…¶è¡Œä¸ºä¸ç½‘ç»œæ–‡ä»¶è·¯å¾„éå¸¸ç›¸ä¼¼ã€‚å®ƒä»¬èƒ½éå¸¸å®¹æ˜“åœ°æ˜ å°„åˆ° REST APIï¼šè¯¦ç»†å†…å®¹æŸ¥çœ‹æ ‡å‡†æ–¹æ³•ã€‚ é›†åˆæ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„èµ„æºï¼Œå®ƒåŒ…å«äº†ç›¸åŒç±»å‹å­èµ„æºçš„åˆ—è¡¨ã€‚ä¾‹å¦‚ï¼Œç›®å½•æ˜¯æ–‡ä»¶èµ„æºçš„é›†åˆã€‚é›†åˆçš„èµ„æº ID å«åšé›†åˆ IDã€‚ èµ„æºåç§°ç”±é›†åˆ ID å’Œèµ„æº ID æŒ‰å±‚æ¬¡ç»„ç»‡å½¢æˆï¼Œå¹¶ä»¥æ–œæ ï¼ˆ/ï¼‰åˆ†éš”ã€‚å¦‚æœèµ„æºåŒ…å«å­èµ„æºï¼Œå­èµ„æºåç§°çš„æ ¼å¼æ˜¯çˆ¶èµ„æºåç§°åé¢åŠ ä¸Šå­èµ„æº IDï¼ŒåŒæ ·åœ°ä½¿ç”¨æ–œæ åˆ†éš”ã€‚ ä¾‹ 1ï¼šä¸€ä¸ªå­˜å‚¨æœåŠ¡å…·æœ‰ buckets é›†åˆï¼Œæ¯ä¸ª bucket å…·æœ‰ objects é›†åˆï¼š API æœåŠ¡å é›†åˆ ID èµ„æº ID é›†åˆ ID èµ„æº ID //storage.googleapis.com /buckets /bucket-id /objects /object-id ä¾‹ 2ï¼šä¸€ä¸ªå…·æœ‰ users é›†åˆçš„é‚®ä»¶æœåŠ¡ï¼Œæ¯ä¸ªç”¨æˆ·å…·æœ‰ settings å­èµ„æºï¼Œ settings å­èµ„æºå…·æœ‰ customFrom å’Œå¦å¤–çš„å­èµ„æºï¼š API æœåŠ¡å é›†åˆ ID èµ„æº ID èµ„æº ID èµ„æº ID //mail.googleapis.com /users /name@example.com /settings /customFrom API è®¾è®¡è€…å¯ä»¥ä¸ºèµ„æºå’Œé›†åˆ ID é€‰æ‹©ä»»ä½•å¯æ¥å—çš„å€¼ï¼Œåªè¦å®ƒä»¬åœ¨èµ„æºå±‚æ¬¡ç»“æ„ä¸­æ˜¯å”¯ä¸€çš„å³å¯ã€‚ä½ å¯ä»¥åœ¨ä¸‹é¢æ‰¾åˆ°æœ‰å…³é€‰æ‹©é€‚å½“èµ„æºå’Œé›†åˆ ID çš„æ›´å¤šæŒ‡å—ã€‚ å®Œæ•´èµ„æºå æ— åè®®ï¼ˆscheme-lessï¼‰ URI ç”±å…¼å®¹ DNS çš„ API æœåŠ¡åå’Œèµ„æºè·¯å¾„ç»„æˆã€‚èµ„æºè·¯å¾„ä¹Ÿç§°ä¸ºç›¸å¯¹èµ„æºåã€‚ä¾‹å¦‚ï¼š 1&quot;//library.googleapis.com/shelves/shelf1/books/book2&quot; API æœåŠ¡åç”¨äºå®¢æˆ·ç«¯å®šä½ API æœåŠ¡ç«¯ç‚¹ï¼Œå¦‚æœåªä¸ºå†…éƒ¨æœåŠ¡ï¼Œå®ƒ**å¯ä»¥ï¼ˆmayï¼‰**æ˜¯å‡çš„ DNS åã€‚å¦‚æœ API æœåŠ¡ååœ¨ä¸Šä¸‹æ–‡ä¸­æ˜¾è€Œæ˜“è§çš„è¯åˆ™ä¼šç»å¸¸ä½¿ç”¨ç›¸å¯¹èµ„æºåã€‚ ç›¸å¯¹èµ„æºå æ²¡æœ‰æ–œæ ï¼ˆ/ï¼‰å¼€å¤´çš„ URI è·¯å¾„æ ‡è¯†äº† API æœåŠ¡ä¸­çš„èµ„æºã€‚ä¾‹å¦‚ï¼š 1&quot;shelves/shelf1/books/book2&quot; èµ„æº ID ä½¿ç”¨éç©ºçš„ URI æ®µæ ‡è¯†å…¶çˆ¶èµ„æºä¸­çš„èµ„æºã€‚è¯·çœ‹ä¸Šé¢çš„ä¾‹å­ã€‚ èµ„æºåç§°åé¢è·Ÿéšçš„èµ„æº ID å¯ä»¥ï¼ˆmayï¼‰ å…·æœ‰ä¸åªä¸€ä¸ª URI æ®µï¼Œä¾‹å¦‚ï¼š é›†åˆ ID èµ„æº ID files /source/py/parser.py å¦‚æœå¯ä»¥çš„è¯ï¼ŒAPI æœåŠ¡**åº”è¯¥ï¼ˆshouldï¼‰**ä½¿ç”¨ URL å‹å¥½çš„èµ„æº IDã€‚èµ„æº ID å¿…é¡»ï¼ˆmustï¼‰ æ˜ç¡®åœ°è®°å½•åœ¨æ–‡æ¡£ä¸­ï¼Œä¸ç®¡å®ƒä»¬æ˜¯ç”±å®¢æˆ·ç«¯è¿˜æ˜¯æœåŠ¡ç«¯åˆ†é…çš„ã€‚ä¾‹å¦‚ï¼Œæ–‡ä»¶åä¸€èˆ¬ç”±å®¢æˆ·ç«¯åˆ†é…ï¼Œè€Œé‚®ä»¶ä¿¡æ¯ ID ä¸€èˆ¬ç”±æœåŠ¡ç«¯åˆ†é…ã€‚ é›†åˆ ID ä½¿ç”¨éç©ºçš„ URI æ®µæ ‡è¯†å…¶çˆ¶èµ„æºä¸­çš„èµ„æºé›†åˆã€‚è¯·çœ‹ä¸Šé¢çš„ä¾‹å­ã€‚ å› ä¸ºé›†åˆ ID ç»å¸¸å‡ºç°åœ¨ç”Ÿæˆçš„å®¢æˆ·ç«¯åº“ä¸­ï¼Œå®ƒä»¬ å¿…é¡»ï¼ˆmustï¼‰ ç¬¦åˆä»¥ä¸‹è¦æ±‚ï¼š å¿…é¡»ï¼ˆmustï¼‰ æ˜¯åˆæ³•çš„ C/C++ æ ‡è¯†ç¬¦ å¿…é¡»ï¼ˆmustï¼‰ æ˜¯å¤æ•°å½¢å¼çš„é¦–å­—æ¯å°å†™çš„é©¼å³°å‘½å å¿…é¡»ï¼ˆmustï¼‰ ä½¿ç”¨æ¸…æ™°ç®€æ˜çš„è‹±è¯­è¯æ±‡ åº”è¯¥ï¼ˆshouldï¼‰ é¿å…æˆ–é™å®šè¿‡äºç¬¼ç»Ÿçš„æœ¯è¯­ã€‚ä¾‹å¦‚ï¼šRowValue ä¼˜äº Valueã€‚é™¤éæ˜ç¡®å®šä¹‰ï¼Œå¦åˆ™ åº”è¯¥ï¼ˆshouldï¼‰ é¿å…ä½¿ç”¨å¦‚ä¸‹æœ¯è¯­ï¼š Element Entry Instance Item Object Resource Type Value èµ„æºå vs URL å®Œæ•´çš„èµ„æºåç±»ä¼¼æ™®é€šçš„ URLï¼Œä½†å®ƒä»¬å¹¶ä¸ç›¸åŒã€‚åŒæ ·çš„èµ„æºèƒ½å¤Ÿé€šè¿‡ä¸åŒç‰ˆæœ¬æˆ–ä¸åŒåè®®çš„ API æ¥æš´éœ²å‡ºå»ã€‚å®Œæ•´çš„èµ„æºåå¹¶æ²¡æœ‰æŒ‡å®šè¿™äº›ä¿¡æ¯ï¼Œæ‰€ä»¥å¿…é¡»å°†å®ƒæ˜ å°„åˆ°ç‰¹å®šçš„åè®®å’Œ API ç‰ˆæœ¬ä¸Šæ‰èƒ½ç›´æ¥åœ°ä½¿ç”¨ã€‚ ä¸ºäº†é€šè¿‡ REST API ä½¿ç”¨å®Œæ•´çš„èµ„æºåï¼Œå¿…é¡»ï¼ˆmustï¼‰ ä½¿ç”¨å¦‚ä¸‹æ–¹æ³•å°†å…¶æ˜ å°„ä¸º REST URLï¼šåœ¨æœåŠ¡åå‰æ·»åŠ  HTTPS åè®®ã€åœ¨èµ„æºè·¯å¾„å‰æ·»åŠ  API ä¸»ç‰ˆæœ¬å·ã€å°†èµ„æºè·¯å¾„è¿›è¡Œ URL è½¬ä¹‰ã€‚ä¾‹å¦‚ï¼š 12345// è¿™æ˜¯æ—¥å†äº‹ä»¶çš„èµ„æºå&quot;//calendar.googleapis.com/users/john smith/events/123&quot;// è¿™æ˜¯å¯¹åº”çš„ HTTP URL&quot;https://calendar.googleapis.com/v3/users/john%20smith/events/123&quot; èµ„æºååšä¸ºå­—ç¬¦ä¸² é™¤éæœ‰å‘åå…¼å®¹çš„é—®é¢˜ï¼ŒGoogle API å¿…é¡»ï¼ˆmustï¼‰ ä½¿ç”¨å­—ç¬¦ä¸²æ¥è¡¨ç¤ºèµ„æºåã€‚èµ„æºå åº”è¯¥(should) åƒæ™®é€šæ–‡ä»¶è·¯å¾„é‚£æ ·å¤„ç†ï¼Œå¹¶ä¸”ä¸æ”¯æŒç™¾åˆ†å·ç¼–ç ã€‚ å¯¹äºèµ„æºå®šä¹‰ï¼Œç¬¬ä¸€ä¸ªå­—æ®µ åº”è¯¥ï¼ˆshouldï¼‰ æ˜¯èµ„æºåç§°çš„å­—ç¬¦ä¸²å­—æ®µï¼Œå®ƒ åº”è¯¥ï¼ˆshouldï¼‰ å«ä½œ nameã€‚ æ³¨æ„ï¼šåƒ display_nameã€first_nameã€last_nameã€full_name è¿™ç§ä¸åå­—ç›¸å…³çš„å­—æ®µ åº”è¯¥ï¼ˆshouldï¼‰ ç»™å‡ºå®šä¹‰æ¥é¿å…æ··ä¹±ã€‚ ä¾‹å­ï¼š 12345678910111213141516171819202122232425262728293031323334service LibraryService &#123; rpc GetBook(GetBookRequest) returns (Book) &#123; option (google.api.http) = &#123; get: &quot;/v1/&#123;name=shelves/*/books/*&#125;&quot; &#125;; &#125;; rpc CreateBook(CreateBookRequest) returns (Book) &#123; option (google.api.http) = &#123; post: &quot;/v1/&#123;parent=shelves/*&#125;/books&quot; body: &quot;book&quot; &#125;; &#125;;&#125;message Book &#123; // book çš„èµ„æºåã€‚å¿…é¡»æ˜¯&quot;shelves/*/books/*&quot;çš„æ ¼å¼ // ä¾‹å¦‚ï¼š&quot;shelves/shelf1/books/book2&quot;. string name = 1; // ... å…¶ä»–å±æ€§&#125;message GetBookRequest &#123; // ä¸€ä¸ª book çš„èµ„æºåã€‚ä¾‹å¦‚ï¼š&quot;shelves/shelf1/books/book2&quot; string name = 1;&#125;message CreateBookRequest &#123; // åˆ›å»º book çš„çˆ¶èµ„æºå // ä¾‹å¦‚ï¼š&quot;shelves/shelf1&quot; string parent = 1; // è¢«åˆ›å»ºçš„ book èµ„æºã€‚å®¢æˆ·ç«¯ä¸€å®šä¸èƒ½ï¼ˆmust notï¼‰è®¾ç½® `Book.name` å­—æ®µ Book book = 2;&#125; æç¤ºï¼šä¸ºäº†èµ„æºåç§°çš„ä¸€è‡´æ€§ï¼Œå¼€å§‹çš„æ–œæ  ä¸€å®šä¸èƒ½ï¼ˆmust notï¼‰ è¢« URL æ¨¡ç‰ˆå˜é‡æ•è·ã€‚ä¾‹å¦‚ï¼Œå¿…é¡»ï¼ˆmustï¼‰ ä½¿ç”¨ URL æ¨¡ç‰ˆ &quot;/v1/{name=shelves/*/books/*}&quot; è€Œä¸æ˜¯ &quot;/v1{name=/shelves/*/books/*}&quot;ã€‚ æŸ¥çœ‹å…¶ä»–ç« èŠ‚]]></content>
      <tags>
        <tag>æ¶æ„</tag>
        <tag>ç¿»è¯‘</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Google API è®¾è®¡æŒ‡å—ï¼é¢å‘èµ„æºçš„è®¾è®¡]]></title>
    <url>%2F2017%2F03%2Fgoogle-api-design-guide%2Fresource-oriented-design%2F</url>
    <content type="text"><![CDATA[ç¿»è¯‘è‡ª API Design Guide - Resource Oriented Design è¿™ç¯‡è®¾è®¡æŒ‡å—çš„ç›®çš„æ˜¯å¸®åŠ©å¼€å‘è€…è®¾è®¡å‡ºç®€å•ã€ä¸€è‡´ã€æ˜“äºä½¿ç”¨çš„ç½‘ç»œ APIï¼ŒåŒæ—¶å®ƒä¹Ÿå¸®åŠ©æˆ‘ä»¬ç»Ÿä¸€äº† RPC APIï¼ˆåŸºäº socketï¼‰ä¸ REST APIï¼ˆåŸºäº HTTPï¼‰çš„è®¾è®¡ã€‚ ä¼ ç»Ÿä¸Šï¼Œäººä»¬å‚è€ƒåƒ CORBA å’Œ Windows COM è¿™æ ·çš„ API æ¥å£å’Œæ–¹æ³•æ¥è®¾è®¡ RPC APIã€‚éšç€æ—¶é—´æ¨ç§»ï¼Œè¶Šæ¥è¶Šå¤šçš„æ¥å£å’Œæ–¹æ³•è¢«æ·»åŠ ã€‚æœ€åçš„ç»“æœæ˜¯è¢«æ•°é‡ä¼—å¤šçš„æ¥å£å’Œæ–¹æ³•æ·¹æ²¡ï¼Œæ¯ä¸€ä¸ªéƒ½å’Œå…¶ä»–ä¸åŒã€‚ä¸ºäº†æ­£ç¡®ä½¿ç”¨å®ƒä»¬å¼€å‘è€…å¿…é¡»ä»”ç»†å­¦ä¹ æ¯ä¸€ä¸ªæ¥å£æˆ–æ–¹æ³•ï¼Œè¿™å¿…å®šä¼šæ¶ˆè€—æ—¶é—´å¹¶å®¹æ˜“å¼•å…¥é—®é¢˜ã€‚ REST æ¶æ„é£æ ¼æœ€æ—©å‡ºç°äº2000å¹´ï¼Œä¸»è¦è®¾è®¡ä¸ºä¸ HTTP/1.1 ä¸€èµ·ä½¿ç”¨ã€‚å®ƒçš„ä¸»è¦åŸåˆ™æ˜¯å®šä¹‰èƒ½å¤Ÿè¢«å°‘é‡æ–¹æ³•æ“ä½œçš„å‘½åèµ„æºã€‚èµ„æºå’Œæ–¹æ³•è¢«è®¤ä¸ºæ˜¯ API çš„åè¯å’ŒåŠ¨è¯ã€‚ä¸ HTTP åè®®é…åˆï¼Œèµ„æºåè‡ªç„¶åœ°æ˜ å°„ä¸º URLï¼Œæ–¹æ³•è‡ªç„¶åœ°æ˜ å°„ä¸º HTTP æ–¹æ³• POSTã€GETã€PUTã€PATCH å’Œ DELETEã€‚ HTTP REST API åœ¨äº’è”ç½‘é¢†åŸŸå·²ç»å–å¾—äº†å·¨å¤§æˆåŠŸã€‚åœ¨2010å¹´ï¼Œçº¦ 74% çš„ç½‘ç»œ API æ˜¯ HTTP REST APIã€‚ è™½ç„¶ HTTP REST API åœ¨äº’è”ç½‘ç‰¹åˆ«æµè¡Œï¼Œä½†å®ƒä»¬æ‰¿è½½çš„æµé‡å´æ¯”ä¼ ç»Ÿçš„ RPC API è¦å°‘ã€‚ä¾‹å¦‚ï¼Œåœ¨ç¾å›½é«˜å³°æ—¶æœŸçš„çº¦ä¸€åŠæµé‡æ˜¯è§†é¢‘å†…å®¹ï¼Œä½†å› ä¸ºæ•ˆç‡é—®é¢˜ï¼Œå¾ˆå°‘æœ‰äººä¼šè€ƒè™‘ä½¿ç”¨ REST API æ¥ä¼ è¾“è¿™äº›å†…å®¹ã€‚åœ¨æ•°æ®ä¸­å¿ƒï¼Œè®¸å¤šå…¬å¸ä½¿ç”¨åŸºäº socket çš„ RPC API æ¥ä¼ è¾“å¤§éƒ¨åˆ†ç½‘ç»œæµé‡ï¼Œè¿™ä¼šæ¯” REST API é«˜å‡ºå‡ ä¸ªæ•°é‡çº§ã€‚ å®é™…ä¸Šï¼Œç”±äºç§ç§åŸå›  RPC API å’Œ HTTP REST API éƒ½æ˜¯éœ€è¦çš„ã€‚ç†æƒ³æƒ…å†µä¸‹ä¸€ä¸ª API å¹³å°åº”è¯¥ä¸ºæ‰€æœ‰ API æä¾›æœ€å¥½çš„æ”¯æŒã€‚æ­¤æŒ‡å—å°†ä¼šå¸®åŠ©ä½ è®¾è®¡å¹¶å®ç°ç¬¦åˆè¿™ä¸€åŸåˆ™çš„ APIã€‚å®ƒå°†é¢å‘èµ„æºçš„è®¾è®¡åŸåˆ™åº”ç”¨åˆ°ä¸€èˆ¬çš„ API è®¾è®¡ä¸­ï¼Œå¹¶ä¸”å®šä¹‰äº†è®¸å¤šé€šç”¨çš„è®¾è®¡æ¨¡å¼æ¥æå‡å¯ç”¨æ€§å¹¶é™ä½å¤æ‚æ€§ã€‚ æ³¨æ„ï¼šæ­¤è®¾è®¡æŒ‡å—è§£é‡Šäº†å¦‚ä½•åœ¨ç‹¬ç«‹äºç¼–ç¨‹è¯­è¨€ã€æ“ä½œç³»ç»Ÿæˆ–è€…ç½‘ç»œåè®®çš„ API è®¾è®¡ä¸­åº”ç”¨ REST åŸåˆ™ï¼Œè€Œä¸æ˜¯ä»…ç”¨äºåˆ›å»º REST API çš„æŒ‡å— ä»€ä¹ˆæ˜¯ REST APIï¼Ÿ REST API è¢«å»ºæ¨¡æˆå¯å•ç‹¬å¯»å€çš„èµ„æºï¼ˆAPI çš„åè¯ï¼‰çš„é›†åˆã€‚èµ„æºé€šè¿‡å®ƒä»¬çš„èµ„æºåæ¥å¼•ç”¨ï¼Œé€šè¿‡ä¸€å°ç»„æ–¹æ³•ï¼ˆä¹Ÿè¢«ç§°ä¸ºåŠ¨è¯ï¼‰æ¥æ“ä½œã€‚ REST Google API çš„æ ‡å‡†æ–¹æ³•ï¼ˆä¹Ÿå« REST æ–¹æ³•ï¼‰æ˜¯ List Get Create Update å’Œ Deleteã€‚å½“å­˜åœ¨ç±»ä¼¼æ•°æ®åº“äº‹åŠ¡è¿™ç§ä¸èƒ½è¢«ç®€å•åœ°æ˜ å°„åˆ°æ ‡å‡†æ–¹æ³•çš„éœ€æ±‚æ—¶ï¼ŒAPI è®¾è®¡è€…ä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰æ–¹æ³•ï¼ˆä¹Ÿå«è‡ªå®šä¹‰åŠ¨è¯æˆ–è‡ªå®šä¹‰æ“ä½œï¼‰ã€‚ æ³¨æ„ï¼šè‡ªå®šä¹‰åŠ¨è¯ä¸è¡¨ç¤ºåˆ›é€ è‡ªå®šä¹‰çš„ HTTP åŠ¨è¯æ¥æ”¯æŒè‡ªå®šä¹‰æ–¹æ³•ã€‚å¯¹äºåŸºäº HTTP çš„APIï¼Œç®€å•åœ°æ˜ å°„åˆ°æœ€åˆé€‚çš„ HTTP åŠ¨è¯å³å¯ã€‚ è®¾è®¡æµç¨‹ æ­¤è®¾è®¡æŒ‡å—å»ºè®®é‡‡ç”¨å¦‚ä¸‹æ­¥éª¤æ¥è®¾è®¡é¢å‘èµ„æºçš„ APIï¼ˆæ›´è¯¦ç»†çš„å†…å®¹è¯·å‚è€ƒåé¢çš„å°èŠ‚ï¼‰ ç¡®å®š API æä¾›çš„èµ„æºç±»å‹ ç¡®å®šèµ„æºé—´çš„å…³ç³» ä¾æ®ç±»å‹å’Œå…³ç³»æ¥ç¡®å®šèµ„æºåæ–¹æ¡ˆ ç¡®å®šèµ„æºç»“æ„ ä¸ºèµ„æºæ·»åŠ æœ€å°‘çš„æ–¹æ³•é›† èµ„æº é¢å‘èµ„æºçš„ API é€šå¸¸ä»¥èµ„æºå±‚æ¬¡è¿›è¡Œå»ºæ¨¡ï¼Œæ¯ä¸€ä¸ªèŠ‚ç‚¹æ˜¯ä¸€ä¸ªç®€å•çš„èµ„æºæˆ–èµ„æºé›†åˆã€‚æ–¹ä¾¿èµ·è§ï¼Œé€šå¸¸å°†å®ƒä»¬ç§°ä¸ºèµ„æºå’Œé›†åˆã€‚ é›†åˆåŒ…å«å…·æœ‰ç›¸åŒç±»å‹çš„èµ„æºåˆ—è¡¨ã€‚ä¾‹å¦‚ä¸€ä¸ªç”¨æˆ·æ‹¥æœ‰è”ç³»äººçš„é›†åˆ èµ„æºæ‹¥æœ‰ä¸€äº›çŠ¶æ€å’Œ 0 ä¸ªæˆ–å¤šä¸ªå­èµ„æºã€‚æ¯ä¸€ä¸ªå­èµ„æºå¯ä»¥æ˜¯ç®€å•èµ„æºæˆ–èµ„æºé›†åˆ ä¾‹å¦‚ï¼ŒGmail API æœ‰ç”¨æˆ·çš„é›†åˆï¼Œæ¯ä¸ªç”¨æˆ·æœ‰ä¿¡æ¯çš„é›†åˆã€çº¿ç¨‹çš„é›†åˆã€æ ‡ç­¾çš„é›†åˆã€ä¸€ä¸ªèµ„æ–™èµ„æºå’Œä¸€äº›è®¾ç½®é¡¹èµ„æºã€‚ è™½ç„¶å­˜å‚¨ç³»ç»Ÿå’Œ REST API ä¹‹é—´å­˜åœ¨ä¸€äº›æ¦‚å¿µä¸Šçš„ä¸€è‡´æ€§ï¼Œä½†æ˜¯å…·æœ‰é¢å‘èµ„æºçš„ API çš„æœåŠ¡ä¸ä¸€å®šæ˜¯æ•°æ®åº“ï¼Œå¹¶ä¸”åœ¨è§£é‡Šèµ„æºå’Œæ–¹æ³•æ–¹é¢å…·æœ‰å·¨å¤§çš„çµæ´»æ€§ã€‚ä¾‹å¦‚ï¼Œåˆ›å»ºæ—¥å†äº‹ä»¶ï¼ˆèµ„æºï¼‰å¯ä»¥ä¸ºå‚åŠ ä¼šè®®è€…åˆ›å»ºé™„åŠ äº‹ä»¶ï¼Œå‘å‚åŠ è€…å‘é€é‚®ä»¶é‚€è¯·ï¼Œé¢„çº¦ä¼šè®®å®¤å’Œæ›´æ–°è§†é¢‘ä¼šè®®æ—¶é—´è¡¨ã€‚ æ–¹æ³• é¢å‘èµ„æºçš„ API çš„å…³é”®ç‰¹æ€§æ˜¯å®ƒé€šè¿‡å¯¹èµ„æºæ‰§è¡Œçš„æ–¹æ³•ï¼ˆåŠŸèƒ½ï¼‰æ¥å¼ºè°ƒèµ„æºï¼ˆæ•°æ®æ¨¡å‹ï¼‰ã€‚ä¸€ä¸ªå…¸å‹çš„é¢å‘èµ„æºçš„ API é€šè¿‡å°‘é‡æ–¹æ³•æš´éœ²å¤§é‡èµ„æºã€‚è¿™äº›æ–¹æ³•å¯ä»¥æ˜¯æ ‡å‡†æ–¹æ³•ä¹Ÿå¯ä»¥æ˜¯è‡ªå®šä¹‰æ–¹æ³•ã€‚å¯¹äºæœ¬æŒ‡å—ï¼Œæ ‡å‡†æ–¹æ³•æ˜¯ List Get Create Update å’Œ Deleteã€‚ å½“ä¸€ä¸ª API åŠŸèƒ½è‡ªç„¶åœ°æ˜ å°„åˆ°ä¸€ä¸ªæ ‡å‡†æ–¹æ³•æ—¶ï¼Œåº”è¯¥ï¼ˆshouldï¼‰ åœ¨API è®¾è®¡ä¸­ä½¿ç”¨æ­¤æ–¹æ³•ã€‚å¯¹äºä¸èƒ½è‡ªç„¶æ˜ å°„åˆ°æ ‡å‡†æ–¹æ³•çš„åŠŸèƒ½ï¼Œå¯ä»¥(may) ä½¿ç”¨è‡ªå®šä¹‰æ–¹æ³•ã€‚è‡ªå®šä¹‰æ–¹æ³•æä¾›äº†ä¸ä¼ ç»Ÿ RPC API ç›¸åŒçš„è®¾è®¡è‡ªç”±åº¦ï¼Œèƒ½å¤Ÿç”¨æ¥å®ç°å¸¸è§çš„ç¼–ç¨‹æ¨¡å¼ï¼Œä¾‹å¦‚æ•°æ®åº“äº‹åŠ¡å’Œæ•°æ®åˆ†æã€‚ ä¾‹å­ ä¸‹é¢çš„éƒ¨åˆ†åˆ—å‡ºäº†ä¸€äº›å®é™…çš„ä¾‹å­ï¼Œå±•ç¤ºäº†å¦‚ä½•å°†é¢å‘èµ„æºçš„ API è®¾è®¡åº”ç”¨åˆ°å¤§è§„æ¨¡æœåŠ¡ä¸Šã€‚ Gmail API Gmail API æœåŠ¡å®ç°äº† Gmail API å¹¶æä¾›äº† Gmail çš„å¤§éƒ¨åˆ†åŠŸèƒ½ã€‚å®ƒæœ‰ä»¥ä¸‹èµ„æºæ¨¡å‹ï¼š Gmail API æœåŠ¡ï¼šgmail.googleapis.com ç”¨æˆ·é›†åˆï¼šusers/*ã€‚æ¯ä¸ªç”¨æˆ·æœ‰ä»¥ä¸‹èµ„æº æ¶ˆæ¯é›†åˆï¼šusers/*/messages/* çº¿ç¨‹é›†åˆï¼šusers/*/threads/* æ ‡ç­¾é›†åˆï¼šusers/*/labels/* ä¿®æ”¹å†å²é›†åˆï¼šusers/*/history/* ä»£è¡¨ç”¨æˆ·èµ„æ–™çš„èµ„æºï¼šusers/*/profile ä»£è¡¨ç”¨æˆ·è®¾ç½®é¡¹çš„èµ„æºï¼šusers/*/settings Google Cloud Pub/Sub API pubsub.googleapis.com æœåŠ¡å®ç°äº†Google Cloud Pub/Sub APIï¼Œå®ƒå®šä¹‰äº†ä¸‹é¢çš„èµ„æºæ¨¡å‹ï¼š API æœåŠ¡ï¼špubsub.googleapis.com è¯é¢˜é›†åˆï¼šprojects/*/topics/* è®¢é˜…é›†åˆï¼šprojects/*/subscriptions/* æ³¨æ„ï¼šå…¶ä»– Pub/Sub API çš„å®ç°å¯èƒ½ä¼šé€‰æ‹©ä¸åŒçš„èµ„æºåç§°æ–¹æ¡ˆ æŸ¥çœ‹å…¶ä»–ç« èŠ‚]]></content>
      <tags>
        <tag>æ¶æ„</tag>
        <tag>ç¿»è¯‘</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Google API è®¾è®¡æŒ‡å—ï¼ä»‹ç»]]></title>
    <url>%2F2017%2F03%2Fgoogle-api-design-guide%2Fintroduction%2F</url>
    <content type="text"><![CDATA[ç¿»è¯‘è‡ª API Design Guide ä»‹ç» è¿™æ˜¯ä¸€ç¯‡ç½‘ç»œ API çš„é€šç”¨è®¾è®¡æŒ‡å—ï¼Œå®ƒä»2014å¹´å¼€å§‹è¢« Google ä½¿ç”¨ï¼Œå¹¶ä¸”æŒ‡å¯¼æˆ‘ä»¬è®¾è®¡äº† Cloud API å’Œ å…¶å®ƒGoogle APIã€‚æˆ‘ä»¬å°†æ­¤æŒ‡å—åˆ†äº«å‡ºæ¥å¸Œæœ›èƒ½è®©äººä»¬æ›´ä¾¿æ·åœ°åˆä½œã€‚ Google Cloud Endpoints çš„å¼€å‘è€…åœ¨è®¾è®¡gRPC APIæ—¶å¯èƒ½ä¼šå‘ç°è¿™ç¯‡æŒ‡å—ç‰¹åˆ«æœ‰ç”¨ï¼Œæˆ‘ä»¬å¼ºçƒˆæ¨èè¿™ç±»å¼€å‘è€…ä½¿ç”¨è¿™äº›è®¾è®¡åŸåˆ™ï¼Œä½†æˆ‘ä»¬ä¸ä¼šè¦æ±‚é Google å‘˜å·¥å¿…é¡»éµå®ˆã€‚ æ­¤æŒ‡å—é€‚ç”¨äº REST API å’Œ RPC APIï¼Œç‰¹åˆ«æ˜¯ gRPC APIï¼ŒgRPC API ä½¿ç”¨ Protocol Buffers æ¥å®šä¹‰APIæ¥å£ï¼Œä½¿ç”¨ API Service Configuration æ¥é…ç½® API æœåŠ¡ï¼ŒåŒ…æ‹¬ HTTP æ˜ å°„(HTTP mapping)ã€æ—¥å¿—å’Œç›‘æ§ã€‚HTTP æ˜ å°„åŠŸèƒ½è¢« Google API å’Œ Cloud Endpoints gRPC API ç”¨æ¥è¿›è¡Œ JSON/HTTP ä¸ Protocol Buffers/RPC çš„è½¬æ¢ã€‚ æ–°çš„é£æ ¼å’Œè®¾è®¡è¢«é‡‡çº³å’Œæ ¸å‡†åå°†ä¼šè¢«æ·»åŠ è¿›æ¥ï¼Œæ‰€ä»¥æ­¤æŒ‡å—ä¼šæŒç»­æ›´æ–°ã€‚å¹¶ä¸”APIè®¾è®¡çš„è‰ºæœ¯ä¸æŠ€æœ¯ä¼šä¸€ç›´è¿›æ­¥ï¼Œæ‰€ä»¥æ­¤æŒ‡å—æ°¸è¿œä¸ä¼šâ€œå®Œç»“â€ã€‚ çº¦å®š è¿™äº›å…³é”®è¯&quot;MUST&quot;ã€â€œMUST NOTâ€ã€â€œREQUIREDâ€ã€â€œSHALLâ€ã€â€œSHALL NOTâ€ã€â€œSHOULDâ€ã€â€œSHOULD NOTâ€ã€â€œRECOMMENDEDâ€ã€â€œMAYâ€ å’Œ &quot;OPTIONAL&quot;çš„è§£é‡Šè¯·å‚è€ƒ RFC 2119 æˆ–ä¸­æ–‡è§£é‡Šï¼ˆç¿»è¯‘æ—¶æˆ‘ä¼šä¿ç•™è¿™äº›å•è¯å¹¶ä¸”åŠ ç²—æ˜¾ç¤ºï¼‰ã€‚ æŸ¥çœ‹å…¶ä»–ç« èŠ‚]]></content>
      <tags>
        <tag>æ¶æ„</tag>
        <tag>ç¿»è¯‘</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Google API è®¾è®¡æŒ‡å—ï¼ç›®å½•]]></title>
    <url>%2F2017%2F03%2Fgoogle-api-design-guide%2Fcontents%2F</url>
    <content type="text"><![CDATA[ä¸‹é¢çš„æ–‡ç« ç¿»è¯‘è‡ª Google API è®¾è®¡æŒ‡å—ï¼Œç¿»è¯‘æ—¶çš„ç‰ˆæœ¬æ˜¯2017-02-21 ä»‹ç» é¢å‘èµ„æºçš„è®¾è®¡ èµ„æºåç§° æ ‡å‡†æ–¹æ³• è‡ªå®šä¹‰æ–¹æ³• æ ‡å‡†å­—æ®µ é”™è¯¯ å‘½åçº¦å®š è®¾è®¡æ¨¡å¼ æ–‡æ¡£ ä½¿ç”¨ proto3 ç‰ˆæœ¬æ§åˆ¶ å…¼å®¹æ€§ ç›®å½•ç»“æ„ æ–‡ä»¶ç»“æ„ è¯æ±‡è¡¨]]></content>
      <tags>
        <tag>æ¶æ„</tag>
        <tag>ç¿»è¯‘</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[alertmanageré‚®ä»¶æ¨¡ç‰ˆ]]></title>
    <url>%2F2017%2F03%2Falertmanager%E9%82%AE%E4%BB%B6%E6%A8%A1%E7%89%88%2F</url>
    <content type="text"><![CDATA[è¯´æ˜ alertmanagerèƒ½å¤Ÿè®¾ç½®å¤šç§é€šçŸ¥è§„åˆ™ï¼Œè¿™ç¯‡æ–‡ç« ä»‹ç»å¦‚ä½•é…ç½®é‚®ä»¶é€šçŸ¥ ç®€å•è®¾ç½® å¦‚ä¸‹ä¿®æ”¹receivers-email_configs-htmlåï¼Œæ”¶åˆ°çš„é‚®ä»¶å†…å®¹æ˜¯ï¼šæµ‹è¯• http://ming:9093 ã€‚htmlè¡¨ç¤ºçš„æ˜¯é‚®ä»¶å†…å®¹ã€‚ 12345receivers:- name: &apos;mengyuan&apos; email_configs: - to: &apos;xxxx@xxx.com&apos; html: &apos;æµ‹è¯• &#123;&#123; .ExternalURL &#125;&#125;&apos; æ¨¡ç‰ˆå˜é‡ é‚®ä»¶æ¨¡ç‰ˆä½¿ç”¨go templateç¼–å†™ï¼Œä¸¤å¯¹å¤§æ‹¬å·ä¸­çš„.ExternalURLå³è¡¨ç¤ºå˜é‡çš„ExternalURLå­—æ®µï¼ŒDataç»“æ„å¦‚ä¸‹ï¼Œæºç åœ¨è¿™é‡Œã€‚è¯·è‡ªè¡Œgoogle go templateçš„ä½¿ç”¨æ–¹æ³•ã€‚ 12345678910111213141516171819202122232425262728// Data is the data passed to notification templates and webhook pushes.//// End-users should not be exposed to Go's type system, as this will confuse them and prevent// simple things like simple equality checks to fail. Map everything to float64/string.type Data struct &#123; Receiver string `json:"receiver"` Status string `json:"status"` Alerts Alerts `json:"alerts"` GroupLabels KV `json:"groupLabels"` CommonLabels KV `json:"commonLabels"` CommonAnnotations KV `json:"commonAnnotations"` ExternalURL string `json:"externalURL"`&#125;// Alert holds one alert for notification templates.type Alert struct &#123; Status string `json:"status"` Labels KV `json:"labels"` Annotations KV `json:"annotations"` StartsAt time.Time `json:"startsAt"` EndsAt time.Time `json:"endsAt"` GeneratorURL string `json:"generatorURL"`&#125;// Alerts is a list of Alert objects.type Alerts []Alert// KV is a set of key/value string pairs.type KV map[string]string é‚®ä»¶æ¨¡ç‰ˆæ–‡ä»¶ ä¸Šé¢ä¾‹å­å°†htmlçš„å€¼å†™ä¸ºé‚®ä»¶æ¨¡ç‰ˆï¼Œä½†å®é™…æƒ…å†µä¸€èˆ¬éœ€è¦æˆ‘ä»¬åœ¨å…¶ä»–æ–‡ä»¶ä¸­å®šä¹‰å¥½æ¨¡ç‰ˆï¼Œåœ¨htmlä¸­å¼•ç”¨æ¨¡ç‰ˆåå­—ï¼Œgo tempateçš„å­æ¨¡ç‰ˆåŠŸèƒ½å¯ä»¥æ»¡è¶³æˆ‘ä»¬çš„è¦æ±‚ã€‚ åœ¨templatesä¸‹å¡«å†™æ¨¡ç‰ˆæ–‡ä»¶è·¯å¾„ï¼Œhtmlä¸‹å¼•ç”¨å®šä¹‰å¥½çš„å­æ¨¡ç‰ˆ 12345678910# Files from which custom notification template definitions are read.# The last component may use a wildcard matcher, e.g. &apos;templates/*.tmpl&apos;.templates: [ - &lt;filepath&gt; ... ]receivers:- name: &apos;mengyuan&apos; email_configs: - to: &apos;xxx@xxx.com&apos; html: &apos;&#123;&#123; template &quot;email.mengyuan.html&quot; . &#125;&#125;&apos; headers: &#123; Subject: &quot;[WARN] æŠ¥è­¦é‚®ä»¶test&quot; &#125; æ¨¡ç‰ˆæ–‡ä»¶mengyuan.tmpl 12345678&#123;&#123; define &quot;email.mengyuan.html&quot; &#125;&#125;&lt;table&gt; &lt;tr&gt;&lt;td&gt;æŠ¥è­¦å&lt;/td&gt;&lt;td&gt;å¼€å§‹æ—¶é—´&lt;/td&gt;&lt;/tr&gt; &#123;&#123; range $i, $alert := .Alerts &#125;&#125; &lt;tr&gt;&lt;td&gt;&#123;&#123; index $alert.Labels &quot;alertname&quot; &#125;&#125;&lt;/td&gt;&lt;td&gt;&#123;&#123; $alert.StartsAt &#125;&#125;&lt;/td&gt;&lt;/tr&gt; &#123;&#123; end &#125;&#125;&lt;/table&gt;&#123;&#123; end &#125;&#125; æµ‹è¯•æ—¶å‘ç°å­æ¨¡ç‰ˆåç§°æœ‰æ•°å­—æ—¶ï¼ˆå¦‚email.mengyuan1.htmlï¼‰ä¸ä¼šæ”¶åˆ°é€šçŸ¥alermanagerä¹Ÿä¸æŠ¥é”™ï¼Œå¯èƒ½æ˜¯BUGã€‚ é…ç½®å¥½åï¼Œæ”¶åˆ°çš„é‚®ä»¶å†…å®¹å¦‚ä¸‹]]></content>
      <tags>
        <tag>prometheus</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[alertmanageræŠ¥è­¦è§„åˆ™è¯¦è§£]]></title>
    <url>%2F2017%2F03%2Falertmanager%E6%8A%A5%E8%AD%A6%E8%A7%84%E5%88%99%E8%AF%A6%E8%A7%A3%2F</url>
    <content type="text"><![CDATA[è¯´æ˜ è¿™ç¯‡æ–‡ç« ä»‹ç»prometheuså’Œalertmanagerçš„æŠ¥è­¦å’Œé€šçŸ¥è§„åˆ™ï¼Œprometheusçš„é…ç½®æ–‡ä»¶åä¸ºprometheus.ymlï¼Œalertmanagerçš„é…ç½®æ–‡ä»¶åä¸ºalertmanager.yml æŠ¥è­¦ï¼šæŒ‡prometheuså°†ç›‘æµ‹åˆ°çš„å¼‚å¸¸äº‹ä»¶å‘é€ç»™alertmanagerï¼Œè€Œä¸æ˜¯æŒ‡å‘é€é‚®ä»¶é€šçŸ¥ é€šçŸ¥ï¼šæŒ‡alertmanagerå‘é€å¼‚å¸¸äº‹ä»¶çš„é€šçŸ¥ï¼ˆé‚®ä»¶ã€webhookç­‰ï¼‰ æŠ¥è­¦è§„åˆ™ åœ¨prometheus.ymlä¸­æŒ‡å®šåŒ¹é…æŠ¥è­¦è§„åˆ™çš„é—´éš” 12# How frequently to evaluate rules.[ evaluation_interval: &lt;duration&gt; | default = 1m ] åœ¨prometheus.ymlä¸­æŒ‡å®šè§„åˆ™æ–‡ä»¶ï¼ˆå¯ä½¿ç”¨é€šé…ç¬¦ï¼Œå¦‚rules/*.rulesï¼‰ 123# Load rules once and periodically evaluate them according to the global &apos;evaluation_interval&apos;.rule_files: - rules/mengyuan.rules åœ¨rulesç›®å½•ä¸­æ·»åŠ mengyuan.rules 1234567891011121314151617ALERT goroutines_gt_70 IF go_goroutines &gt; 70 FOR 5s LABELS &#123; status = &quot;yellow&quot; &#125; ANNOTATIONS &#123; summary = &quot;goroutines è¶…è¿‡ 70ï¼Œå½“å‰å€¼&#123;&#123; $value &#125;&#125;&quot;, description = &quot;å½“å‰å®ä¾‹ &#123;&#123; $labels.instance &#125;&#125;&quot;, &#125;ALERT goroutines_gt_90 IF go_goroutines &gt; 90 FOR 5s LABELS &#123; status = &quot;red&quot; &#125; ANNOTATIONS &#123; summary = &quot;goroutines è¶…è¿‡ 90ï¼Œå½“å‰å€¼&#123;&#123; $value &#125;&#125;&quot;, description = &quot;å½“å‰å®ä¾‹ &#123;&#123; $labels.instance &#125;&#125;&quot;, &#125; é…ç½®æ–‡ä»¶è®¾ç½®å¥½åï¼Œéœ€è¦è®©prometheusé‡æ–°è¯»å–ï¼Œæœ‰ä¸¤ç§æ–¹æ³•ï¼š é€šè¿‡HTTP APIå‘/-/reloadå‘é€POSTè¯·æ±‚ï¼Œä¾‹ï¼šcurl -X POST http://localhost:9090/-/reload å‘prometheusè¿›ç¨‹å‘é€SIGHUPä¿¡å· å°†é‚®ä»¶é€šçŸ¥ä¸ruleså¯¹æ¯”ä¸€ä¸‹ï¼ˆè¿˜éœ€è¦é…ç½®alertmanager.ymlæ‰èƒ½æ”¶åˆ°é‚®ä»¶ï¼‰ é€šçŸ¥è§„åˆ™ è®¾ç½®alertmanager.ymlçš„çš„routeä¸receivers 123456789101112131415161718192021222324252627282930route: # The labels by which incoming alerts are grouped together. For example, # multiple alerts coming in for cluster=A and alertname=LatencyHigh would # be batched into a single group. group_by: [&apos;alertname&apos;] # When a new group of alerts is created by an incoming alert, wait at # least &apos;group_wait&apos; to send the initial notification. # This way ensures that you get multiple alerts for the same group that start # firing shortly after another are batched together on the first # notification. group_wait: 5s # When the first notification was sent, wait &apos;group_interval&apos; to send a batch # of new alerts that started firing for that group. group_interval: 1m # If an alert has successfully been sent, wait &apos;repeat_interval&apos; to # resend them. repeat_interval: 3h # A default receiver receiver: mengyuanreceivers:- name: &apos;mengyuan&apos; webhook_configs: - url: http://192.168.0.53:8080 email_configs: - to: &apos;mengyuan@tenxcloud.com&apos; åè¯è§£é‡Š Route routeå±æ€§ç”¨æ¥è®¾ç½®æŠ¥è­¦çš„åˆ†å‘ç­–ç•¥ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ ‘çŠ¶ç»“æ„ï¼ŒæŒ‰ç…§æ·±åº¦ä¼˜å…ˆä»å·¦å‘å³çš„é¡ºåºè¿›è¡ŒåŒ¹é…ã€‚ 123// Match does a depth-first left-to-right search through the route tree// and returns the matching routing nodes.func (r *Route) Match(lset model.LabelSet) []*Route &#123; Alert Alertæ˜¯alertmanageræ¥æ”¶åˆ°çš„æŠ¥è­¦ï¼Œç±»å‹å¦‚ä¸‹ã€‚ 1234567891011121314// Alert is a generic representation of an alert in the Prometheus eco-system.type Alert struct &#123; // Label value pairs for purpose of aggregation, matching, and disposition // dispatching. This must minimally include an "alertname" label. Labels LabelSet `json:"labels"` // Extra key/value information which does not define alert identity. Annotations LabelSet `json:"annotations"` // The known time range for this alert. Both ends are optional. StartsAt time.Time `json:"startsAt,omitempty"` EndsAt time.Time `json:"endsAt,omitempty"` GeneratorURL string `json:"generatorURL"`&#125; å…·æœ‰ç›¸åŒLablesçš„Alertï¼ˆkeyå’Œvalueéƒ½ç›¸åŒï¼‰æ‰ä¼šè¢«è®¤ä¸ºæ˜¯åŒä¸€ç§ã€‚åœ¨prometheus rulesæ–‡ä»¶é…ç½®çš„ä¸€æ¡è§„åˆ™å¯èƒ½ä¼šäº§ç”Ÿå¤šç§æŠ¥è­¦ Group alertmanagerä¼šæ ¹æ®group_byé…ç½®å°†Alertåˆ†ç»„ã€‚å¦‚ä¸‹è§„åˆ™ï¼Œå½“go_goroutinesç­‰äº4æ—¶ä¼šæ”¶åˆ°ä¸‰æ¡æŠ¥è­¦ï¼Œalertmanagerä¼šå°†è¿™ä¸‰æ¡æŠ¥è­¦åˆ†æˆä¸¤ç»„å‘receiverså‘å‡ºé€šçŸ¥ã€‚ 123456789ALERT test1 IF go_goroutines &gt; 1 LABELS &#123;label1=&quot;l1&quot;, label2=&quot;l2&quot;, status=&quot;test&quot;&#125;ALERT test2 IF go_goroutines &gt; 2 LABELS &#123;label1=&quot;l2&quot;, label2=&quot;l2&quot;, status=&quot;test&quot;&#125;ALERT test3 IF go_goroutines &gt; 3 LABELS &#123;label1=&quot;l2&quot;, label2=&quot;l1&quot;, status=&quot;test&quot;&#125; ä¸»è¦å¤„ç†æµç¨‹ æ¥æ”¶åˆ°Alertï¼Œæ ¹æ®labelsåˆ¤æ–­å±äºå“ªäº›Routeï¼ˆå¯å­˜åœ¨å¤šä¸ªRouteï¼Œä¸€ä¸ªRouteæœ‰å¤šä¸ªGroupï¼Œä¸€ä¸ªGroupæœ‰å¤šä¸ªAlertï¼‰ å°†Alertåˆ†é…åˆ°Groupä¸­ï¼Œæ²¡æœ‰åˆ™æ–°å»ºGroup æ–°çš„Groupç­‰å¾…group_waitæŒ‡å®šçš„æ—¶é—´ï¼ˆç­‰å¾…æ—¶å¯èƒ½æ”¶åˆ°åŒä¸€Groupçš„Alertï¼‰ï¼Œæ ¹æ®resolve_timeoutåˆ¤æ–­Alertæ˜¯å¦è§£å†³ï¼Œç„¶åå‘é€é€šçŸ¥ å·²æœ‰çš„Groupç­‰å¾…group_intervalæŒ‡å®šçš„æ—¶é—´ï¼Œåˆ¤æ–­Alertæ˜¯å¦è§£å†³ï¼Œå½“ä¸Šæ¬¡å‘é€é€šçŸ¥åˆ°ç°åœ¨çš„é—´éš”å¤§äºrepeat_intervalæˆ–è€…Groupæœ‰æ›´æ–°æ—¶ä¼šå‘é€é€šçŸ¥ TODO é‡å¯å¯¹å‘é€æŠ¥è­¦ä¸é€šçŸ¥çš„å½±å“ èƒ½å¦ç»„æˆé›†ç¾¤ å‚è€ƒ https://github.com/prometheus/alertmanager/blob/master/template/email.html https://prometheus.io/blog/2016/03/03/custom-alertmanager-templates/ http://studygolang.com/articles/8023 http://www.admpub.com/blog/post-221.html]]></content>
      <tags>
        <tag>prometheus</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[k8s-apiserver]]></title>
    <url>%2F2017%2F02%2Fk8s-apiserver%2F</url>
    <content type="text"><![CDATA[è¯´æ˜ apiserverå¯¹å¤–æä¾›APIæœåŠ¡ï¼Œä¸»è¦åŠŸèƒ½æ˜¯éªŒè¯å¤„ç†RESTè¯·æ±‚ï¼Œå¹¶æ›´æ–°ä¿å­˜åœ¨etcdä¸­çš„ç›¸å…³å¯¹è±¡ã€‚è¿™ç¯‡æ–‡ç« ä»¥kubernetes1.5.3è¿›è¡Œè¯´æ˜ã€‚ ä»£ç å­¦ä¹  apiserverçš„å…¥å£æ˜¯cmd/kube-apiserver/apiserver.go app.Run()çš„æ“ä½œï¼š å‚æ•°æ ¡éªŒ åŠ è½½æ’ä»¶ m, err := config.Complete().New()ä¸ºhttpserverè®¾ç½®è·¯ç”± sharedInformers.Start(wait.NeverStop)å¯åŠ¨informerï¼Œç”¨äºç›‘å¬pods, nodes, namespacesç­‰ç»„ä»¶çš„äº‹ä»¶ m.GenericAPIServer.PrepareRun().Run(wait.NeverStop)å¯åŠ¨http server k8sè®¾ç½®å¯¹è±¡çš„é»˜è®¤å€¼ï¼špkg/api/&lt;version&gt;/defaults.go ä¾‹ï¼š 1234567891011121314151617func SetDefaults_Container(obj *Container) &#123; if obj.ImagePullPolicy == "" &#123; // Ignore error and assume it has been validated elsewhere _, tag, _, _ := parsers.ParseImageName(obj.Image) // Check image tag if tag == "latest" &#123; obj.ImagePullPolicy = PullAlways &#125; else &#123; obj.ImagePullPolicy = PullIfNotPresent &#125; &#125; if obj.TerminationMessagePath == "" &#123; obj.TerminationMessagePath = TerminationMessagePathDefault &#125;&#125; éªŒè¯å¯¹è±¡æ ¼å¼ï¼špkg/api/validation/validation.go 123456789101112131415// ValidateHasLabel requires that api.ObjectMeta has a Label with key and expectedValuefunc ValidateHasLabel(meta api.ObjectMeta, fldPath *field.Path, key, expectedValue string) field.ErrorList &#123; allErrs := field.ErrorList&#123;&#125; actualValue, found := meta.Labels[key] if !found &#123; allErrs = append(allErrs, field.Required(fldPath.Child("labels").Key(key), fmt.Sprintf("must be '%s'", expectedValue))) return allErrs &#125; if actualValue != expectedValue &#123; allErrs = append(allErrs, field.Invalid(fldPath.Child("labels").Key(key), meta.Labels, fmt.Sprintf("must be '%s'", expectedValue))) &#125; return allErrs&#125; api urlç»“æ„ prefix/group/version/â€¦ ä¾‹ï¼š /apis/extensions/v1beta1/deploymentsï¼Œprefix=apis group=extensions version=v1beta1 /api/v1ï¼Œprefix=api group=&quot;&quot; version=v1 æ“ä½œetcd ä»£ç ä½ç½®ï¼špkg/storageï¼Œä½¿ç”¨etcdå®¢æˆ·ç«¯github.com/coreos/etcd/clientv3(v3)/github.com/coreos/etcd/client(v2) pkg/api/rest/rest.go å£°æ˜å„ä¸ªinterfaceï¼Œåœ¨registerResourceHandlersä¸­åšæ–­è¨€ registerResourceHandlers()ä¸ºpathæ³¨å†Œhandler action path:namespaces/{namespace}/bindings, verb:POST action path:componentstatuses, verb:LIST action path:componentstatuses/{name}, verb:GET type APIGroupVersion 123type APIGroupVersion struct &#123; Storage map[string]rest.Storage ... Storageçš„key(string)æ˜¯å„èµ„æºçš„pathï¼Œvalue(rest.Storage)æ˜¯æ“ä½œæ­¤pathçš„å¯¹è±¡ ä¸‹é¢çš„å‡½æ•°ä»apiGroupInfo.VersionedResourcesStorageMapä¸­å–å¾—storage 12345678910func (s *GenericAPIServer) getAPIGroupVersion(apiGroupInfo *APIGroupInfo, groupVersion unversioned.GroupVersion, apiPrefix string) (*apiserver.APIGroupVersion, error) &#123; storage := make(map[string]rest.Storage) for k, v := range apiGroupInfo.VersionedResourcesStorageMap[groupVersion.Version] &#123; storage[strings.ToLower(k)] = v &#125; version, err := s.newAPIGroupVersion(apiGroupInfo, groupVersion) version.Root = apiPrefix version.Storage = storage return version, err&#125; type APIGroupInfo APIGroupInfo.VersionedResourcesStorageMapä¿å­˜groupä¸­å„versionçš„èµ„æºstorage 123456// Info about an API group.type APIGroupInfo struct &#123; GroupMeta apimachinery.GroupMeta // Info about the resources in this group. Its a map from version to resource to the storage. VersionedResourcesStorageMap map[string]map[string]rest.Storage ... pkg/registry ä»£ç ä¸­å¯¹è¿™ä¸ªåŒ…çš„è¯´æ˜æ˜¯Package registry implements the storage and system logic for the core of the api server. ä»¥pkg/registry/core/rest/storage_core.goä¸ºä¾‹è¯´æ˜ func (c LegacyRESTStorageProvider) NewLegacyRESTStorage(restOptionsGetter genericapiserver.RESTOptionsGetter) (LegacyRESTStorage, genericapiserver.APIGroupInfo, error)æ­¤å‡½æ•°ä¸­åˆå§‹åŒ–èµ„æºä¸storageæ˜ å°„çš„mapï¼Œéƒ¨åˆ†ä»£ç ï¼š 1234567restStorageMap := map[string]rest.Storage&#123; "pods": podStorage.Pod, "pods/attach": podStorage.Attach, "pods/status": podStorage.Status, "pods/log": podStorage.Log, "pods/exec": podStorage.Exec, ... pkg/registry/core/pod/etcd/etcd.goçš„NewStorage()ä¸­å˜é‡storageInterface 1234567891011121314func (c completedConfig) New() (*Master, error) &#123; ... restOptionsFactory := restOptionsFactory&#123; deleteCollectionWorkers: c.DeleteCollectionWorkers, enableGarbageCollection: c.GenericConfig.EnableGarbageCollection, storageFactory: c.StorageFactory, &#125; if c.EnableWatchCache &#123; restOptionsFactory.storageDecorator = registry.StorageWithCacher &#125; else &#123; restOptionsFactory.storageDecorator = generic.UndecoratedStorage &#125; ... 12345678910// NewRawStorage creates the low level kv storage. This is a work-around for current// two layer of same storage interface.// TODO: Once cacher is enabled on all registries (event registry is special), we will remove this method.func NewRawStorage(config *storagebackend.Config) (storage.Interface, factory.DestroyFunc) &#123; s, d, err := factory.Create(*config) if err != nil &#123; glog.Fatalf("Unable to create storage backend: config (%v), err (%v)", config, err) &#125; return s, d&#125; storage.Interface pkg/storage/etcd/etcd_helper.goä½¿ç”¨etcd v2 apiï¼Œå®ç°äº†storage.Interface pkg/storage/etcd3/store.goä½¿ç”¨etcd v3 apiï¼Œå®ç°äº†storage.Interface ç¼–è§£ç etcdå­˜å‚¨çš„æ•°æ® pkg/genericapiserver/storage_factory.go NewStorageCodec()ç”ŸæˆCodec å‚è€ƒ https://github.com/kubernetes/kubernetes/blob/release-1.5/docs/design/architecture.md https://kubernetes.io/docs/admin/kube-apiserver/ https://github.com/kubernetes/community/tree/master/contributors/design-proposals https://github.com/kubernetes/community/blob/master/contributors/devel/api-conventions.md https://github.com/kubernetes/community/blob/master/contributors/devel/api_changes.md https://github.com/kubernetes/community/blob/master/contributors/design-proposals/api-group.md]]></content>
      <tags>
        <tag>kubernetes</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[IDEAä½¿ç”¨æŠ€å·§æ”¶é›†]]></title>
    <url>%2F2017%2F01%2FIDEA%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7%E6%94%B6%E9%9B%86%2F</url>
    <content type="text"><![CDATA[ä¹‹å‰ä¸€ç›´ç”¨vscodeæ¥å†™Golangï¼Œç›´åˆ°æœ‰äººå‘æˆ‘æ¨èäº†IDEAï¼Œä¾¿æŠ˜æœäºå®ƒçš„å¼ºå¤§ã€‚åœ¨è¿™é‡Œåˆ†äº«ä¸€äº›IDEAçš„æ“ä½œå’ŒæŠ€å·§ï¼ˆåªè¯´Golangï¼Œä½†ä¸€äº›æŠ€å·§å¯¹å…¶ä»–è¯­è¨€åŒæ ·æœ‰æ•ˆï¼‰ã€‚ Help -&gt; Keymap Referenceèƒ½å¤Ÿæ‰“å¼€å¿«æ·é”®æ˜ å°„çš„PDFæ–‡ä»¶ï¼Œæ–¹ä¾¿æˆ‘ä»¬æŸ¥çœ‹ åœ¨ç±»å‹ã€å‡½æ•°ã€å˜é‡ä¸ŠCTRL + é¼ æ ‡å·¦é”®èƒ½å¿«é€Ÿæ˜¾ç¤ºå®ƒä»¬çš„ä½¿ç”¨ä½ç½®ï¼Œæ›´å¥½çš„ä¸€ç‚¹æ˜¯èƒ½å¤Ÿæ˜¾ç¤ºå‡ºå¯¹å˜é‡çš„è¯»å’Œå†™ï¼Œè¿™å¯¹é˜…è¯»ä»£ç æ˜¯å¾ˆå¤§çš„å¸®åŠ©ã€‚ä¸è¿‡æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼Œå¯¹å˜é‡å–åœ°å€çš„æ“ä½œä¹Ÿä¼šåˆ¤æ–­ä¸ºè¯» ç»™structæ·»åŠ json tagã€‚åœ¨æ¯ä¸ªå…ƒç´ åè¿ç»­ALT + SHIFT + é¼ æ ‡å·¦é”®æ·»åŠ å¤šä¸ªå…‰æ ‡ï¼Œè¾“å…¥åå¼•å·(`)å’Œjï¼Œæ­¤æ—¶ä¼šå¼¹å‡ºçª—å£ï¼Œå†æŒ‰ä¸‹TABé”®ï¼Œæ‰€æœ‰å…ƒç´ éƒ½ä¼šè¡¥å…¨tag CTRL + SHIFT + Iå¿«é€ŸæŸ¥çœ‹å‡½æ•°å®šä¹‰ï¼Œä¸éœ€è¦è·³è½¬åˆ°å®šä¹‰æ–‡ä»¶æŸ¥çœ‹åå†è¿”å›æ­£åœ¨ç¼–è¾‘çš„æ–‡ä»¶ï¼Œè¿™ç§æ„Ÿè§‰ä¸èƒ½æ›´çˆ½ é‡æ„ï¼Œå¿«æ·é”®SHIFT + F6 ALT + F1åœ¨å·¥ç¨‹æ ä¸­å±•å¼€å½“å‰æ–‡ä»¶çš„ä½ç½® File Watchersæ’ä»¶ï¼Œè®¾ç½®ä¸ºå½“æ–‡ä»¶ä¿å­˜æ—¶è°ƒç”¨gofmtç­‰å·¥å…·æ ¼å¼åŒ–ä»£ç ï¼Œæˆ–åšå…¶ä»–äº‹æƒ… æˆ‘ä»¬ç»å¸¸è¦è¾“å…¥ä¸€äº›é‡å¤çš„ä»£ç ï¼Œæ¯”å¦‚åˆ¤æ–­erræ˜¯å¦ä¸ºnilã€‚é€šè¿‡Live Templateè§£æ”¾åŒæ‰‹å§ï¼ˆCTRL + Jï¼‰]]></content>
  </entry>
  <entry>
    <title><![CDATA[dockerå®¹å™¨é—´é€šä¿¡çš„ä¸€ç§æ–¹æ³•]]></title>
    <url>%2F2017%2F01%2Fdocker%E5%AE%B9%E5%99%A8%E9%97%B4%E9%80%9A%E4%BF%A1%E7%9A%84%E4%B8%80%E7%A7%8D%E6%96%B9%E6%B3%95%2F</url>
    <content type="text"><![CDATA[ä»¥æˆ‘çš„ghoståšå®¢ä¸ºä¾‹è¿›è¡Œè¯´æ˜ï¼Œæˆ‘åœ¨VPSä¸Šç”¨dockerå¯åŠ¨äº†ä¸¤ä¸ªghoståšå®¢ï¼Œè¿˜æœ‰ä¸€ä¸ªNginxåšåå‘ä»£ç†ï¼Œå°†ä¸¤ä¸ªåŸŸååˆ†åˆ«æŒ‡å‘ä¸¤ä¸ªåšå®¢ã€‚ dockerå¯åŠ¨å‘½ä»¤ ghost: 12docker run -e NODE_ENV=production --name ghost1 -v /path/to/data/ghost/ghost1/:/var/lib/ghost -d ghostdocker run -e NODE_ENV=production --name ghost2 -v /path/to/data/ghost/ghost2/:/var/lib/ghost -d ghost nginx: 1docker run -p 80:80 --name nginx --link ghost1 --link ghost2 -v /path/to/data/nginx/nginx.conf:/etc/nginx/nginx.conf -d nginx å…ˆå¯åŠ¨ä¸¤ä¸ªghostï¼Œç„¶åå¯åŠ¨nginxã€‚ä½¿ç”¨â€“linkå‚æ•°å°†å®¹å™¨â€œé“¾æ¥â€åˆ°ä¸€èµ·ï¼Œæ­¤å‚æ•°ä¼šåœ¨å®¹å™¨ä¸­åŠ å…¥ç¯å¢ƒå˜é‡å¹¶åœ¨/etc/hostsä¸­æ’å…¥ä¸€æ¡å®¹å™¨åä¸IPçš„æ˜ å°„ 1234root@fabfd4bacfda:/# cat /etc/hosts172.17.0.3 ghost1 d19c0134011a172.17.0.5 ghost2 0e2e66ba70e0172.17.0.4 fabfd4bacfda è®¾ç½®nginxåå‘ä»£ç† ä¿®æ”¹nginx.confï¼Œåœ¨httpæ®µå†…æ·»åŠ å¦‚ä¸‹å†…å®¹ 123456789101112131415161718192021222324252627http &#123; server &#123; listen 80; server_name www.domain1.tk domain1.tk; location / &#123; proxy_pass http://ghost1:2368; proxy_redirect off; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; &#125; &#125; server &#123; listen 80; server_name www.domain2.tk domain2.tk; location / &#123; proxy_pass http://ghost2:2368; proxy_redirect off; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; &#125; &#125;&#125; æ³¨æ„proxy_passçš„å€¼proxy_pass http://ghost2:2368;ã€‚ ghost2æ˜¯nginxå®¹å™¨/etc/hostsä¸­çš„ä¸€æ¡ï¼Œæ˜¯ç”±â€“linkå‚æ•°æ·»åŠ è¿›æ¥çš„ã€‚ è®¾ç½®å®Œè¿™äº›åï¼Œnginxå°±ä¼šå°†ä¸¤ä¸ªåŸŸåçš„è¯·æ±‚åˆ†åˆ«ä»£ç†åˆ°ä¸¤ä¸ªåšå®¢ä¸­ã€‚ è¡¥å…… å®¹å™¨é‡å¯åIPå¯èƒ½å˜åŒ–ï¼Œæ‰€ä»¥ç›´æ¥åœ¨nginx.confä¸­æŒ‡å®šIPå¹¶ä¸æ˜¯ä¸€ä¸ªå¥½æ–¹æ³•ã€‚ä½¿ç”¨â€“linkæ—¶hostsæ–‡ä»¶ä¼šéšç€å®¹å™¨IPçš„å˜åŒ–æ›´æ–°ï¼Œæ‰€ä»¥ä½¿ç”¨åŸŸåæ‰æ˜¯æ›´å®¹æ˜“ç»´æŠ¤çš„æ–¹æ³•ã€‚]]></content>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ·±å…¥ç†è§£Goè¯­è¨€çš„slice]]></title>
    <url>%2F2017%2F01%2F%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Go%E8%AF%AD%E8%A8%80%E7%9A%84slice%2F</url>
    <content type="text"><![CDATA[å…ˆçœ‹è¿™æ®µä»£ç ï¼Œç»“æœæ˜¯[0 2 3]ï¼Œå¾ˆå¤šäººéƒ½èƒ½ç­”å¯¹ã€‚ 12345678func modify(s []int) &#123; s[0] = 0&#125;func main() &#123; s := []int&#123;1, 2, 3&#125; modify(s) fmt.Println(s)&#125; ç„¶åç¨å¾®æ”¹åŠ¨ä¸€ä¸‹ï¼Œå†çŒœä¸€ä¸‹ç»“æœ 12345678func pop(s []int) &#123; s = s[:len(s)-1]&#125;func main() &#123; s := []int&#123;1, 2, 3&#125; pop(s) fmt.Println(s)&#125; å¦‚æœè®¤ä¸ºè¾“å‡º[1 2]çš„è¯é‚£ä¹ˆä½ é”™äº†ï¼Œç»“æœæ˜¯[1 2 3]ï¼Œä½ å¯èƒ½ä¼šè§‰å¾—å¾ˆå¥‡æ€ªï¼Œsliceæ˜¯å¼•ç”¨è¯­ä¹‰è¿™ä¸ªåœ¨ç¬¬ä¸€ä¸ªä¾‹å­ä¸­å·²ç»è¯æ˜äº†ï¼Œä¸ºä»€ä¹ˆç¬¬äºŒä¸ªä¾‹å­ä¸­åˆä¸æ˜¯è¿™æ ·å‘¢ã€‚ æˆ‘ä»¬å¯¹ä¸­é—´è¿‡ç¨‹åŠ ä¸€äº›è¾“å‡ºï¼Œå†æ¥çœ‹çœ‹ 1234567891011func pop(s []int) &#123; fmt.Printf("[pop] s addr:%p\n", &amp;s) s = s[:len(s)-1] fmt.Println("[pop] s value:", s)&#125;func main() &#123; s := []int&#123;1, 2, 3&#125; fmt.Printf("[main] s addr:%p\n", &amp;s) pop(s) fmt.Println("[main] s value:", s)&#125; è¿è¡Œä¸Šé¢ä»£ç è¾“å‡ºå¦‚ä¸‹ 1234[main] s addr:0xc082004640[pop] s addr:0xc0820046c0[pop] s value: [1 2][main] s value: [1 2 3] çœ‹åˆ°ä¸Šé¢çš„ç»“æœï¼Œå¯ä»¥çŸ¥é“pop()ä¸­çš„så¹¶ä¸æ˜¯å¼•ç”¨ï¼Œè€Œæ˜¯ä¸€ä¸ªå‰¯æœ¬ï¼Œè™½ç„¶åœ¨pop()å†…éƒ¨ä¿®æ”¹æˆåŠŸï¼Œä½†å¹¶æ²¡æœ‰å½±å“åˆ°main()ä¸­çš„sã€‚ä½†ç¬¬ä¸€ä¸ªä¾‹å­å´ä¿®æ”¹æˆåŠŸäº†ï¼Œè¿™åˆæ˜¯ä¸ºä»€ä¹ˆã€‚ ä¸‹é¢æ¥çœ‹ä¸‹sliceçš„å®ç°ï¼Œå°±èƒ½å¾ˆæ¸…æ¥šçš„äº†è§£åŸå› äº†ã€‚ sliceæ˜¯ç”±é•¿åº¦å›ºå®šçš„æ•°ç»„å®ç°çš„ã€‚å½“ä½¿ç”¨å†…å»ºå‡½æ•°append()å‘sliceæ·»åŠ å…ƒç´ æ—¶ï¼Œå¦‚æœè¶…è¿‡åº•å±‚çš„æ•°ç»„é•¿åº¦åˆ™ä¼šé‡æ–°åˆ†é…ç©ºé—´ï¼ˆä¸C++çš„vectorç±»ä¼¼ï¼‰ã€‚ å¯ä»¥æŠŠsliceè®¤ä¸ºæ˜¯ä¸‹é¢è¿™æ ·çš„ä¸€ä¸ªç»“æ„ä½“ï¼ˆå…ˆä¸è€ƒè™‘sliceçš„å®¹é‡ï¼‰ã€‚Lenghtè¡¨ç¤ºsliceçš„é•¿åº¦ï¼ŒZerothElementè¡¨ç¤ºåº•å±‚æ•°ç»„çš„å¤´æŒ‡é’ˆ 1234type sliceHeader struct &#123; Length int ZerothElement *byte&#125; å‚ç…§è¿™ä¸ªç»“æ„ä½“çš„å®šä¹‰å’Œä¸‹é¢çš„è¯´æ˜ï¼Œå°±èƒ½å¾ˆæ¸…æ¥šåœ°äº†è§£å¼€å§‹çš„ä¸¤ä¸ªä¾‹å­äº† é‚£å½“æˆ‘ä»¬éœ€è¦å°†sliceåšä¸ºå‡½æ•°å‚æ•°ä¼ å…¥ï¼Œå¹¶ä¸”å‡½æ•°ä¼šä¿®æ”¹sliceæ—¶ï¼Œæ€ä¹ˆåŠå‘¢ã€‚è¿™é‡Œè¯´ä¸‰ç§æ–¹æ³•ã€‚ 1.å°†sliceæŒ‡é’ˆåšä¸ºå‚æ•°ï¼Œè€Œä¸æ˜¯slice 123func modify(s *[]int) &#123; // do something&#125; 2.æŠŠå‡½æ•°å†…è¢«ä¿®æ”¹åçš„sliceåšä¸ºè¿”å›å€¼ï¼Œå°†å‡½æ•°è¿”å›å€¼èµ‹å€¼ç»™åŸå§‹slice 12345678func modify(s []int) []int &#123; // do something return s&#125;func main() &#123; s := []int&#123;1, 2, 3&#125; s = modify(s)&#125; 3.å°†å‡½æ•°åšä¸ºsliceæŒ‡é’ˆçš„æ–¹æ³• 12345type slice []intfunc (s *slice) modify() &#123; // do something&#125;]]></content>
      <tags>
        <tag>go</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[golangåœ¨ç¼–è¯‘æ—¶ç”¨ldflagsè®¾ç½®å˜é‡çš„å€¼]]></title>
    <url>%2F2017%2F01%2Fgolang%E5%9C%A8%E7%BC%96%E8%AF%91%E6%97%B6%E7%94%A8ldflags%E8%AE%BE%E7%BD%AE%E5%8F%98%E9%87%8F%E7%9A%84%E5%80%BC%2F</url>
    <content type="text"><![CDATA[æˆ‘ä»¬ç»å¸¸ä¼šåœ¨ä¸€äº›ç¨‹åºçš„è¾“å‡ºä¸­çœ‹åˆ°ç¨‹åºç‰ˆæœ¬ã€ç¼–è¯‘æ—¶é—´ã€Gitçš„commit idç­‰ä¿¡æ¯ï¼Œæ¯”å¦‚docker 123456789ming@vultr:~$ docker versionClient: Version: 1.12.5 API version: 1.24 Go version: go1.6.4 Git commit: 7392c3b Built: Fri Dec 16 02:42:17 2016 OS/Arch: linux/amd64... æˆ‘ä»¬å¯ä»¥æä¾›ä¸€ä¸ªé…ç½®æ–‡ä»¶version.confï¼Œç¨‹åºè¿è¡Œæ—¶ä»version.confå–å¾—è¿™äº›ä¿¡æ¯è¿›è¡Œæ˜¾ç¤ºã€‚ä½†æ˜¯åœ¨éƒ¨ç½²ç¨‹åºæ—¶ï¼Œé™¤äº†äºŒè¿›åˆ¶æ–‡ä»¶è¿˜éœ€è¦é¢å¤–çš„é…ç½®æ–‡ä»¶ï¼Œä¸æ˜¯å¾ˆæ–¹ä¾¿ã€‚ æˆ–è€…å°†è¿™äº›ä¿¡æ¯å†™å…¥ä»£ç ä¸­ï¼Œè¿™æ ·ä¸éœ€è¦é¢å¤–çš„version.confï¼Œä½†è¦åœ¨æ¯æ¬¡ç¼–è¯‘æ—¶ä¿®æ”¹ä»£ç æ–‡ä»¶ï¼Œä¹Ÿå¤Ÿéº»çƒ¦çš„äº†ã€‚ æœ‰ä¸€ç§æ›´å¥½çš„åŠæ³•æ˜¯åœ¨ç¼–è¯‘æ—¶ä½¿ç”¨å‚æ•°-ldflags -X importpath.name=valueï¼Œå®˜æ–¹è§£é‡Šå¦‚ä¸‹ -X importpath.name=value Set the value of the string variable in importpath named name to value. Note that before Go 1.5 this option took two separate arguments. Now it takes one argument split on the first = sign. ä»¥ä¸‹é¢ä»£ç è¯´æ˜ 12345678910111213package mainimport "fmt"var ( VERSION string BUILD_TIME string GO_VERSION string)func main() &#123; fmt.Printf("%s\n%s\n%s\n", VERSION, BUILD_TIME, GO_VERSION)&#125; ç”¨å¦‚ä¸‹å‘½ä»¤ç¼–è¯‘ï¼Œæ³¨æ„å› ä¸ºdateå’Œgo versionçš„è¾“å‡ºæœ‰ç©ºæ ¼ï¼Œæ‰€ä»¥main.BUILD_TIMEå’Œmain.GO_VERSIONå¿…é¡»ä½¿ç”¨å¼•å·æ‹¬èµ·æ¥ 1go build -ldflags &quot;-X main.VERSION=1.0.0 -X &apos;main.BUILD_TIME=`date`&apos; -X &apos;main.GO_VERSION=`go version`&apos;&quot; ç¼–è¯‘æˆåŠŸåè¿è¡Œç¨‹åºï¼Œç»“æœå¦‚ä¸‹ 1234ming@ubuntu:~/go_workspace/src/test$ ./test 1.0.0Sun Feb 12 00:13:27 CST 2017go version go1.7.5 linux/amd64]]></content>
      <tags>
        <tag>go</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[beego ormä¸­æ—¶åŒºçš„é—®é¢˜]]></title>
    <url>%2F2017%2F01%2Fbeego%20orm%E4%B8%AD%E6%97%B6%E5%8C%BA%E7%9A%84%E9%97%AE%E9%A2%98%2F</url>
    <content type="text"><![CDATA[å…ˆçœ‹ç®€åŒ–åä»£ç ï¼Œä¸‹é¢åªåˆ—å‡ºmainå‡½æ•° 12345678910func main() &#123; t := "2017-01-19 00:00:00" o := orm.NewOrm() qb, _ := orm.NewQueryBuilder("mysql") sql := qb.Select("COUNT(*)").From("test").Where("create_time &gt; ?").String() o.Raw(sql, t).Exec() o.QueryTable("test").Filter("create_time__gt", t).Count()&#125; è¿™ä¹ˆçœ‹çš„è¯æ„Ÿè§‰ä¸¤ä¸ªSQLåº”è¯¥æ˜¯ç›¸åŒçš„ï¼š 12[ORM] - 2017-01-19 19:28:02 - [Queries/default] - [ OK / db.Exec / 1.2ms] - [SELECT COUNT(*) FROM test WHERE create_time &gt; ?] - `2017-01-19 00:00:00`[ORM] - 2017-01-19 19:28:02 - [Queries/default] - [ OK / db.QueryRow / 2.3ms] - [SELECT COUNT(*) FROM `test` T0 WHERE T0.`create_time` &gt; ? ] - `2017-01-19 00:00:00` æˆ‘åœ¨æœ¬æœºæµ‹è¯•OKï¼Œä½†åœ¨å¦ä¸€ä¸ªç¯å¢ƒSQLæ˜¯è¿™æ ·çš„ï¼š 12[ORM] - 2017-01-19 11:30:43 - [Queries/default] - [ OK / db.Exec / 1.2ms] - [SELECT COUNT(*) FROM test WHERE create_time &gt; ?] - `2017-01-19 00:00:00`[ORM] - 2017-01-19 11:30:43 - [Queries/default] - [ OK / db.QueryRow / 1.2ms] - [SELECT COUNT(*) FROM `test` T0 WHERE T0.`create_time` &gt; ? ] - `2017-01-19 08:00:00` ç›¸å·®8å°æ—¶ï¼Œç¬¬ä¸€æ—¶é—´æƒ³åˆ°æ—¶åŒºé—®é¢˜ï¼Œå»æœ‰é—®é¢˜çš„ç¯å¢ƒä¸€çœ‹æœçœŸå¦‚æ­¤ã€‚ ç„¶åçœ‹äº†ä¸‹beego ormçš„ä»£ç ï¼Œä¸‹é¢åˆ—å‡ºå…³é”®éƒ¨åˆ†ã€‚ 1.orm/db_utils.goçš„getFlatParams() æ­¤å‡½æ•°æ˜¯è§£æFilter()ç”ŸæˆSQLçš„å…³é”®éƒ¨åˆ†ï¼Œå¦‚æœFilter()ç¬¬ä¸€ä¸ªå‚æ•°ç±»å‹æ˜¯Dateæˆ–Datetimeï¼Œç¬¬äºŒä¸ªå‚æ•°ç±»å‹æ˜¯stringå°±æŠŠstringè§£ææˆtime.Timeç±»å‹ åœ¨ä¸Šé¢caseä¸­len(v) = 19ï¼Œæ‰§è¡Œtime.ParseInLocation(formatDateTime, s, DefaultTimeLoc)ï¼Œå› ä¸ºæœ‰é—®é¢˜çš„ç¯å¢ƒæ˜¯UTCæ—¶åŒºï¼Œæ‰€ä»¥æ­¤å‡½æ•°ä¼šæŠŠå­—ç¬¦ä¸²2017-01-19 00:00:00è§£ææˆtime.Time2017-01-19 00:00:00 +0000 UTCï¼ˆå˜é‡tï¼Œä½†å®é™…æ˜¯ä¸œå…«åŒºçš„æ—¶é—´ï¼Œæ­£ç¡®çš„tåº”è¯¥æ˜¯2017-01-19 00:00:00 +0800 CSTï¼‰ã€‚ 12345678910111213141516171819202122232425262728293031func getFlatParams(fi *fieldInfo, args []interface&#123;&#125;, tz *time.Location) (params []interface&#123;&#125;) &#123;â€¦â€¦ switch kind &#123; case reflect.String: v := val.String() if fi != nil &#123; if fi.fieldType == TypeDateField || fi.fieldType == TypeDateTimeField &#123; var t time.Time var err error if len(v) &gt;= 19 &#123; s := v[:19] t, err = time.ParseInLocation(formatDateTime, s, DefaultTimeLoc) &#125; else &#123; s := v if len(v) &gt; 10 &#123; s = v[:10] &#125; t, err = time.ParseInLocation(formatDate, s, tz) &#125; if err == nil &#123; if fi.fieldType == TypeDateField &#123; v = t.In(tz).Format(formatDate) &#125; else &#123; v = t.In(tz).Format(formatDateTime) &#125; &#125; &#125; &#125; arg = vâ€¦â€¦&#125; 2.t.In(tz).Format(formatDateTime)å†æ¬¡å°†tæ ¼å¼åŒ–ä¸ºå­—ç¬¦ä¸²ï¼Œå‚æ•°tzæ˜¯å…³é”®ï¼Œå®ƒæ˜¯åœ¨ä¸‹é¢ä»£ç ä¸­èµ‹å€¼çš„ã€‚å› ä¸ºMySQLè®¾ç½®çš„æ˜¯ä¸œå…«åŒºï¼Œæ‰€ä»¥ä¼šè®¾ç½®al.TZä¸ºä¸œå…«åŒºï¼Œä¹Ÿå°±æ˜¯t.In(tz).Format(formatDateTime)ä¸­tzæ˜¯ä¸œå…«åŒºï¼Œå¯¼è‡´Formatè¿”å›çš„å­—ç¬¦ä¸²æ˜¯2017-01-19 08:00:00ï¼Œäºæ˜¯å°±æœ‰äº†ä¸Šé¢ä¸¤æ¡SQLä¸åŒçš„é—®é¢˜ã€‚ 12345678910111213141516171819202122func detectTZ(al *alias) &#123; // orm timezone system match database // default use Local al.TZ = time.Local ...... switch al.Driver &#123; case DRMySQL: row := al.DB.QueryRow("SELECT TIMEDIFF(NOW(), UTC_TIMESTAMP)") var tz string row.Scan(&amp;tz) if len(tz) &gt;= 8 &#123; if tz[0] != '-' &#123; tz = "+" + tz &#125; t, err := time.Parse("-07:00:00", tz) if err == nil &#123; al.TZ = t.Location() &#125; else &#123; DebugLog.Printf("Detect DB timezone: %s %s\n", tz, err.Error()) &#125; &#125;......]]></content>
      <tags>
        <tag>go</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ghostä¿®æ”¹ä»£ç é«˜äº®å’Œå­—ä½“]]></title>
    <url>%2F2017%2F01%2Fghost%E4%BF%AE%E6%94%B9%E4%BB%A3%E7%A0%81%E9%AB%98%E4%BA%AE%E5%92%8C%E5%AD%97%E4%BD%93%2F</url>
    <content type="text"><![CDATA[ä»Šå¤©å¼€å§‹ç”¨ghostï¼Œå‘ç°é»˜è®¤ä¸»é¢˜ï¼ˆcasperï¼‰å¹¶æ²¡æœ‰ä»£ç é«˜äº®åŠŸèƒ½ï¼Œç”¨èµ·æ¥ç›¸å½“ä¸çˆ½ã€‚googleå¹¶çœ‹äº†çœ‹ghostä¸»é¢˜çš„ä»£ç ï¼Œæ‰¾åˆ°äº†è§£å†³æ–¹æ³•ã€‚ åœ¨åå°æ‰¾åˆ°Code Injectionï¼ŒBlog Headerå’ŒBlog Footerä¸­åˆ†åˆ«åŠ å…¥ä¸€äº›ä»£ç å³å¯ã€‚ ä¿®æ”¹æ–¹æ³• Blog Header: 12345678910111213&lt;!-- åŠ è½½highlight.jsæ ·å¼ --&gt;&lt;link href=&quot;//cdn.bootcss.com/highlight.js/9.9.0/styles/tomorrow-night-eighties.min.css&quot; rel=&quot;stylesheet&quot;&gt;&lt;!-- åŠ è½½googleå­—ä½“ --&gt;&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;//fonts.googleapis.com/css?family=Droid+Sans+Mono&quot;&gt;&lt;!-- è®¾ç½®å­—ä½“ --&gt;&lt;style&gt;body,p,code,h1, h2, h3, h4, h5, h6,.hljs &#123; font-family: &apos;Droid Sans Mono&apos;, monospace;&#125;.hljs &#123; font-size: 0.8em&#125;&lt;/style&gt; Blog Footer: 123&lt;!-- æ‰§è¡Œhighlight.js --&gt;&lt;script src=&quot;//cdn.bootcss.com/highlight.js/9.9.0/highlight.min.js&quot;&gt;&lt;/script&gt;&lt;script&gt;hljs.initHighlightingOnLoad();&lt;/script&gt; åŸç† æŸ¥çœ‹ä¸»é¢˜æ–‡ä»¶themes/casper/default.hbsï¼Œå¯ä»¥çœ‹åˆ°ghost_headå’Œghost_footã€‚æˆ‘ä»¬åœ¨ä¸Šé¢è®¾ç½®Code Injectionåå°±ä¼šæ›¿æ¢ç›¸åº”å†…å®¹ï¼Œä»è€Œæ”¹å˜é¡µé¢æ˜¾ç¤ºã€‚ 1234567891011&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt; &lt;!-- éšè—æ‰æ— å…³ä¿¡æ¯ --&gt; &#123;&#123;!-- Ghost outputs important style and meta data with this tag --&#125;&#125; &#123;&#123;ghost_head&#125;&#125;&lt;/head&gt;&lt;body class=&quot;&#123;&#123;body_class&#125;&#125; nav-closed&quot;&gt; &#123;&#123;ghost_foot&#125;&#125;&lt;/body&gt;&lt;/html&gt; ghostiumä¸»é¢˜ ghostiumæ˜¯githubä¸Šstaræ•°è¾ƒå¤šçš„ä¸€æ¬¾ä¸»é¢˜ï¼Œä½¿ç”¨Prismåšè¯­æ³•é«˜äº®ï¼Œæ‰€ä»¥å°±ä¸å†éœ€è¦è‡ªå·±æ·»åŠ highlight.jsäº†ã€‚ å¦‚æœæ·»åŠ äº†highlight.jsï¼Œä½†markdownæ ¼å¼å†™é”™åï¼Œå°±å¯èƒ½ä¼šå‡ºç°è¿™ç§é—®é¢˜]]></content>
      <tags>
        <tag>ghost</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[golangé—­åŒ…]]></title>
    <url>%2F2017%2F01%2Fgolang%E9%97%AD%E5%8C%85%2F</url>
    <content type="text"><![CDATA[æœ‰å¦‚ä¸‹å‡½æ•°ï¼Œç®€å•æ¥è¯´å°±æ˜¯æœ‰é”™è¯¯åˆ™ç›´æ¥è¿”å›ï¼Œæ²¡é”™è¯¯åˆ™æ‰§è¡Œfå‡½æ•°ã€‚ 1234567func (t *transaction) Do(f func()) *transaction &#123; if t.fail || t.rollback || t.finish &#123; return t &#125; f() return t&#125; å‡½æ•°å¾ˆç®€å•ï¼Œä½†å¦‚ä½•æµ‹è¯•å‘¢ï¼Œç®€å•ä½†ä¸‘é™‹çš„æ–¹æ³•ï¼š 12345678910111213func Test_func(t *testing.T) &#123; isCalled := false f := func() &#123; isCalled = true &#125; trans := New() // do something trans.Do(f) // check if isCalled &#123; // do something &#125;&#125; åœ¨fä¸­ä¿®æ”¹å¤–éƒ¨å˜é‡ï¼Œç„¶ååˆ¤æ–­å˜é‡æ˜¯å¦å˜åŒ–å°±å¯ä»¥çŸ¥é“fæ˜¯å¦è¢«æ‰§è¡Œã€‚ä½†æˆ‘ä»¬ä¸€èˆ¬éœ€è¦æµ‹è¯•å¤šç§æƒ…å†µï¼Œæ¯”å¦‚å¯¹äºDoå‡½æ•°ï¼Œæˆ‘ä»¬éœ€è¦å°† t.fail t.rollback t.finishè®¾ç½®ä¸åŒå€¼è¿›è¡Œæµ‹è¯•ï¼Œå°†ä¸Šé¢æµ‹è¯•ä»£ç æ‰©å……ï¼ˆå¦‚æœéœ€è¦æµ‹è¯•è¿™ä¸‰ä¸ªå˜é‡ç»„åˆçš„æƒ…å†µï¼Œä»£ç å°±æ›´é•¿äº†ï¼‰ï¼š 1234567891011121314151617181920212223242526272829func Test_func(t *testing.T) &#123; isCalled1 := false isCalled2 := false isCalled3 := false f1 := func() &#123; isCalled1 = true &#125; f2 := func() &#123; isCalled2 = true &#125; f3 := func() &#123; isCalled3 = true &#125; trans := New() // do something trans.Do(f1) trans.Do(f2) trans.Do(f3) // check if isCalled1 &#123; // do something &#125; if isCalled2 &#123; // do something &#125; if isCalled3 &#123; // do something &#125;&#125; åœ¨ä¸Šé¢ä»£ç ä¸­f1 f2 f3å‡½æ•°çš„é€»è¾‘éƒ½ä¸€æ ·ï¼Œè¿™æ—¶å¯ä»¥é€šè¿‡ä½¿ç”¨é—­åŒ…æ¥æ¶ˆé™¤å†—ä½™ä»£ç ï¼š 12345678910111213141516171819202122232425262728func Test_func(t *testing.T) &#123; genTestFunc := func() (func(), func() bool) &#123; isCalled := false return func() &#123; isCalled = true &#125;, func() bool &#123; return isCalled &#125; &#125; f1, f1Called := genTestFunc() f2, f2Called := genTestFunc() f3, f3Called := genTestFunc() trans := New() // do something trans.Do(f1) trans.Do(f2) trans.Do(f3) // check if f1Called() &#123; // do something &#125; if f2Called() &#123; // do something &#125; if f3Called() &#123; // do something &#125;&#125; è§£é‡Šä¸€ä¸‹ï¼ŒgenTestFuncè¿”å›å€¼æ˜¯ä¸¤ä¸ªå‡½æ•°ï¼Œç¬¬ä¸€ä¸ªå‡½æ•°å¯ä¼ å…¥Doä¸­ï¼Œç¬¬äºŒä¸ªå‡½æ•°ç”¨æ¥åˆ¤æ–­æ˜¯å¦è¢«Doè°ƒç”¨ã€‚ ç²—ç•¥çœ‹æ”¹åŠ¨å‰åä»£ç è¡Œæ•°åŸºæœ¬ç›¸åŒï¼Œä½†å¦‚æœfå˜å¤æ‚æˆ–è€…éœ€è¦æ›´å¤šçš„æµ‹è¯•caseæ—¶ï¼Œæ”¹åŠ¨åçš„ä»£ç æ›´åŠ ç®€æ´ï¼Œæ˜“äºç»´æŠ¤ã€‚]]></content>
      <tags>
        <tag>go</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[äº†è§£etcd]]></title>
    <url>%2F2017%2F01%2F%E4%BA%86%E8%A7%A3etcd%2F</url>
    <content type="text"><![CDATA[è¯´æ˜ è¿™æ˜¯ä¸€ç¯‡éå¸¸å…¥é—¨çš„æ–‡ç« ï¼Œè®©ä½ å¤§æ¦‚äº†è§£ä¸€ä¸‹etcdã€‚å†™è¿™ç¯‡æ–‡ç« æ—¶ä½¿ç”¨etcdçš„ç‰ˆæœ¬æ˜¯3.1.0ã€‚ etcdæ˜¯ä»¥å®ç°å…±äº«é…ç½®å’ŒæœåŠ¡å‘ç°ä¸ºç›®çš„ï¼Œæä¾›ä¸€è‡´æ€§çš„é”®å€¼å­˜å‚¨çš„åˆ†å¸ƒå¼æ•°æ®åº“ã€‚kubernetesç­‰é¡¹ç›®ä½¿ç”¨äº†etcdã€‚ ä¸‹è½½å®‰è£… å»è¿™é‡Œä¸‹è½½releaseåŒ…ï¼Œè§£å‹åæ˜¯ä¸€äº›æ–‡æ¡£å’Œä¸¤ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶etcdå’Œetcdctlã€‚etcdæ˜¯serverç«¯ï¼Œetcdctlæ˜¯å®¢æˆ·ç«¯ã€‚å°†etcdå’ŒetcdctlåŠ å…¥PATHè·¯å¾„æ–¹ä¾¿æˆ‘ä»¬æ‰§è¡Œå‘½ä»¤ã€‚ è¿è¡Œserver æ‰§è¡Œå‘½ä»¤etcdï¼Œå³å¯å¯åŠ¨server 1234567891011ming@ming:/tmp$ etcd2017-02-14 14:04:40.164639 I | etcdmain: etcd Version: 3.1.02017-02-14 14:04:40.164725 I | etcdmain: Git SHA: 8ba28972017-02-14 14:04:40.164736 I | etcdmain: Go Version: go1.7.42017-02-14 14:04:40.164776 I | etcdmain: Go OS/Arch: linux/amd642017-02-14 14:04:40.164784 I | etcdmain: setting maximum number of CPUs to 4, total number of available CPUs is 42017-02-14 14:04:40.164850 W | etcdmain: no data-dir provided, using default data-dir ./default.etcd2017-02-14 14:04:40.164934 I | etcdmain: advertising using detected default host &quot;192.168.1.124&quot;2017-02-14 14:04:40.165855 I | embed: listening for peers on http://localhost:23802017-02-14 14:04:40.167090 I | embed: listening for client requests on localhost:2379...... etcdctl è¯´æ˜ï¼šetcdæœ€æ–°çš„APIç‰ˆæœ¬æ˜¯v3ã€‚ä¸v2ç›¸æ¯”ï¼Œv3æ›´é«˜æ•ˆæ›´æ¸…æ™°ã€‚è®¾ç½®ç¯å¢ƒå˜é‡ETCDCTL_API=3ã€‚ 1234ming@ming:/tmp$ export ETCDCTL_API=3ming@ming:/tmp$ etcdctl versionetcdctl version: 3.1.0API version: 3.1 é”®å€¼å¯¹å‘½ä»¤ putè®¾ç½®keyï¼Œgetå–å¾—key 12345ming@ming:/tmp$ etcdctl put msg &quot;Hello TenxCloud&quot;OKming@ming:/tmp$ etcdctl get msg msgHello TenxCloud delåˆ é™¤key 1234567ming@ming:/tmp$ etcdctl get msg msgHello TenxCloudming@ming:/tmp$ etcdctl del msg1ming@ming:/tmp$ etcdctl get msgming@ming:/tmp$ txnäº‹åŠ¡ txnä»æ ‡å‡†è¾“å…¥ä¸­è¯»å–å¤šä¸ªè¯·æ±‚ï¼Œå°†å®ƒä»¬çœ‹åšä¸€ä¸ªåŸå­æ€§çš„äº‹åŠ¡æ‰§è¡Œã€‚äº‹åŠ¡æ˜¯ç”±æ¡ä»¶åˆ—è¡¨ï¼Œæ¡ä»¶åˆ¤æ–­æˆåŠŸæ—¶çš„æ‰§è¡Œåˆ—è¡¨ï¼ˆæ¡ä»¶åˆ—è¡¨ä¸­å…¨éƒ¨æ¡ä»¶ä¸ºçœŸè¡¨ç¤ºæˆåŠŸï¼‰å’Œæ¡ä»¶åˆ¤æ–­å¤±è´¥æ—¶çš„æ‰§è¡Œåˆ—è¡¨ï¼ˆæ¡ä»¶åˆ—è¡¨ä¸­æœ‰ä¸€ä¸ªä¸ºå‡å³ä¸ºå¤±è´¥ï¼‰ç»„æˆçš„ã€‚ çœ‹æ–‡å­—è§£é‡Šå®¹æ˜“æ™•ï¼Œæ¥çœ‹å®ä¾‹å§ 1234567891011121314ming@ming:/tmp$ etcdctl put flag 1OKming@ming:/tmp$ etcdctl txn -icompares:value(&quot;flag&quot;) = &quot;1&quot;success requests (get, put, delete):put result truefailure requests (get, put, delete):put result falseSUCCESSOKming@ming:/tmp$ etcdctl get resultresulttrue è§£é‡Šä¸€ä¸‹ï¼š etcdctl put flag 1è®¾ç½®flagä¸º1 etcdctl txn -iå¼€å¯äº‹åŠ¡ï¼ˆ-iè¡¨ç¤ºäº¤äº’æ¨¡å¼ï¼‰ ç¬¬2æ­¥è¾“å…¥å‘½ä»¤åå›è½¦ï¼Œç»ˆç«¯æ˜¾ç¤ºå‡ºcomparesï¼š è¾“å…¥value(â€œflagâ€) = â€œ1â€ï¼Œæ­¤å‘½ä»¤æ˜¯æ¯”è¾ƒflagçš„å€¼ä¸1æ˜¯å¦ç›¸ç­‰ ç¬¬4æ­¥å®Œæˆåè¾“å…¥å›è½¦ï¼Œç»ˆç«¯ä¼šæ¢è¡Œæ˜¾ç¤ºï¼Œæ­¤æ—¶å¯ä»¥ç»§ç»­è¾“å…¥åˆ¤æ–­æ¡ä»¶ï¼ˆå‰é¢è¯´è¿‡äº‹åŠ¡ç”±æ¡ä»¶åˆ—è¡¨ç»„æˆï¼‰ï¼Œå†æ¬¡è¾“å…¥å›è½¦è¡¨ç¤ºåˆ¤æ–­æ¡ä»¶è¾“å…¥å®Œæ¯• ç¬¬5æ­¥è¿ç»­è¾“å…¥ä¸¤ä¸ªå›è½¦åï¼Œç»ˆç«¯æ˜¾ç¤ºå‡ºsuccess requests (get, put, delete):ï¼Œè¡¨ç¤ºä¸‹é¢è¾“å…¥åˆ¤æ–­æ¡ä»¶ä¸ºçœŸæ—¶è¦æ‰§è¡Œçš„å‘½ä»¤ ä¸è¾“å…¥åˆ¤æ–­æ¡ä»¶ç›¸åŒï¼Œè¿ç»­ä¸¤ä¸ªå›è½¦è¡¨ç¤ºæˆåŠŸæ—¶çš„æ‰§è¡Œåˆ—è¡¨è¾“å…¥å®Œæˆ ç»ˆç«¯æ˜¾ç¤ºfailure requests (get, put, delete):åè¾“å…¥æ¡ä»¶åˆ¤æ–­å¤±è´¥æ—¶çš„æ‰§è¡Œåˆ—è¡¨ ä¸ºäº†çœ‹èµ·æ¥ç®€æ´ï¼Œæ­¤å®ä¾‹ä¸­æ¡ä»¶åˆ—è¡¨å’Œæ‰§è¡Œåˆ—è¡¨åªå†™äº†ä¸€è¡Œå‘½ä»¤ï¼Œå®é™…å¯ä»¥è¾“å…¥å¤šè¡Œ æ€»ç»“ä¸Šé¢çš„äº‹åŠ¡ï¼Œè¦åšçš„äº‹æƒ…å°±æ˜¯flagä¸º1æ—¶è®¾ç½®resultä¸ºtrueï¼Œå¦åˆ™è®¾ç½®resultä¸ºfalse äº‹åŠ¡æ‰§è¡Œå®ŒæˆåæŸ¥çœ‹resultå€¼ä¸ºtrue watchç›‘å¬ watchåetcdctlé˜»å¡ï¼Œåœ¨å¦ä¸€ä¸ªç»ˆç«¯ä¸­æ‰§è¡Œetcdctl put flag 2åï¼Œwatchä¼šæ‰“å°å‡ºç›¸å…³ä¿¡æ¯ 1234ming@ming:/tmp$ etcdctl watch flagPUTflag2 leaseç§Ÿçº¦ etcdä¹Ÿèƒ½ä¸ºkeyè®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œä½†ä¸redisä¸åŒï¼Œetcdéœ€è¦å…ˆåˆ›å»ºleaseï¼Œç„¶åä½¿ç”¨putå‘½ä»¤åŠ ä¸Šå‚æ•°â€“lease=æ¥è®¾ç½® 12345678910111213141516171819202122232425ming@ming:/tmp$ etcdctl lease grant 100lease 38015a3c00490513 granted with TTL(100s)ming@ming:/tmp$ etcdctl put k1 v1 --lease=38015a3c00490513OKming@ming:/tmp$ etcdctl lease timetolive 38015a3c00490513lease 38015a3c00490513 granted with TTL(100s), remaining(67s)ming@ming:/tmp$ etcdctl lease timetolive 38015a3c00490513lease 38015a3c00490513 granted with TTL(100s), remaining(64s)ming@ming:/tmp$ etcdctl lease timetolive 38015a3c00490513 --keyslease 38015a3c00490513 granted with TTL(100s), remaining(59s), attached keys([k1])ming@ming:/tmp$ etcdctl put k2 v2 --lease=38015a3c00490513OKming@ming:/tmp$ etcdctl lease timetolive 38015a3c00490513 --keyslease 38015a3c00490513 granted with TTL(100s), remaining(46s), attached keys([k1 k2])ming@ming:/tmp$ etcdctl lease revoke 38015a3c00490513 lease 38015a3c00490513 revokedming@ming:/tmp$ etcdctl get k1ming@ming:/tmp$ etcdctl get k2ming@ming:/tmp$ ming@ming:/tmp$ etcdctl lease grant 10lease 38015a3c0049051d granted with TTL(10s)ming@ming:/tmp$ etcdctl lease keep-alive 38015a3c0049051dlease 38015a3c0049051d keepalived with TTL(10)lease 38015a3c0049051d keepalived with TTL(10)lease 38015a3c0049051d keepalived with TTL(10) lease grant &lt;ttl&gt; åˆ›å»ºleaseï¼Œè¿”å›lease IDã€‚åˆ›å»ºçš„leaseç”Ÿå­˜æ—¶é—´å¤§äºæˆ–ç­‰äºttlç§’ï¼ˆTODOï¼šä¸ºä»€ä¹ˆå¯èƒ½å¤§äºï¼Ÿï¼‰ lease revoke &lt;lease ID&gt; åˆ é™¤leaseï¼Œå¹¶åˆ é™¤æ‰€æœ‰å…³è”çš„key lease timetolive &lt;lease ID&gt; å–å¾—leaseçš„æ€»æ—¶é—´å’Œå‰©ä½™æ—¶é—´ lease keep-alive &lt;lease ID&gt; æ­¤å‘½ä»¤ä¸ä¼šåªæ›´æ–°ä¸€æ¬¡leaseæ—¶é—´ï¼Œè€Œæ˜¯å‘¨æœŸæ€§åœ°åˆ·æ–°ï¼Œä¿è¯å®ƒä¸ä¼šè¿‡æœŸã€‚ é›†ç¾¤ç®¡ç†å‘½ä»¤ TODO å¹¶å‘æ§åˆ¶å‘½ä»¤ lock &lt;lock name&gt; é€šè¿‡æŒ‡å®šçš„åå­—åŠ é”ã€‚æ³¨æ„ï¼Œåªæœ‰å½“æ­£å¸¸é€€å‡ºä¸”é‡Šæ”¾é”åï¼Œlockå‘½ä»¤çš„é€€å‡ºç æ˜¯0ï¼Œå¦åˆ™è¿™ä¸ªé”ä¼šä¸€ç›´è¢«å ç”¨ç›´åˆ°è¿‡æœŸï¼ˆé»˜è®¤60ç§’ï¼‰ 123456789101112131415161718192021222324252627ä½¿ç”¨Ctrl+Cæ­£å¸¸é€€å‡ºlockå‘½ä»¤ï¼Œé€€å‡ºç ä¸º0ï¼Œç¬¬äºŒæ¬¡èƒ½æ­£å¸¸lockï¼šming@ming:/tmp$ etcdctl lock testtest/38015a3fd6795e04^Cming@ming:/tmp$ echo $?0ming@ming:/tmp$ etcdctl lock testtest/38015a3fd6795e0akillæ‰lockå‘½ä»¤ï¼Œé€€å‡ºç ä¸ä¸º0ï¼Œç¬¬äºŒæ¬¡lockè¢«é˜»å¡ï¼šç»ˆç«¯1ï¼Œç¬¬ä¸€æ¬¡æ­£å¸¸é”ä½testï¼šming@ming:/tmp$ etcdctl lock testtest/38015a3fd6795e11ç»ˆç«¯2ï¼Œkillæ‰lockå‘½ä»¤ï¼šming@ming:~$ ps aux|grep &apos;etcdctl lock&apos;ming 44546 0.5 0.5 19876 11436 pts/5 Sl+ 11:42 0:00 etcdctl lock testming 44560 0.0 0.0 14224 1084 pts/6 S+ 11:43 0:00 grep --color=auto etcdctl lockming@ming:~$ kill -9 44546 ç»ˆç«¯1ï¼Œé€€å‡ºç ä¸ä¸º0ï¼Œç¬¬äºŒæ¬¡é”testè¢«é˜»å¡ming@ming:/tmp$ etcdctl lock testtest/38015a3fd6795e1eKilledming@ming:/tmp$ echo $?137ming@ming:/tmp$ etcdctl lock test elect TODO æƒé™ user å¯ä»¥ä¸ºetcdåˆ›å»ºå¤šä¸ªç”¨æˆ·å¹¶è®¾ç½®å¯†ç ï¼Œå­å‘½ä»¤æœ‰ï¼š add æ·»åŠ ç”¨æˆ· delete åˆ é™¤ç”¨æˆ· get å–å¾—ç”¨æˆ·è¯¦æƒ… list åˆ—å‡ºæ‰€æœ‰ç”¨æˆ· passwd ä¿®æ”¹ç”¨æˆ·å¯†ç  grant-role ç»™ç”¨æˆ·åˆ†é…è§’è‰² revoke-role ç»™ç”¨æˆ·ç§»é™¤è§’è‰² role å¯ä»¥ä¸ºetcdåˆ›å»ºå¤šä¸ªè§’è‰²å¹¶è®¾ç½®æƒé™ï¼Œå­å‘½ä»¤æœ‰ï¼š add æ·»åŠ è§’è‰² delete åˆ é™¤è§’è‰² get å–å¾—è§’è‰²ä¿¡æ¯ list åˆ—å‡ºæ‰€æœ‰è§’è‰² grant-permission ä¸ºè§’è‰²è®¾ç½®æŸä¸ªkeyçš„æƒé™ revoke-permission ä¸ºè§’è‰²ç§»é™¤æŸä¸ªkeyçš„æƒé™ auth å¼€å¯/å…³é—­æƒé™æ§åˆ¶ ç¤ºä¾‹ ä¸‹é¢ä»¥ç¤ºä¾‹æ¥å­¦ä¹ è¿™ä¸‰ä¸ªå‘½ä»¤ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263rootç”¨æˆ·å­˜åœ¨æ—¶æ‰èƒ½å¼€å¯æƒé™æ§åˆ¶ming@ming:/tmp$ etcdctl auth enableError: etcdserver: root user does not existming@ming:/tmp$ etcdctl user add rootPassword of root: Type password of root again for confirmation: User root createdming@ming:/tmp$ etcdctl auth enableAuthentication Enabled å¼€å¯æƒé™æ§åˆ¶åéœ€è¦ç”¨--useræŒ‡å®šç”¨æˆ·ming@ming:/tmp$ etcdctl user listError: etcdserver: user name not foundming@ming:/tmp$ etcdctl user list --user=rootPassword: rootming@ming:/tmp$ etcdctl user get root --user=rootPassword: User: rootRoles: root æ·»åŠ ç”¨æˆ·ï¼Œå‰ä¸¤ä¸ªå¯†ç æ˜¯æ–°ç”¨æˆ·çš„ï¼Œåä¸€ä¸ªå¯†ç æ˜¯rootçš„ming@ming:/tmp$ etcdctl user add mengyuan --user=rootPassword of mengyuan: Type password of mengyuan again for confirmation: Password: User mengyuan created ä½¿ç”¨æ–°ç”¨æˆ·æ‰§è¡Œputå‘½ä»¤ï¼Œæç¤ºæ²¡æœ‰æƒé™ming@ming:/tmp$ etcdctl put key1 v1 --user=mengyuanPassword: Error: etcdserver: permission deniedåˆ›å»ºåä¸ºrw_key_çš„roleï¼Œæ·»åŠ å¯¹å­—ç¬¦ä¸²&quot;key&quot;åšä¸ºå‰ç¼€çš„keyçš„è¯»å†™æƒé™ï¼Œä¸ºmengyuanæ·»åŠ è§’è‰²ming@ming:/tmp$ etcdctl role add rw_key_ --user=rootPassword: Role rw_key_ createdming@ming:/tmp$ etcdctl --user=root role grant-permission rw_key_ readwrite key --prefix=truePassword: Role rw_key_ updatedming@ming:/tmp$ etcdctl --user=root user grant-role mengyuan rw_key_Password: Role rw_key_ is granted to user mengyuan æ·»åŠ æƒé™æˆåŠŸåæ‰§è¡Œput key1æˆåŠŸï¼Œæ‰§è¡Œput k1å¤±è´¥ï¼ˆå› ä¸ºä¸Šé¢åªç»™å‰ç¼€ä¸º&quot;key&quot;çš„keyæ·»åŠ äº†æƒé™ï¼‰ming@ming:/tmp$ etcdctl put key1 v1 --user=mengyuanPassword: OKming@ming:/tmp$ etcdctl put k1 v1 --user=mengyuanPassword: Error: etcdserver: permission denied æ‰§è¡Œuser listå‘½ä»¤å¤±è´¥ï¼Œæ²¡æœ‰æƒé™ming@ming:/tmp$ etcdctl user list --user=mengyuanPassword: Error: etcdserver: permission deniedä¸ºæ–°ç”¨æˆ·æ·»åŠ rootçš„è§’è‰²åå°±èƒ½æ‰§è¡Œuser listå‘½ä»¤äº†ï¼Œæ³¨æ„å‘½ä»¤ä¸­ç¬¬ä¸€ä¸ªrootæ˜¯è§’è‰²ï¼Œç¬¬äºŒä¸ªrootæ˜¯ç”¨æˆ·ming@ming:/tmp$ etcdctl user grant-role mengyuan root --user=rootPassword: Role root is granted to user mengyuanming@ming:/tmp$ etcdctl user list --user=mengyuanPassword: mengyuanroot è¿›ä¸€æ­¥å­¦ä¹  etcdctl -hæŸ¥çœ‹å­å‘½ä»¤çš„å¸®åŠ©ï¼ˆä¾‹ï¼šetcdctl watch -hï¼‰ http://play.etcd.io/play æ˜¯ç½‘é¡µç‰ˆé›†ç¾¤ç¯å¢ƒ etcdctlèƒ½å¤Ÿè®¾ç½®â€“prefix=trueæ¥æ“ä½œå¤šä¸ªæŒ‡å®šå‰ç¼€çš„key å‚è€ƒæ–‡æ¡£ https://github.com/coreos/etcd https://github.com/coreos/etcd/tree/master/etcdctl]]></content>
      <tags>
        <tag>etcd</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[äº†è§£kubernetesçš„ConfigMap]]></title>
    <url>%2F2017%2F01%2F%E4%BA%86%E8%A7%A3kubernetes%E7%9A%84ConfigMap%2F</url>
    <content type="text"><![CDATA[è®¸å¤šæœåŠ¡åœ¨å¯åŠ¨/è¿è¡Œæ—¶éœ€è¦è¯»å–é…ç½®æ–‡ä»¶ã€ç¯å¢ƒå˜é‡æˆ–å‘½ä»¤è¡Œå‚æ•°ç­‰ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿åœ°ä½¿ç”¨ConfigMapä¸ºpodå®Œæˆè¿™äº›é…ç½®ä¿¡æ¯çš„è®¾ç½®ä¸æ›´æ–°ã€‚é€šè¿‡ä¸‹é¢çš„ä¾‹å­æ¥äº†è§£ä¸‹ConfigMapå§ã€‚ ç”ŸæˆConfigMap æœ‰ä¸¤ä¸ªæ–‡ä»¶info1 info2ä¿å­˜äº†é…ç½®ä¿¡æ¯ 12345678ming@ming-master:~/temp/configmap$ lsinfo1 info2ming@ming-master:~/temp/configmap$ cat info1 name=mengyuancorp=tenxcloudming@ming-master:~/temp/configmap$ cat info2 name=wangleicorp=tenxcloud æ‰§è¡Œkubectl create configmap conf --from-file=.å‘½ä»¤ç”ŸæˆConfigMap ï¼ˆconfæ˜¯æŒ‡å®šçš„ConfigMapçš„åå­—ï¼Œ--from-file=.æŒ‡å®šäº†å½“å‰ç›®å½•ï¼Œåªä¼šå°†å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶åšä¸ºé…ç½®æ–‡ä»¶è€Œä¸å»è¯»å­ç›®å½•ã€‚ä¹Ÿå¯ä»¥ä»æ–‡ä»¶æˆ–å‘½ä»¤è¡Œä¸­å–å¾—é…ç½®ï¼Œè¯¦ç»†å‚è€ƒå®˜ç½‘ï¼‰ 12ming@ming-master:~/temp/configmap$ kubectl create configmap conf --from-file=.configmap &quot;conf&quot; created ç„¶åä½¿ç”¨kubectl describe configmapæŸ¥çœ‹ä¸‹åˆšç”Ÿæˆçš„ConfigMap 12345678910ming@ming-master:~/temp/configmap$ kubectl describe configmap confName: confNamespace: defaultLabels: &lt;none&gt;Annotations: &lt;none&gt;Data====info1: 29 bytesinfo2: 28 bytes æˆ–ä½¿ç”¨kubectl get configmap *** -o yamlæŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ 1234567891011121314151617ming@ming-master:~/temp/configmap$ kubectl get configmap conf -o yamlapiVersion: v1data: info1: | name=mengyuan corp=tenxcloud info2: | name=wanglei corp=tenxcloudkind: ConfigMapmetadata: creationTimestamp: 2016-05-06T19:09:22Z name: conf namespace: default resourceVersion: &quot;4578&quot; selfLink: /api/v1/namespaces/default/configmaps/conf uid: 0aa0a417-13be-11e6-8ead-000c2911326e åœ¨podä¸­ä½¿ç”¨ConfigMap ConfigMapç”Ÿæˆåå¦‚ä½•åœ¨podä¸­ä½¿ç”¨å‘¢ï¼Œç»§ç»­ä½¿ç”¨ä¸Šé¢çš„ä¾‹å­è¿›è¡Œè¯´æ˜ã€‚å‡è®¾æˆ‘ä»¬çš„å®¹å™¨æœåŠ¡éœ€è¦info1ä¸info2ä¸¤ä¸ªé…ç½®æ–‡ä»¶ã€‚ podæ–‡ä»¶å¦‚ä¸‹ï¼Œæ³¨æ„volumeMountsä¸volumesæ®µï¼ŒvolumeMounts.nameè¦ä¸volumes.nameä¸€è‡´ï¼Œvolumes.configMap.nameä¸ä¸Šé¢åˆ›å»ºçš„ConfigMapåå­—ä¸€è‡´ 1234567891011121314151617ming@ming-master:~/temp/configmap$ cat pod.yaml apiVersion: v1kind: Podmetadata: name: testconfigmapspec: containers: - name: testconfigmap image: index.tenxcloud.com/tenxcloud/ubuntu volumeMounts: - name: config-volume mountPath: /etc/config volumes: - name: config-volume configMap: name: conf restartPolicy: Never å¯åŠ¨pod 12ming@ming-master:~/temp/configmap$ kubectl create -f pod.yaml pod &quot;testconfigmap&quot; created å¯åŠ¨æˆåŠŸï¼Œåˆ°slaveä¸­çš„å®¹å™¨çœ‹ä¸‹info1 info2ä¸¤ä¸ªæ–‡ä»¶æ˜¯å¦æ­£å¸¸ 1234567891011ming@ming-slave:~$ docker ps |grep ubuntu.*testconfigmap9431b36fa6f6 index.tenxcloud.com/tenxcloud/ubuntu &quot;/run.sh&quot; About a minute ago Up About a minute k8s_testconfigmap.469034b4_testconfigmap_default_1f88674f-13c5-11e6-8ead-000c2911326e_b0994daaming@ming-slave:~$ docker exec -it k8s_testconfigmap.469034b4_testconfigmap_default_1f88674f-13c5-11e6-8ead-000c2911326e_b0994daa /bin/bashroot@testconfigmap:/# ls /etc/config/info1 info2root@testconfigmap:/# cat /etc/config/info1name=mengyuancorp=tenxcloudroot@testconfigmap:/# cat /etc/config/info2name=wangleicorp=tenxcloud bingo! æ›´è¿›ä¸€æ­¥ï¼šçƒ­æ›´æ–°é…ç½®æ–‡ä»¶ å¯ä»¥ä½¿ç”¨kubectl replaceå‘½ä»¤æ¥æ›´æ–°ConfigMapï¼Œä½†æ­¤å‘½ä»¤æ ¼å¼ä¸ºkubectl replace -f FILENAME [flags]ï¼Œ-fåé¢éœ€è¦æŒ‡å®šConfigMapçš„é…ç½®æ–‡ä»¶ è€Œä¸Šé¢æ˜¯ç”¨--from-fileæŒ‡å®šç›®å½•å–å¾—çš„é…ç½®æ–‡ä»¶ï¼Œæ›´æ–°æ–‡ä»¶åå¦‚ä½•æ›´æ–°ConfigMapè¿˜æ²¡æœ‰æŸ¥åˆ°æ­£å¸¸çš„æ–¹æ³•ï¼Œä¸‹é¢è¯´ä¸‹æ¯”è¾ƒæ¶å¿ƒçš„æ–¹æ³•ã€‚ 1234567891011121314151617ming@ming-master:~/temp$ kubectl get configmap conf -o yamlapiVersion: v1data: info1: | name=mengyuan corp=tenxcloud info2: | name=wanglei corp=tenxcloudkind: ConfigMapmetadata: creationTimestamp: 2016-05-06T19:09:22Z name: conf namespace: default resourceVersion: &quot;5148&quot; selfLink: /api/v1/namespaces/default/configmaps/conf uid: 0aa0a417-13be-11e6-8ead-000c2911326e å–å¾—ConfigMapä¿¡æ¯ä¿å­˜åˆ°æ–‡ä»¶å†åˆ é™¤/æ·»åŠ å†…å®¹å¦‚ä¸‹ 123456789101112131415ming@ming-master:~/temp$ cat /tmp/configmap apiVersion: v1data: info1: | name=mengyuan corp=tenxcloud add new line 1 info2: | name=wanglei corp=tenxcloud add new line 2kind: ConfigMapmetadata: name: conf namespace: default ç„¶åå†ä½¿ç”¨kubectl replaceä¿®æ”¹ConfigMap 12ming@ming-master:~/temp$ kubectl replace -f /tmp/configmap configmap &quot;conf&quot; replaced æˆåŠŸï¼Œåˆ‡å›slaveçœ‹ä¸‹é…ç½®æ–‡ä»¶ 12345678root@testconfigmap:/# cat /etc/config/info1name=mengyuancorp=tenxcloudadd new line 1root@testconfigmap:/# cat /etc/config/info2name=wangleicorp=tenxcloudadd new line 2 ä¿®æ”¹æˆåŠŸ ä¸€äº›é™åˆ¶åŠé—®é¢˜ å½“create ConfigMapæ—¶â€“from-fileæŒ‡å®šçš„æ˜¯ç›®å½•æ—¶ï¼Œåœ¨æ›´æ–°æ–‡ä»¶åï¼Œå¦‚ä½•æ­£å¸¸çš„æ›´æ–°ConfigMap å¦‚ä½•ä¸ºæœ‰å­ç›®å½•çš„é…ç½®ç›®å½•ç”ŸæˆConfigMapï¼ˆå­ç›®å½•ä¸­ä¹Ÿæœ‰é…ç½®æ–‡ä»¶ï¼‰ é…ç½®æ–‡ä»¶ä¸èƒ½å®æ—¶æ›´æ–°ï¼Œåœ¨masterä¸Šä½¿ç”¨kubectrl replaceæˆ–kubectl editæ›´æ–°configmapåï¼Œç›¸å…³podå†…çš„æ–‡ä»¶å»¶è¿Ÿæ›´æ–°ï¼ˆæµ‹è¯•ä¸¤æ¬¡30sï¼Œ1minï¼‰ï¼ˆä¸‹ä¸€æ¬¡syncLoopæ—¶ï¼Œæ‰ä¼šæ›´æ–°é…ç½®ï¼‰ ç¯å¢ƒå˜é‡æ›´æ–°åæ—§Podå†…ç¯å¢ƒå˜é‡ä¸ä¼šæ”¹å˜ï¼Œæ–°å¯åŠ¨çš„Podæ˜¯æœ€æ–°çš„ç¯å¢ƒå˜é‡ é…ç½®æ–‡ä»¶åï¼ˆåšä¸ºconfigmap.dataä¸­çš„keyåå­—ï¼‰æœ‰é™åˆ¶ï¼ŒData contains the configuration data. Each key must be a valid DNS_SUBDOMAIN with an optional leading dotï¼ˆå¯ä»¥æœ‰æ¨ªçº¿-ç‚¹.å°å†™å­—æ¯ï¼‰ å‚è€ƒèµ„æ–™ å®˜ç½‘ HowTo Write ConfigMap enabled Golang Microservices ConfigMapçš„è®¾è®¡]]></content>
      <tags>
        <tag>kubernetes</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Goçš„å†…å­˜æ¨¡å‹]]></title>
    <url>%2F2017%2F01%2FGo%E7%9A%84%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B%2F</url>
    <content type="text"><![CDATA[è¯´æ˜ ç¿»è¯‘è‡ªThe Go Memory Model ä»‹ç» å¦‚ä½•ä¿è¯åœ¨ä¸€ä¸ªgoroutineä¸­çœ‹åˆ°åœ¨å¦ä¸€ä¸ªgoroutineä¿®æ”¹çš„å˜é‡çš„å€¼ï¼Œè¿™ç¯‡æ–‡ç« è¿›è¡Œäº†è¯¦ç»†è¯´æ˜ã€‚ å»ºè®® å¦‚æœç¨‹åºä¸­ä¿®æ”¹æ•°æ®æ—¶æœ‰å…¶ä»–goroutineåŒæ—¶è¯»å–ï¼Œé‚£ä¹ˆå¿…é¡»å°†è¯»å–ä¸²è¡ŒåŒ–ã€‚ä¸ºäº†ä¸²è¡ŒåŒ–è®¿é—®ï¼Œè¯·ä½¿ç”¨channelæˆ–å…¶ä»–åŒæ­¥åŸè¯­ï¼Œä¾‹å¦‚syncå’Œsync/atomicæ¥ä¿æŠ¤æ•°æ®ã€‚ å…ˆè¡Œå‘ç”Ÿ åœ¨ä¸€ä¸ªgouroutineä¸­ï¼Œè¯»å’Œå†™ä¸€å®šæ˜¯æŒ‰ç…§ç¨‹åºä¸­çš„é¡ºåºæ‰§è¡Œçš„ã€‚å³ç¼–è¯‘å™¨å’Œå¤„ç†å™¨åªæœ‰åœ¨ä¸ä¼šæ”¹å˜è¿™ä¸ªgoroutineçš„è¡Œä¸ºæ—¶æ‰å¯èƒ½ä¿®æ”¹è¯»å’Œå†™çš„æ‰§è¡Œé¡ºåºã€‚ç”±äºé‡æ’ï¼Œä¸åŒçš„goroutineå¯èƒ½ä¼šçœ‹åˆ°ä¸åŒçš„æ‰§è¡Œé¡ºåºã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªgoroutineæ‰§è¡Œa = 1;b = 2;ï¼Œå¦ä¸€ä¸ªgoroutineå¯èƒ½çœ‹åˆ°båœ¨aä¹‹å‰æ›´æ–°ã€‚ ä¸ºäº†è¯´æ˜è¯»å’Œå†™çš„å¿…è¦æ¡ä»¶ï¼Œæˆ‘ä»¬å®šä¹‰äº†å…ˆè¡Œå‘ç”Ÿï¼ˆHappens Beforeï¼‰â€“Goç¨‹åºä¸­æ‰§è¡Œå†…å­˜æ“ä½œçš„ååºã€‚å¦‚æœäº‹ä»¶e1å‘ç”Ÿåœ¨e2å‰ï¼Œæˆ‘ä»¬å¯ä»¥è¯´e2å‘ç”Ÿåœ¨e1åã€‚å¦‚æœe1ä¸å‘ç”Ÿåœ¨e2å‰ä¹Ÿä¸å‘ç”Ÿåœ¨e2åï¼Œæˆ‘ä»¬å°±è¯´e1å’Œe2æ˜¯å¹¶å‘çš„ã€‚ åœ¨å•ç‹¬çš„goroutineä¸­å…ˆè¡Œå‘ç”Ÿçš„é¡ºåºå³æ˜¯ç¨‹åºä¸­è¡¨è¾¾çš„é¡ºåºã€‚ å½“ä¸‹é¢æ¡ä»¶æ»¡è¶³æ—¶ï¼Œå¯¹å˜é‡ v çš„è¯»æ“ä½œ r æ˜¯ è¢«å…è®¸ çœ‹åˆ°å¯¹ v çš„å†™æ“ä½œ w çš„ï¼š r ä¸å…ˆè¡Œå‘ç”Ÿäº w åœ¨ w å r å‰æ²¡æœ‰å¯¹ v çš„å…¶ä»–å†™æ“ä½œ ä¸ºäº†ä¿è¯å¯¹å˜é‡ v çš„è¯»æ“ä½œ r çœ‹åˆ°å¯¹ v çš„å†™æ“ä½œ w ,è¦ç¡®ä¿ w æ˜¯ r å…è®¸çœ‹åˆ°çš„å”¯ä¸€å†™æ“ä½œã€‚å³å½“ä¸‹é¢æ¡ä»¶æ»¡è¶³æ—¶ï¼Œ r è¢«ä¿è¯ çœ‹åˆ° w ï¼š w å…ˆè¡Œå‘ç”Ÿäº r å…¶ä»–å¯¹å…±äº«å˜é‡ v çš„å†™æ“ä½œè¦ä¹ˆåœ¨ w å‰ï¼Œè¦ä¹ˆåœ¨ r åã€‚ è¿™ä¸€å¯¹æ¡ä»¶æ¯”å‰é¢çš„æ¡ä»¶æ›´ä¸¥æ ¼ï¼Œéœ€è¦æ²¡æœ‰å…¶ä»–å†™æ“ä½œä¸ w æˆ– r å¹¶å‘å‘ç”Ÿã€‚ å•ç‹¬çš„goroutineä¸­æ²¡æœ‰å¹¶å‘ï¼Œæ‰€ä»¥ä¸Šé¢ä¸¤ä¸ªå®šä¹‰æ˜¯ç›¸åŒçš„ï¼šè¯»æ“ä½œ r çœ‹åˆ°æœ€è¿‘ä¸€æ¬¡çš„å†™æ“ä½œ w å†™å…¥ v çš„å€¼ã€‚å½“å¤šä¸ªgoroutineè®¿é—®å…±äº«å˜é‡ v æ—¶ï¼Œå®ƒä»¬å¿…é¡»ä½¿ç”¨åŒæ­¥äº‹ä»¶æ¥å»ºç«‹å…ˆè¡Œå‘ç”Ÿè¿™ä¸€æ¡ä»¶æ¥ä¿è¯è¯»æ“ä½œèƒ½çœ‹åˆ°éœ€è¦çš„å†™æ“ä½œã€‚ å¯¹å˜é‡ v çš„é›¶å€¼åˆå§‹åŒ–åœ¨å†…å­˜æ¨¡å‹ä¸­è¡¨ç°çš„ä¸å†™æ“ä½œç›¸åŒã€‚ å¯¹å¤§äºä¸€ä¸ªå­—çš„å˜é‡çš„è¯»å†™æ“ä½œè¡¨ç°çš„åƒä»¥ä¸ç¡®å®šé¡ºåºå¯¹å¤šä¸ªä¸€å­—å¤§å°çš„å˜é‡çš„æ“ä½œã€‚ åŒæ­¥ åˆå§‹åŒ– ç¨‹åºçš„åˆå§‹åŒ–åœ¨å•ç‹¬çš„goroutineä¸­è¿›è¡Œï¼Œä½†è¿™ä¸ªgoroutineå¯èƒ½ä¼šåˆ›å»ºå‡ºå¹¶å‘æ‰§è¡Œçš„å…¶ä»–goroutineã€‚ å¦‚æœåŒ…på¼•å…¥ï¼ˆimportï¼‰åŒ…qï¼Œé‚£ä¹ˆqçš„initå‡½æ•°çš„ç»“æŸå…ˆè¡Œå‘ç”Ÿäºpçš„æ‰€æœ‰initå‡½æ•°å¼€å§‹ main.mainå‡½æ•°çš„å¼€å§‹å‘ç”Ÿåœ¨æ‰€æœ‰initå‡½æ•°ç»“æŸä¹‹å åˆ›å»ºgoroutine goå…³é”®å­—å¼€å¯æ–°çš„goroutineï¼Œå…ˆè¡Œå‘ç”Ÿäºè¿™ä¸ªgoroutineå¼€å§‹æ‰§è¡Œï¼Œä¾‹å¦‚ä¸‹é¢ç¨‹åºï¼š 12345678910var a stringfunc f() &#123; print(a)&#125;func hello() &#123; a = "hello, world" go f()&#125; è°ƒç”¨helloä¼šåœ¨ä¹‹åçš„æŸæ—¶åˆ»æ‰“å°å‡º&quot;hello, world&quot;ï¼ˆå¯èƒ½åœ¨helloè¿”å›ä¹‹åï¼‰ é”€æ¯goroutine gouroutineçš„é€€å‡ºå¹¶ä¸ä¼šä¿è¯å…ˆè¡Œå‘ç”Ÿäºç¨‹åºçš„ä»»ä½•äº‹ä»¶ã€‚ä¾‹å¦‚ä¸‹é¢ç¨‹åºï¼š 123456var a stringfunc hello() &#123; go func() &#123; a = "hello" &#125;() print(a)&#125; æ²¡æœ‰ç”¨ä»»ä½•åŒæ­¥æ“ä½œé™åˆ¶å¯¹açš„èµ‹å€¼ï¼Œæ‰€ä»¥å¹¶ä¸èƒ½ä¿è¯å…¶ä»–goroutineèƒ½çœ‹åˆ°açš„å˜åŒ–ã€‚å®é™…ä¸Šï¼Œä¸€ä¸ªæ¿€è¿›çš„ç¼–è¯‘å™¨å¯èƒ½ä¼šåˆ æ‰æ•´ä¸ªgoè¯­å¥ã€‚ å¦‚æœæƒ³è¦åœ¨ä¸€ä¸ªgoroutineä¸­çœ‹åˆ°å¦ä¸€ä¸ªgoroutineçš„æ‰§è¡Œæ•ˆæœï¼Œè¯·ä½¿ç”¨é”æˆ–è€…channelè¿™ç§åŒæ­¥æœºåˆ¶æ¥å»ºç«‹ç¨‹åºæ‰§è¡Œçš„ç›¸å¯¹é¡ºåºã€‚ channelé€šä¿¡ channelé€šä¿¡æ˜¯goroutineåŒæ­¥çš„ä¸»è¦æ–¹æ³•ã€‚æ¯ä¸€ä¸ªåœ¨ç‰¹å®šchannelçš„å‘é€æ“ä½œéƒ½ä¼šåŒ¹é…åˆ°é€šå¸¸åœ¨å¦ä¸€ä¸ªgoroutineæ‰§è¡Œçš„æ¥æ”¶æ“ä½œã€‚ åœ¨channelçš„å‘é€æ“ä½œå…ˆè¡Œå‘ç”Ÿäºå¯¹åº”çš„æ¥æ”¶æ“ä½œå®Œæˆ ä¾‹å¦‚ï¼š 12345678910111213var c = make(chan int, 10)var a stringfunc f() &#123; a = "hello, world" c &lt;- 0&#125;func main() &#123; go f() &lt;-c print(a)&#125; è¿™ä¸ªç¨‹åºèƒ½ä¿è¯æ‰“å°å‡º&quot;hello, world&quot;ã€‚å¯¹açš„å†™å…ˆè¡Œå‘ç”Ÿäºåœ¨cä¸Šçš„å‘é€ï¼Œå…ˆè¡Œå‘ç”Ÿäºåœ¨cä¸Šçš„å¯¹åº”çš„æ¥æ”¶å®Œæˆï¼Œå…ˆè¡Œå‘ç”Ÿäºprintã€‚ å¯¹channelçš„å…³é—­å…ˆè¡Œå‘ç”Ÿäºæ¥æ”¶åˆ°é›¶å€¼ï¼Œå› ä¸ºchannelå·²ç»è¢«å…³é—­äº†ã€‚ åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå°†c &lt;- 0æ›¿æ¢ä¸ºclose(c)è¿˜ä¼šäº§ç”ŸåŒæ ·çš„ç»“æœã€‚ æ— ç¼“å†²channelçš„æ¥æ”¶å…ˆè¡Œå‘ç”Ÿäºå‘é€å®Œæˆ å¦‚ä¸‹ç¨‹åºï¼ˆå’Œä¸Šé¢ç±»ä¼¼ï¼Œåªäº¤æ¢äº†å¯¹channelçš„è¯»å†™ä½ç½®å¹¶ä½¿ç”¨äº†éç¼“å†²channelï¼‰ï¼š 1234567var c = make(chan int)var a stringfunc f() &#123; a = "hello, world" &lt;-c&#125; 12345func main() &#123; go f() c &lt;- 0 print(a)&#125; æ­¤ç¨‹åºä¹Ÿèƒ½ä¿è¯æ‰“å°å‡º&quot;hello, world&quot;ã€‚å¯¹açš„å†™å…ˆè¡Œå‘ç”Ÿäºä»cæ¥æ”¶ï¼Œå…ˆè¡Œå‘ç”Ÿäºå‘cå‘é€å®Œæˆï¼Œå…ˆè¡Œå‘ç”Ÿäºprintã€‚ å¦‚æœæ˜¯å¸¦ç¼“å†²çš„channelï¼ˆä¾‹å¦‚c = make(chan int, 1)ï¼‰ï¼Œç¨‹åºä¸ä¿è¯æ‰“å°å‡º&quot;hello, world&quot;(å¯èƒ½æ‰“å°ç©ºå­—ç¬¦ï¼Œç¨‹åºå´©æºƒæˆ–å…¶ä»–è¡Œä¸º)ã€‚ åœ¨å®¹é‡ä¸ºCçš„channelä¸Šçš„ç¬¬kä¸ªæ¥æ”¶å…ˆè¡Œå‘ç”Ÿäºä»è¿™ä¸ªchannelä¸Šçš„ç¬¬k+Cæ¬¡å‘é€å®Œæˆã€‚ è¿™æ¡è§„åˆ™å°†å‰é¢çš„è§„åˆ™æ¨å¹¿åˆ°äº†å¸¦ç¼“å†²çš„channelä¸Šã€‚å¯ä»¥é€šè¿‡å¸¦ç¼“å†²çš„channelæ¥å®ç°è®¡æ•°ä¿¡å·é‡ï¼šchannelä¸­çš„å…ƒç´ æ•°é‡å¯¹åº”ç€æ´»åŠ¨çš„æ•°é‡ï¼Œchannelçš„å®¹é‡è¡¨ç¤ºåŒæ—¶æ´»åŠ¨çš„æœ€å¤§æ•°é‡ï¼Œå‘é€å…ƒç´ è·å–ä¿¡å·é‡ï¼Œæ¥æ”¶å…ƒç´ é‡Šæ”¾ä¿¡å·é‡ï¼Œè¿™æ˜¯é™åˆ¶å¹¶å‘çš„é€šå¸¸ç”¨æ³•ã€‚ ä¸‹é¢ç¨‹åºä¸ºworkä¸­çš„æ¯ä¸€é¡¹å¼€å¯ä¸€ä¸ªgoroutineï¼Œä½†è¿™äº›goroutineé€šè¿‡æœ‰é™åˆ¶çš„channelæ¥ç¡®ä¿æœ€å¤šåŒæ—¶æ‰§è¡Œä¸‰ä¸ªå·¥ä½œå‡½æ•°ï¼ˆwï¼‰ã€‚ 123456789101112var limit = make(chan int, 3)func main() &#123; for _, w := range work &#123; go func(w func()) &#123; limit &lt;- 1 w() &lt;-limit &#125;(w) &#125; select&#123;&#125;&#125; é” syncåŒ…å®ç°äº†ä¸¤ä¸ªé”çš„æ•°æ®ç±»å‹sync.Mutexå’Œsync.RWMutexã€‚ å¯¹ä»»æ„çš„sync.Mutexæˆ–sync.RWMutexå˜é‡lå’Œn &lt; mï¼Œnæ¬¡è°ƒç”¨l.Unlock()å…ˆè¡Œå‘ç”Ÿäºmæ¬¡l.Lock()è¿”å› ä¸‹é¢ç¨‹åºï¼š 1234567891011121314var l sync.Mutexvar a stringfunc f() &#123; a = "hello, world" l.Unlock()&#125;func main() &#123; l.Lock() go f() l.Lock() print(a)&#125; èƒ½ä¿è¯æ‰“å°å‡º&quot;hello, world&quot;ã€‚ç¬¬ä¸€æ¬¡è°ƒç”¨l.Unlock()ï¼ˆåœ¨f()ä¸­ï¼‰å…ˆè¡Œå‘ç”Ÿäºmainä¸­çš„ç¬¬äºŒæ¬¡l.Lock()è¿”å›, å…ˆè¡Œå‘ç”Ÿäºprintã€‚ å¯¹äºsync.RWMutexå˜é‡lï¼Œä»»æ„çš„å‡½æ•°è°ƒç”¨l.RLockæ»¡è¶³ç¬¬næ¬¡l.RLockåå‘ç”Ÿäºç¬¬næ¬¡è°ƒç”¨l.Unlockï¼Œå¯¹åº”çš„l.RUnlockå…ˆè¡Œå‘ç”Ÿäºç¬¬n+1æ¬¡è°ƒç”¨l.Lockã€‚ Once syncåŒ…çš„Onceä¸ºå¤šä¸ªgoroutineæä¾›äº†å®‰å…¨çš„åˆå§‹åŒ–æœºåˆ¶ã€‚èƒ½åœ¨å¤šä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œonce.Do(f)ï¼Œä½†åªæœ‰ä¸€ä¸ªf()ä¼šæ‰§è¡Œï¼Œå…¶ä»–è°ƒç”¨ä¼šä¸€ç›´é˜»å¡ç›´åˆ°f()è¿”å›ã€‚ é€šè¿‡once.Do(f)æ‰§è¡Œf()å…ˆè¡Œå‘ç”Ÿï¼ˆæŒ‡f()è¿”å›ï¼‰äºå…¶ä»–çš„once.Do(f)è¿”å›ã€‚ å¦‚ä¸‹ç¨‹åºï¼š 12345678910111213141516var a stringvar once sync.Oncefunc setup() &#123; a = "hello, world"&#125;func doprint() &#123; once.Do(setup) print(a)&#125;func twoprint() &#123; go doprint() go doprint()&#125; è°ƒç”¨twoprintä¼šæ‰“å°&quot;hello, world&quot;ä¸¤æ¬¡ã€‚setupåªåœ¨ç¬¬ä¸€æ¬¡doprintæ—¶æ‰§è¡Œã€‚ é”™è¯¯çš„åŒæ­¥æ–¹æ³• æ³¨æ„ï¼Œè¯»æ“ä½œ r å¯èƒ½ä¼šçœ‹åˆ°å¹¶å‘çš„å†™æ“ä½œ w ã€‚å³ä½¿è¿™æ ·ä¹Ÿä¸èƒ½è¡¨æ˜ r ä¹‹åçš„è¯»èƒ½çœ‹åˆ° w ä¹‹å‰çš„å†™ã€‚ å¦‚ä¸‹ç¨‹åºï¼š 12345678910111213141516var a, b intfunc f() &#123; a = 1 b = 2&#125;func g() &#123; print(b) print(a)&#125;func main() &#123; go f() g()&#125; gå¯èƒ½å…ˆæ‰“å°å‡º2ç„¶åæ˜¯0ã€‚ è¿™ä¸ªäº‹å®è¯æ˜ä¸€äº›æ—§çš„ä¹ æƒ¯æ˜¯é”™è¯¯çš„ã€‚ åŒé‡æ£€æŸ¥é”å®šæ˜¯ä¸ºäº†é¿å…åŒæ­¥çš„èµ„æºæ¶ˆè€—ã€‚ä¾‹å¦‚twoprintç¨‹åºå¯èƒ½ä¼šé”™è¯¯çš„å†™æˆï¼š 12345678910111213141516171819var a stringvar done boolfunc setup() &#123; a = "hello, world" done = true&#125;func doprint() &#123; if !done &#123; once.Do(setup) &#125; print(a)&#125;func twoprint() &#123; go doprint() go doprint()&#125; åœ¨doprintä¸­çœ‹åˆ°doneè¢«èµ‹å€¼å¹¶ä¸ä¿è¯èƒ½çœ‹åˆ°å¯¹aèµ‹å€¼ã€‚æ­¤ç¨‹åºå¯èƒ½ä¼šé”™è¯¯åœ°è¾“å‡ºç©ºå­—ç¬¦è€Œä¸æ˜¯&quot;hello, world&quot;ã€‚ å¦ä¸€ä¸ªé”™è¯¯çš„ä¹ æƒ¯æ˜¯å¿™ç­‰å¾… ä¾‹å¦‚ï¼š 1234567891011121314var a stringvar done boolfunc setup() &#123; a = "hello, world" done = true&#125;func main() &#123; go setup() for !done &#123; &#125; print(a)&#125; å’Œä¹‹å‰ç¨‹åºç±»ä¼¼ï¼Œåœ¨mainä¸­çœ‹åˆ°doneè¢«èµ‹å€¼ä¸èƒ½ä¿è¯çœ‹åˆ°aè¢«èµ‹å€¼ï¼Œæ‰€ä»¥æ­¤ç¨‹åºä¹Ÿå¯èƒ½æ‰“å°å‡ºç©ºå­—ç¬¦ã€‚æ›´ç³Ÿç³•çš„æ˜¯å› ä¸ºä¸¤ä¸ªçº¿ç¨‹é—´æ²¡æœ‰åŒæ­¥äº‹ä»¶ï¼Œåœ¨mainä¸­å¯èƒ½æ°¸è¿œä¸ä¼šçœ‹åˆ°doneè¢«èµ‹å€¼ï¼Œæ‰€ä»¥mainä¸­çš„å¾ªç¯ä¸ä¿è¯èƒ½ç»“æŸã€‚ å¯¹ç¨‹åºåšä¸€ä¸ªå¾®å°çš„æ”¹å˜ï¼š 123456789101112131415161718type T struct &#123; msg string&#125;var g *Tfunc setup() &#123; t := new(T) t.msg = "hello, world" g = t&#125;func main() &#123; go setup() for g == nil &#123; &#125; print(g.msg)&#125; å³ä½¿mainçœ‹åˆ°äº†g != nilå¹¶ä¸”é€€å‡ºäº†å¾ªç¯ï¼Œä¹Ÿä¸èƒ½ä¿è¯çœ‹åˆ°g.msgçš„åˆå§‹åŒ–å€¼ã€‚ åœ¨ä¸Šé¢æ‰€æœ‰çš„ä¾‹å­ä¸­ï¼Œè§£å†³åŠæ³•éƒ½æ˜¯ç›¸åŒçš„ï¼šæ˜ç¡®çš„ä½¿ç”¨åŒæ­¥ã€‚]]></content>
  </entry>
  <entry>
    <title><![CDATA[å¸¸ç”¨å‘½ä»¤]]></title>
    <url>%2F2017%2F01%2F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%2F</url>
    <content type="text"><![CDATA[shell 1234567891011121314scpå¤åˆ¶å¤šä¸ªæ–‡ä»¶ï¼Œå¹¶ä¸”ä¸éœ€è¦è¾“å…¥yesscp -o &quot;StrictHostKeyChecking no&quot; 20150603.tar.gz 20150627.tar.gz 20150705.tar.gz user@host:/home/users/log/20150715/`hostname`for i in `seq -f %02g 0 23`;do file=&quot;log/pay.log.20150731&quot;$i; echo $file;doneæŸ¥çœ‹svnå¯†ç ~/.subversion/auth/svn.simple/48eed6299865c0af1dac26d1a6d79efamuttå‘é‚®ä»¶mutt -e &quot;my_hdr content-type:text/html&quot; -s &quot;subject&quot; &quot;user@baidu.com&quot; &lt; mail.htmlåˆ—å‡ºæ–‡ä»¶ä¸­æ’åå‰10çš„è¡ŒåŠæ•°é‡ sort file | uniq -c | sort -k 1 -n -r | head -10æ ¼å¼åŒ–jsonè¾“å‡º`cat /tmp/json |python -m json.tool`è¾“å‡ºæ–‡ä»¶æŒ‡å®šè¡Œcat filename| head -n 3000 | tail -n +1000ï¼ˆæ˜¾ç¤º1000è¡Œåˆ°3000è¡Œï¼‰ï¼Œcat filename | tail -n +3000 | head -n 1000ï¼ˆä»ç¬¬3000è¡Œå¼€å§‹ï¼Œæ˜¾ç¤º1000è¡Œã€‚å³æ˜¾ç¤º3000~3999è¡Œï¼‰ sed 1sed -i &quot;s/old/new/g&quot; `grep -rl &apos;../../static/&apos; *` sedæ‰¹é‡æ›¿æ¢å¤šä¸ªæ–‡ä»¶çš„å†…å®¹ golang 123456ç¼–è¯‘æ—¶æ”¯æŒGDBè°ƒè¯•ï¼š1ä¼ é€’å‚æ•°-ldflags &quot;-s&quot;ï¼Œå¿½ç•¥debugçš„æ‰“å°ä¿¡æ¯2ä¼ é€’-gcflags &quot;-N -l&quot; å‚æ•°ï¼Œè¿™æ ·å¯ä»¥å¿½ç•¥Goå†…éƒ¨åšçš„ä¸€äº›ä¼˜åŒ–ï¼Œèšåˆå˜é‡å’Œå‡½æ•°ç­‰ä¼˜åŒ–ï¼Œè¿™æ ·å¯¹äºGDBè°ƒè¯•æ¥è¯´éå¸¸å›°éš¾ï¼Œæ‰€ä»¥åœ¨ç¼–è¯‘çš„æ—¶å€™åŠ å…¥è¿™ä¸¤ä¸ªå‚æ•°é¿å…è¿™äº›ä¼˜åŒ–3ç¼–è¯‘ä¸ºé™æ€ç¨‹åºCGO_ENABLED=&quot;0&quot; go build hello.gokill -3 &lt;pid&gt;å‘é€SIGQUITä¿¡å·ï¼Œä¼šå°†æ­£åœ¨è¿è¡Œçš„goroutineçš„è°ƒç”¨æ ˆè¾“å‡º gdb 123456789gdbåœ¨æ–‡ä»¶ä¸ŠåŠ æ–­ç‚¹æ—¶é¿å…æ¯æ¬¡ä½¿ç”¨å¾ˆé•¿çš„å®Œæ•´è·¯å¾„ï¼Œå¯ä½¿ç”¨dir(gdb) dir /home/yourihua/workplace/rhino/src/github.com/robfig/revel/Source directories searched: /home/yourihua/workplace/rhino/src/github.com/robfig/revel:$cdir:$cwd(gdb) b revel.go:86Breakpoint 2 at 0x44ef60: file /home/yourihua/workplace/rhino/src/github.com/robfig/revel/revel.go, line 86.æ‰“å°vectorå‰Nä¸ªå…ƒç´ print *(myVector._M_impl._M_start)@Nè®¾ç½®è°ƒè¯•ç¨‹åºçš„å‚æ•°(gdb) set args arg1 arg2 ... git 1234567891011121314151617181920212223242526272829git diff æŸ¥çœ‹å°šæœªæš‚å­˜çš„æ–‡ä»¶æ›´æ–°äº†å“ªäº›éƒ¨åˆ† git diff filename æŸ¥çœ‹å°šæœªæš‚å­˜çš„æŸä¸ªæ–‡ä»¶æ›´æ–°äº†å“ªäº› git diff â€“cached æŸ¥çœ‹å·²ç»æš‚å­˜èµ·æ¥çš„æ–‡ä»¶å’Œä¸Šæ¬¡æäº¤çš„ç‰ˆæœ¬ä¹‹é—´çš„å·®å¼‚ git diff â€“cached filename æŸ¥çœ‹å·²ç»æš‚å­˜èµ·æ¥çš„æŸä¸ªæ–‡ä»¶å’Œä¸Šæ¬¡æäº¤çš„ç‰ˆæœ¬ä¹‹é—´çš„å·®å¼‚ git diff ffd98b291e0caa6c33575c1ef465eae661ce40c9 b8e7b00c02b95b320f14b625663fdecf2d63e74c æŸ¥çœ‹æŸä¸¤ä¸ªç‰ˆæœ¬ä¹‹é—´çš„å·®å¼‚ git diff ffd98b291e0caa6c33575c1ef465eae661ce40c9:filename b8e7b00c02b95b320f14b625663fdecf2d63e74c:filename æŸ¥çœ‹æŸä¸¤ä¸ªç‰ˆæœ¬çš„æŸä¸ªæ–‡ä»¶ä¹‹é—´çš„å·®å¼‚git log &lt;commit-id&gt; --stat æŸ¥çœ‹æŒ‡å®šcommitä¿®æ”¹çš„å“ªäº›æ–‡ä»¶git checkout -t origin/2.0.0 å°†æœ¬åœ°åˆ†æ”¯åˆ‡æ¢ä¸ºè¿œç¨‹åˆ†æ”¯git config --global core.excludesfile ~/.gitignore å…¨å±€å¿½ç•¥git log --pretty=format:&quot;%h - %an, %ar : %s&quot; è¾“å‡ºcommtid - author - commit time - commit msggit show &lt;commitid&gt; &lt;file&gt; æŸ¥çœ‹æŸæ¬¡commitå¯¹æ–‡ä»¶çš„ä¿®æ”¹git update-index --assume-unchanged your_file_path ä¸æƒ³ç»§ç»­è¿½è¸ªæŸä¸ªæ–‡ä»¶git update-index --no-assume-unchanged your_file_path å¦‚æœæƒ³å†æ¬¡ç»§ç»­è·Ÿè¸ªæŸä¸ªæ–‡ä»¶git co -b release-2.0.1 upstream/release-2.0.1 å°†è¿œç¨‹åˆ†æ”¯checkoutåˆ°æœ¬åœ°git cherry-pick &lt;commit-id&gt; å°†æŸä¸ªcommitåº”ç”¨åˆ°å½“å‰åˆ†æ”¯ vim 12345678910111213141516:w !sudo tee % ä¿å­˜æ—¶å–å¾—sudoæƒé™åŠ å…¥è¡Œå· :&apos;&lt;,&apos;&gt;s/BIT_MASK_\zs\d*\ze/\=line(&quot;.&quot;) - line(&quot;&apos;&lt;&quot;) + 1ï¼Œè§£é‡Šï¼š&apos;&lt;,&apos;&gt; æˆ‘ä»¬æ‰€é€‰ä¸­çš„åŒºåŸŸ (:help &apos;&lt;ï¼Œ:help &apos;&gt; )s åœ¨é€‰ä¸­çš„åŒºåŸŸä¸­è¿›è¡Œæ›¿æ¢ (:help :s )\zs æŒ‡æ˜åŒ¹é…ç”±æ­¤å¼€å§‹ (:help /\zs )\d* æŸ¥æ‰¾ä»»æ„ä½æ•°çš„æ•°å­— (:help /\d )\ze æŒ‡æ˜åŒ¹é…åˆ°æ­¤ä¸ºæ­¢ (:help /\ze )\= æŒ‡æ˜åé¢æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ (:help :s\= )line(&quot;.&quot;) å½“å‰å…‰æ ‡æ‰€åœ¨è¡Œçš„è¡Œå· (:help line() )line(&quot;&apos;&lt;&quot;) æˆ‘ä»¬æ‰€é€‰åŒºåŸŸä¸­ç¬¬ä¸€è¡Œçš„è¡Œå· (:help line() ) å½“â€:sâ€å‘½ä»¤çš„æ›¿æ¢å­—ç¬¦ä¸²æ˜¯ä»¥â€\=â€å¼€å¤´æ—¶ï¼Œè¡¨æ˜ä½¿ç”¨ä¸€ä¸ªè¡¨è¾¾å¼è®¡ç®—çš„ç»“æœè¿›è¡Œæ›¿æ¢å»é™¤é‡å¤çš„è¡Œ1.å…ˆæ’åº:sort2.ç„¶åä¸è¦åŒæ—¶æ’åº:sor ur /^/ fiddler 1bpafter &lt;part_url&gt;ï¼šURLä¸­å«æœ‰part_urlæ—¶ä¸­æ–­ï¼Œå¯ä¿®æ”¹å“åº”ç„¶åè¿”å›ç»™æµè§ˆå™¨ redis 1cat &lt;file_name&gt; | redis-cli --pipe ä¸€æ¬¡æ‰§è¡Œå¤šæ¡rediså‘½ä»¤ï¼ˆæ¯”å¦‚å¯¼å…¥å¤§é‡æ•°æ®ï¼‰ vs code 12settings.json&quot;editor.renderWhitespace&quot;:true // æ˜¾ç¤ºç©ºç™½å­—ç¬¦m]]></content>
  </entry>
</search>
